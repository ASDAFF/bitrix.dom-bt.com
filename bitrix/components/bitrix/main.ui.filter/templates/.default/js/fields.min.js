(function(){"use strict";BX.namespace("BX.Filter");BX.Filter.Fields=function(t){this.parent=null;this.init(t)};BX.Filter.Fields.prototype={init:function(t){this.parent=t;BX.addCustomEvent(window,"UI::Select::change",BX.delegate(this._onDateTypeChange,this))},deleteField:function(t){BX.remove(t)},isFieldDelete:function(t){return BX.hasClass(t,this.parent.settings.classFieldDelete)},isFieldValueDelete:function(t){return BX.hasClass(t,this.parent.settings.classValueDelete)||BX.hasClass(t.parentNode,this.parent.settings.classValueDelete)},isDragButton:function(t){return t&&BX.hasClass(t,this.parent.settings.classPresetDragButton)},clearFieldValue:function(t){if(t){var e=BX.Filter.Utils.getByClass(t,this.parent.settings.classControl,true);var n=BX.Filter.Utils.getByClass(t,this.parent.settings.classSquare,true);(n||[]).forEach(BX.remove);(e||[]).forEach(function(t){t&&"value"in t&&(t.value="")},this)}},getField:function(t){var e;if(BX.type.isDomNode(t)){e=BX.findParent(t,{"class":this.parent.settings.classField},true,false);if(!BX.type.isDomNode(e)){e=BX.findParent(t,{"class":this.parent.settings.classFieldGroup},true,false)}}return e},render:function(t,e){var n,i,a,l;if(BX.type.isPlainObject(e)&&BX.type.isNotEmptyString(t)){n=Object.keys(e);n.forEach(function(n){l="{{"+n+"}}";t=t.replace(new RegExp(l,"g"),e[n])});a=BX.create("div",{html:t});i=BX.Filter.Utils.getByClass(a,this.parent.settings.classFieldGroup);if(!BX.type.isDomNode(i)){i=BX.Filter.Utils.getByClass(a,this.parent.settings.classField)}if(!BX.type.isDomNode(i)){i=BX.Filter.Utils.getByClass(a,this.parent.settings.classFieldLine)}}return i},createInputText:function(t){var e={block:"main-ui-control-field",mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel]:null,deleteButton:true,valueDelete:true,name:t.NAME,type:t.TYPE,label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),content:[{block:"main-ui-control-string",name:t.NAME,placeholder:t.PLACEHOLDER||"",value:BX.type.isNotEmptyString(t.VALUE)||BX.type.isNumber(t.VALUE)?t.VALUE:"",tabindex:t.TABINDEX}]};return BX.decl(e)},createCustomEntity:function(t){var e,n;var i={block:"main-ui-control-field",mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel]:null,deleteButton:true,valueDelete:true,name:t.NAME,type:t.TYPE,label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),content:{block:"main-ui-control-entity",mix:"main-ui-control",attrs:{"data-multiple":JSON.stringify(t.MULTIPLE)},content:[]}};if("_label"in t.VALUES&&!!t.VALUES._label){if(t.MULTIPLE){var a=!!t.VALUES._label?t.VALUES._label:[];if(BX.type.isPlainObject(a)){a=Object.keys(a).map(function(t){return a[t]})}a.forEach(function(e,n){i.content.content.push({block:"main-ui-square",tag:"span",name:e,item:{_label:e,_value:t.VALUES._value[n]}})})}else{i.content.content.push({block:"main-ui-square",tag:"span",name:"_label"in t.VALUES?t.VALUES["_label"]:"",item:t.VALUES})}}i.content.content.push({block:"main-ui-square-search",tag:"span",content:{block:"main-ui-control-string",name:t.NAME+"_label",tabindex:t.TABINDEX,type:"text",placeholder:t.PLACEHOLDER||""}},{block:"main-ui-control-string",name:t.NAME,type:"hidden",placeholder:t.PLACEHOLDER||"",value:"_value"in t.VALUES?t.VALUES["_value"]:"",tabindex:t.TABINDEX});i=BX.decl(i);e=BX.Filter.Utils.getBySelector(i,'.main-ui-control-string[type="text"]');BX.addClass(e,"main-ui-square-search-item");BX.bind(e,"focus",BX.proxy(this._onCustomEntityInputFocus,this));BX.bind(e,"click",BX.proxy(this._onCustomEntityInputClick,this));if(!this.bindDocument){BX.bind(document,"click",BX.proxy(this._onCustomEntityBlur,this));document.addEventListener("focus",BX.proxy(this._onDocumentFocus,this),true);this.bindDocument=true}BX.bind(e,"keydown",BX.proxy(this._onCustomEntityKeydown,this));BX.bind(i,"click",BX.proxy(this._onCustomEntityFieldClick,this));return i},_onCustomEntityInputFocus:function(t){BX.fireEvent(t.currentTarget,"click")},_onCustomEntityInputClick:function(t){var e,n,i,a;t.preventDefault();t.stopPropagation();if(t.isTrusted){this.trustTimestamp=t.timeStamp;this.notTrustTimestamp=this.notTrustTimestamp||t.timeStamp}else{this.notTrustTimestamp=t.timeStamp}e=new Date(this.trustTimestamp);n=new Date(this.notTrustTimestamp);i=e.getMinutes()+":"+e.getSeconds();a=n.getMinutes()+":"+n.getSeconds();if(i!==a){this._onCustomEntityFocus(t)}},_onDocumentFocus:function(t){var e=false;if(this.lastLabelInput&&t.target!==this.lastLabelInput){if(BX.type.isArray(this.popupInputs)&&this.popupInputs.length){e=this.popupInputs.some(function(e){return e===t.target})}if(!e){this._onCustomEntityBlur(t)}}},_onCustomEntityKeydown:function(t){var e=BX.Filter.Utils.getByClass(t.target.parentNode.parentNode,this.parent.settings.classSquare,true);var n=null;if(e.length){n=e[e.length-1]}if(BX.Filter.Utils.isKey(t,"backspace")&&t.currentTarget.selectionStart===0){if(BX.type.isDomNode(n)){if(BX.hasClass(n,this.parent.settings.classSquareSelected)){BX.remove(n);var i=BX.Filter.Utils.getBySelector(t.target.parentNode.parentNode,'input[type="hidden"]');i.value="";BX.fireEvent(i,"input")}else{BX.addClass(n,this.parent.settings.classSquareSelected)}}}else if(BX.type.isDomNode(n)&&BX.hasClass(n,this.parent.settings.classSquareSelected)){BX.removeClass(n,this.parent.settings.classSquareSelected)}},_onCustomEntityFieldClick:function(t){var e;if(BX.hasClass(t.target,this.parent.settings.classSquareDelete)){e=BX.findParent(t.target,{className:this.parent.settings.classSquare},true,false);if(BX.type.isDomNode(e)){var n=this.getCustomEntityInstance();BX.onCustomEvent(window,"BX.Main.Filter:customEntityRemove",[n]);BX.remove(e)}}else{var i=BX.Filter.Utils.getBySelector(t.target,'input[type="text"]');BX.fireEvent(i,"focus")}},_onCustomEntityBlur:function(t){var e={stopBlur:false};BX.onCustomEvent(window,"BX.Main.Filter:onGetStopBlur",[t,e]);if(typeof e.stopBlur=="undefined"||!e.stopBlur){var n=this.getCustomEntityInstance();this.lastLabelInput=null;BX.onCustomEvent(window,"BX.Main.Filter:customEntityBlur",[n]);BX.unbind(n.getPopupContainer(),"click",this._stopPropagation);this.popupInputs=null;BX.removeClass(n.getField(),this.parent.settings.classFocus)}},_stopPropagation:function(t){t.stopPropagation()},getCustomEntityInstance:function(){if(!(this.customEntityInstance instanceof BX.Main.ui.CustomEntity)){this.customEntityInstance=new BX.Main.ui.CustomEntity}return this.customEntityInstance},_onCustomEntityFocus:function(t){var e=BX.findParent(t.currentTarget,{className:"main-ui-control-entity"},true,false);var n=this.getCustomEntityInstance();t.stopPropagation();n.setField(e);this.lastLabelInput=n.getLabelNode();BX.onCustomEvent(window,"BX.Main.Filter:customEntityFocus",[n]);var i=n.getPopupContainer();if(BX.type.isElementNode(i)){BX.bind(i,"click",this._stopPropagation);this.popupInputs=i.querySelectorAll("input,a,div");this.popupInputs=Array.prototype.slice.call(this.popupInputs)}BX.addClass(e,this.parent.settings.classFocus)},createCustom:function(t){var e,n,i;var a=[];t.VALUE=BX.util.htmlspecialcharsback(t.VALUE);a.push("main-ui-control");a.push("main-ui-custom-style");i=BX.decl({block:"main-ui-control-field",mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel]:null,name:t.NAME,type:t.TYPE,deleteButton:true,label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),content:{block:"main-ui-custom",mix:a,attrs:{"data-name":t.NAME},content:""}});n='name="'+t.NAME+'" value="'+("_VALUE"in t?t._VALUE:"")+'"';e=BX.Filter.Utils.getByClass(i,"main-ui-custom");try{t.VALUE=t.VALUE.replace('name="'+t.NAME+'"',n)}catch(l){}BX.html(e,t.VALUE);return i},createSelect:function(t){return BX.decl({block:"main-ui-control-field",mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel]:null,name:t.NAME,type:t.TYPE,deleteButton:true,label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),content:{block:this.parent.settings.classSelect,name:t.NAME,items:t.ITEMS,value:"VALUE"in t?t.VALUE:t.ITEMS[0],params:t.PARAMS,tabindex:t.TABINDEX,valueDelete:false}})},createMultiSelect:function(t){return BX.decl({block:"main-ui-control-field",mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel]:null,name:t.NAME,type:t.TYPE,deleteButton:true,label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),content:{block:"main-ui-multi-select",name:t.NAME,tabindex:"TABINDEX"in t?t.TABINDEX:"",placeholder:!this.parent.getParam("ENABLE_LABEL")&&"PLACEHOLDER"in t?t.PLACEHOLDER:"",items:"ITEMS"in t?t.ITEMS:[],value:"VALUE"in t?t.VALUE:[],params:"PARAMS"in t?t.PARAMS:{isMulti:true},valueDelete:true}})},_onDateTypeChange:function(t,e){var n={};var i=null;var a,l,s,r,E,o,u,c;if(BX.type.isPlainObject(e)&&"VALUE"in e){r=BX.data(t.getNode(),"name");l=t.getParams();if(!BX.type.isPlainObject(l)&&(r.indexOf("_datesel")!==-1||r.indexOf("_numsel")!==-1)){a=t.getNode().parentNode.parentNode;n.TABINDEX=t.getInput().getAttribute("tabindex");n.SUB_TYPES=t.getItems();n.SUB_TYPE=e;n.NAME=BX.data(a,"name");n.TYPE=BX.data(a,"type");o=this.parent.getPreset().getCurrentPresetData();if("FIELDS"in o&&o.FIELDS.length){u=o.FIELDS.filter(function(t){return t.NAME===n.NAME},this);if(u.length){u=u[0];if(r.indexOf("_datesel")!==-1){n.MONTHS=u.MONTHS;n.MONTH=u.MONTH;n.YEARS=u.YEARS;n.YEAR=u.YEAR;n.QUARTERS=u.QUARTERS;n.QUARTER=u.QUARTER;n.ENABLE_TIME=u.ENABLE_TIME}n.VALUES=u.VALUES}}if(this.parent.getParam("ENABLE_LABEL")){s=BX.Filter.Utils.getByClass(a,this.parent.settings.classFieldLabel);n.LABEL=s.innerText}if(r.indexOf("_datesel")!==-1){i=this.createDate(n)}else{i=this.createNumber(n)}if(BX.type.isArray(this.parent.fieldsList)){c=this.parent.fieldsList.indexOf(a);if(c!==-1){this.parent.fieldsList[c]=i;this.parent.registerDragItem(i)}}this.parent.unregisterDragItem(a);E=BX.Filter.Utils.getByClass(i,this.parent.settings.classField,true);if(BX.type.isArray(E)&&E.length){E.forEach(function(t){t.FieldController=new BX.Filter.FieldController(t,this.parent)},this)}BX.insertAfter(i,a);BX.remove(a)}}},createNumber:function(t){var e,n,i,a,l,s;var r=this.parent.numberTypes;var E=r.SINGLE;if("SUB_TYPE"in t&&BX.type.isPlainObject(t.SUB_TYPE)){E=t.SUB_TYPE.VALUE;i="PLACEHOLDER"in t.SUB_TYPE?t.SUB_TYPE.PLACEHOLDER:""}t.NAME=t.NAME.replace("_numsel","");e={block:"number-group",type:t.TYPE,mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel,"main-ui-filter-number-group"]:["main-ui-filter-number-group"],label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),tabindex:"TABINDEX"in t?t.TABINDEX:"",value:"SUB_TYPE"in t?t.SUB_TYPE:{},items:"SUB_TYPES"in t?t.SUB_TYPES:[],name:"NAME"in t?t.NAME:"",deleteButton:true,content:[]};if(E!==r.LESS){a={block:"main-ui-control-field",type:t.TYPE,dragButton:false,content:{block:"main-ui-number",mix:["filter-type-single"],calendarButton:true,valueDelete:true,placeholder:i,name:"NAME"in t?t.NAME+"_from":"",tabindex:"TABINDEX"in t?t.TABINDEX:"",value:"VALUES"in t?t.VALUES._from:""}};e.content.push(a)}if(E===r.RANGE){l={block:"main-ui-filter-field-line",content:{block:"main-ui-filter-field-line-item",tag:"span"}};e.content.push(l)}if(E===r.RANGE||E===r.LESS){s={block:"main-ui-control-field",type:t.TYPE,dragButton:false,content:{block:"main-ui-number",calendarButton:true,valueDelete:true,name:"NAME"in t?t.NAME+"_to":"",tabindex:"TABINDEX"in t?t.TABINDEX:"",value:"VALUES"in t?t.VALUES._to:""}}}e.content.push(s);return BX.decl(e)},createDate:function(t){var e,n,i,a,l,s,r,E,o;var u=this.parent.dateTypes;var c=u.NONE;if("SUB_TYPE"in t&&BX.type.isPlainObject(t.SUB_TYPE)){c=t.SUB_TYPE.VALUE;s="PLACEHOLDER"in t.SUB_TYPE?t.SUB_TYPE.PLACEHOLDER:""}t.NAME=t.NAME.replace("_datesel","");if("VALUES"in t&&BX.type.isPlainObject(t.VALUES)){var A=Object.keys(t.VALUES);A.forEach(function(e){if(!t.VALUES[e]){t.VALUES[e]=""}})}e={block:"date-group",type:t.TYPE,mix:this.parent.getParam("ENABLE_LABEL")?[this.parent.settings.classFieldWithLabel,"main-ui-filter-date-group"]:["main-ui-filter-date-group"],label:this.parent.getParam("ENABLE_LABEL")?t.LABEL:"",dragTitle:this.parent.getParam("MAIN_UI_FILTER__DRAG_FIELD_TITLE"),deleteTitle:this.parent.getParam("MAIN_UI_FILTER__REMOVE_FIELD"),tabindex:"TABINDEX"in t?t.TABINDEX:"",value:"SUB_TYPE"in t?t.SUB_TYPE:{},items:"SUB_TYPES"in t?t.SUB_TYPES:[],name:"NAME"in t?t.NAME:"",enableTime:"ENABLE_TIME"in t?t.ENABLE_TIME:false,deleteButton:true,content:[]};t.NAME=t.NAME.replace("_datesel","");if(c===u.EXACT){a={block:"main-ui-control-field",type:t.TYPE,dragButton:false,content:{block:"main-ui-date",mix:["filter-type-single"],calendarButton:true,valueDelete:true,placeholder:s,name:"NAME"in t?t.NAME+"_from":"",tabindex:"TABINDEX"in t?t.TABINDEX:"",value:"VALUES"in t?t.VALUES._from:"",enableTime:t.ENABLE_TIME}};e.content.push(a)}if(c===u.NEXT_DAYS||c===u.PREV_DAYS){a={block:"main-ui-control-field",type:t.TYPE,dragButton:false,content:{block:"main-ui-number",mix:["filter-type-single"],calendarButton:true,valueDelete:true,placeholder:s,name:"NAME"in t?t.NAME+"_days":"",tabindex:"TABINDEX"in t?t.TABINDEX:"",value:"VALUES"in t?t.VALUES._days:""}};e.content.push(a)}if(c===u.RANGE){n={block:"main-ui-control-field",type:t.TYPE,dragButton:false,content:{block:"main-ui-date",calendarButton:true,valueDelete:true,name:"NAME"in t?t.NAME+"_from":"",tabindex:"TABINDEX"in t?t.TABINDEX:"",value:"VALUES"in t?t.VALUES._from:"",placeholder:s,enableTime:t.ENABLE_TIME}};l={block:"main-ui-filter-field-line",content:{block:"main-ui-filter-field-line-item",tag:"span"}};i={block:"main-ui-control-field",type:t.TYPE,dragButton:false,content:{block:"main-ui-date",calendarButton:true,valueDelete:true,name:"NAME"in t?t.NAME+"_to":"",tabindex:"TABINDEX"in t?t.TABINDEX:"",value:"VALUES"in t?t.VALUES._to:"",placeholder:s,enableTime:t.ENABLE_TIME}};e.content.push(n);e.content.push(l);e.content.push(i)}if(c===u.MONTH){if("_month"in t.VALUES&&t.VALUES._month){t.MONTH=t.MONTHS.filter(function(e){return e.VALUE===t.VALUES._month});t.MONTH=t.MONTH.length?t.MONTH[0]:null}if(!t.MONTH){t.MONTH=t.MONTHS[0]}o={block:"main-ui-control-field",dragButton:false,content:{block:"main-ui-select",tabindex:"tabindex"in t?t.tabindex:"",value:t.MONTH,items:t.MONTHS,name:t.NAME+"_month",valueDelete:false}};if("_year"in t.VALUES&&t.VALUES._year){t.YEAR=t.YEARS.filter(function(e){return e.VALUE===t.VALUES._year});t.YEAR=t.YEAR.length?t.YEAR[0]:null}if(!t.YEAR){t.YEAR=t.YEARS[0]}r={block:"main-ui-control-field",dragButton:false,content:{block:"main-ui-select",tabindex:"tabindex"in t?t.tabindex:"",value:t.YEAR,items:t.YEARS,name:t.NAME+"_year",valueDelete:false}};e.content.push(o);e.content.push(r)}if(c===u.QUARTER){if("_year"in t.VALUES&&t.VALUES._year){t.YEAR=t.YEARS.filter(function(e){return e.VALUE===t.VALUES._year});t.YEAR=t.YEAR.length?t.YEAR[0]:null}if(!t.YEAR){t.YEAR=t.YEARS[0]}r={block:"main-ui-control-field",dragButton:false,content:{block:"main-ui-select",tabindex:"tabindex"in t?t.tabindex:"",value:t.YEAR,items:t.YEARS,name:t.NAME+"_year",valueDelete:false}};if("_quarter"in t.VALUES&&t.VALUES._quarter){t.QUARTER=t.QUARTERS.filter(function(e){return e.VALUE===t.VALUES._quarter});t.QUARTER=t.QUARTER.length?t.QUARTER[0]:null}if(!t.QUARTER){t.QUARTER=t.QUARTERS[0]}E={block:"main-ui-control-field",dragButton:false,content:{block:"main-ui-select",tabindex:"tabindex"in t?t.tabindex:"",value:t.QUARTER,items:t.QUARTERS,name:t.NAME+"_quarter",params:t.PARAMS,valueDelete:false}};e.content.push(E);e.content.push(r)}if(c===u.YEAR){if("_year"in t.VALUES&&t.VALUES._year){t.YEAR=t.YEARS.filter(function(e){return e.VALUE===t.VALUES._year});t.YEAR=t.YEAR.length?t.YEAR[0]:null}if(!t.YEAR){t.YEAR=t.YEARS[0]}r={block:"main-ui-control-field",dragButton:false,content:{block:"main-ui-select",tabindex:"tabindex"in t?t.tabindex:"",value:t.YEAR,items:t.YEARS,name:t.NAME+"_year",valueDelete:false}};e.content.push(r)}return BX.decl(e)}}})();
//# sourceMappingURL=fields.map.js