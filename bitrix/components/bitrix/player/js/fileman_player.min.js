(function(){BX.namespace("BX.Fileman");if(window.BX.Fileman.PlayerManager){return}BX.Fileman.PlayerManager={isStarted:false,players:[],playing:false,addPlayer:function(i){this.players.push(i);BX.bind(BX(i.id),"click",BX.proxy(i.onClick,i));BX.bind(BX(i.id),"keydown",BX.proxy(i.onKeyDown,i));if(i.autostart||i.lazyload){this.init()}},init:function(){if(this.isStarted){return}this.isStarted=true;BX.ready(function(){BX.bind(window,"scroll",BX.throttle(BX.Fileman.PlayerManager.onScroll,300,BX.Fileman.PlayerManager))});BX.Fileman.PlayerManager.onScroll()},onScroll:function(){if(this.players.length==0){return}var i=false;var t=false;for(var e in this.players){var a=this.players[e];if(!BX(a.id)){this.players.splice(e,1);continue}if(a.lazyload&&!a.inited){if(this.isVisibleOnScreen(a.id,2)){a.init()}}if(!a.autostart){continue}if(a.active){continue}if(a.isEnded()){continue}if(this.isVisibleOnScreen(a.id,1)){if(i===false){i=a}}else{if(a.isPlaying()){a.pause()}}if(a.isPlaying()){t=true}}if(t){return}if(i!==false){if(!i.inited){i.autostart=true}else if(i.isReady()&&!i.isEnded()){i.play()}}},getElementCoords:function(i){var t=.25;var e=BX(i).getBoundingClientRect();var a=e.bottom-e.top;var s=e.top+t*a;var r=e.bottom-t*a;var n=e.right-e.left;var l=e.left+t*n;var o=e.right-t*n;coords={top:s+window.pageYOffset,bottom:r+window.pageYOffset,left:l+window.pageXOffset,right:o+window.pageXOffset,originTop:s,originLeft:l,originBottom:r,originRight:o};return coords},isVisibleOnScreen:function(i,t){var e,a=false;var s=this.getElementCoords(i);var r=document.documentElement.clientHeight;var n=window.pageYOffset||document.documentElement.scrollTop;var l=n+r;if(t){t=parseInt(t)}if(t>1){n-=r*(t-1);l+=r*(t-1)}var o=s.top>n&&s.top<l;var h=s.bottom<l&&s.bottom>n;e=o||h;if(e&&t>1){return true}if(!e){return false}var y=BX(i);var d=s.originLeft+(s.originRight-s.originLeft)/2;var f=s.originTop+(s.originBottom-s.originTop)/2+20;var u=document.elementFromPoint(d,f);if(!!u){if(u===y||u.parentNode===y||u.parentNode.parentNode===y){a=true}}return e&&a},getPlayerById:function(i){if(!i){return null}for(var t in this.players){if(this.players[t].id==i){return this.players[t]}}return null}};BX.Fileman.Player=function(i,t){this.inited=false;this.isStarted=false;this.active=false;this.id=i;this.fillParameters(t);BX.Fileman.PlayerManager.addPlayer(this)};BX.Fileman.Player.prototype.onClick=function(){var i=BX.findChildByClassName(this.getElement(),"vjs-play-control");if(i){i.focus()}this.active=true};BX.Fileman.Player.prototype.isPlaying=function(){if(this.vjsPlayer){return this.vjsPlayer.isReady_&&!this.vjsPlayer.paused()}return false};BX.Fileman.Player.prototype.pause=function(){try{this.vjsPlayer.pause()}catch(i){}};BX.Fileman.Player.prototype.isEnded=function(){if(this.vjsPlayer){return this.vjsPlayer.ended()}return false};BX.Fileman.Player.prototype.isReady=function(){return this.vjsPlayer.isReady_};BX.Fileman.Player.prototype.play=function(){try{this.vjsPlayer.play()}catch(i){}};BX.Fileman.Player.prototype.adjust=function(){var i=BX.width(BX(this.id).parentNode);if(!this.vjsPlayer){return}if(this.vjsPlayer.videoWidth()==0||this.vjsPlayer.videoHeight()==0){return}if(this.vjsPlayer.videoWidth()<i){this.vjsPlayer.width(this.vjsPlayer.videoWidth());this.vjsPlayer.height(this.vjsPlayer.videoHeight());this.vjsPlayer.fluid(false);if(!BX(this.id+"_container")){var t=BX.create("div",{attrs:{id:this.id+"_container"},props:{className:"videojs-player-container"}});BX.insertAfter(t,BX(this.id));BX.append(BX(this.id),t);BX.addClass(BX(this.id),"videojs-adjusted")}}else{this.vjsPlayer.fluid(true)}};BX.Fileman.Player.prototype.getElement=function(){return BX(this.id)};BX.Fileman.Player.prototype.createElement=function(){var i=this.getElement();if(i){return i}if(!this.id){return null}var t="video";if(this.isAudio){t="audio"}var e="video-js vjs-big-play-centered";if(this.skin){e+=" "+this.skin}var a={id:this.id,className:e,width:this.width,height:this.height};if(this.muted){a["muted"]=true}i=BX.create(t,{attrs:a});return i};BX.Fileman.Player.prototype.fillParameters=function(i){this.autostart=i.autostart||false;this.width=i.width||400;this.height=i.height||300;this.hasFlash=i.hasFlash||false;if(i.playbackRate&&!i.hasFlash){i.playbackRate=parseInt(i.playbackRate);if(i.playbackRate!=1){if(i.playbackRate<=0){i.playbackRate=1}if(i.playbackRate>3){i.playbackRate=3}}if(i.playbackRate!=1){this.playbackRate=i.playbackRate}}this.volume=i.volume||.8;this.playlistParams=i.playlistParams;this.startTime=i.startTime||0;this.wmvConfig=i.wmvConfig;this.onInit=i.onInit;this.isAdjust=i.isAdjust||false;this.lazyload=i.lazyload;this.params=i};BX.Fileman.Player.prototype.onKeyDown=function(i){if(i.which==32){this.onClick();if(this.isPlaying()){this.pause()}else{this.play()}i.preventDefault();i.stopPropagation();return false}};BX.Fileman.Player.prototype.setSource=function(i){if(!i){return false}this.vjsPlayer.src(i)};BX.Fileman.Player.prototype.getSource=function(){return this.vjsPlayer.src()};BX.Fileman.Player.prototype.init=function(){if(videojs.players[this.id]){delete videojs.players[this.id]}this.vjsPlayer=videojs(this.id,this.params);if(this.hasFlash){this.vjsPlayer.setTimeout(function(){if(!this.hasStarted()){this.error(BX.message("PLAYER_FLASH_REQUIRED"))}},1e4)}this.vjsPlayer.ready(BX.proxy(function(){var i=BX.findChildByClassName(BX(this.id),"vjs-play-control");if(i){i.addEventListener("click",BX.proxy(this.onClick,this))}this.vjsPlayer.volume(this.volume);if(this.muted){this.vjsPlayer.muted(true)}this.vjsPlayer.one("play",BX.proxy(function(){if(this.playbackRate!=1){this.vjsPlayer.playbackRate(this.playbackRate)}if(this.volume){this.vjsPlayer.volume(this.volume)}if(this.startTime>0){try{this.vjsPlayer.currentTime(this.startTime);var i=BX.findChild(BX(this.id),{class:"vjs-loading-spinner"},false);if(i){i.remove()}}catch(i){}}},this));if(this.playlistParams){this.vjsPlayer.playlist(this.playlistParams)}if(this.wmvConfig){this.vjsPlayer.wmvConfig=this.wmvConfig}this.inited=true;if(BX.type.isFunction(this.onInit)){this.onInit(this)}if(this.isAdjust){if(this.vjsPlayer.videoWidth()==0||this.vjsPlayer.videoHeight()==0){this.vjsPlayer.one("loadedmetadata",BX.proxy(function(){this.adjust()},this))}else{this.adjust()}this.isAdjust=false}},this))}})(window);