(function(e){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=e()}else if(typeof define==="function"&&define.amd){define([],e)}else{var t;if(typeof window!=="undefined"){t=window}else if(typeof global!=="undefined"){t=global}else if(typeof self!=="undefined"){t=self}else{t=this}t.videojsContribHls=e()}})(function(){var e,t,i;return function r(e,t,i){function n(s,o){if(!t[s]){if(!e[s]){var u=typeof require=="function"&&require;if(!o&&u)return u(s,!0);if(a)return a(s,!0);var f=new Error("Cannot find module '"+s+"'");throw f.code="MODULE_NOT_FOUND",f}var d=t[s]={exports:{}};e[s][0].call(d.exports,function(t){var i=e[s][1][t];return n(i?i:t)},d,d.exports,r,e,t,i)}return t[s].exports}var a=typeof require=="function"&&require;for(var s=0;s<i.length;s++)n(i[s]);return n}({1:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function e(e,t){var i=[];var r=true;var n=false;var a=undefined;try{for(var s=e[Symbol.iterator](),o;!(r=(o=s.next()).done);r=true){i.push(o.value);if(t&&i.length===t)break}}catch(u){n=true;a=u}finally{try{if(!r&&s["return"])s["return"]()}finally{if(n)throw a}}return i}return function(t,i){if(Array.isArray(t)){return t}else if(Symbol.iterator in Object(t)){return e(t,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();function n(e){return e&&e.__esModule?e:{"default":e}}var a=e("global/window");var s=n(a);var o=function f(e,t){var i=e.cues;for(var r=0;r<i.length;r++){var n=i[r];if(t>=n.adStartTime&&t<=n.adEndTime){return n}}return null};var u=function d(e,t){var i=arguments.length<=2||arguments[2]===undefined?0:arguments[2];if(!e.segments){return}var n=i;var a=undefined;for(var u=0;u<e.segments.length;u++){var f=e.segments[u];if(!a){a=o(t,n+f.duration/2)}if(a){if("cueIn"in f){a.endTime=n;a.adEndTime=n;n+=f.duration;a=null;continue}if(n<a.endTime){n+=f.duration;continue}a.endTime+=f.duration}else{if("cueOut"in f){a=new s["default"].VTTCue(n,n+f.duration,f.cueOut);a.adStartTime=n;a.adEndTime=n+parseFloat(f.cueOut);t.addCue(a)}if("cueOutCont"in f){var d=undefined;var l=undefined;var c=f.cueOutCont.split("/").map(parseFloat);var h=r(c,2);d=h[0];l=h[1];a=new s["default"].VTTCue(n,n+f.duration,"");a.adStartTime=n-d;a.adEndTime=a.adStartTime+l;t.addCue(a)}}n+=f.duration}};i["default"]={updateAdCues:u,findAdCue:o};t.exports=i["default"]},{"global/window":28}],2:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function u(e,t){return e.start(t)+"-"+e.end(t)};var n=function f(e,t){var i=e.toString(16);return"00".substring(0,2-i.length)+i+(t%2?" ":"")};var a=function d(e){if(e>=32&&e<126){return String.fromCharCode(e)}return"."};var s=function l(e){var t={};Object.keys(e).forEach(function(i){var r=e[i];if(ArrayBuffer.isView(r)){t[i]={bytes:r.buffer,byteOffset:r.byteOffset,byteLength:r.byteLength}}else{t[i]=r}});return t};var o={hexDump:function c(e){var t=Array.prototype.slice.call(e);var i=16;var r="";var s=undefined;var o=undefined;for(var u=0;u<t.length/i;u++){s=t.slice(u*i,u*i+i).map(n).join("");o=t.slice(u*i,u*i+i).map(a).join("");r+=s+" "+o+"\n"}return r},tagDump:function h(e){return o.hexDump(e.bytes)},textRanges:function p(e){var t="";var i=undefined;for(i=0;i<e.length;i++){t+=r(e,i)+" "}return t},createTransferableMessage:s};i["default"]=o;t.exports=i["default"]},{}],3:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});i["default"]={GOAL_BUFFER_LENGTH:30};t.exports=i["default"]},{}],4:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});function r(e){return e&&e.__esModule?e:{"default":e}}var n=e("global/window");var a=r(n);var s=e("aes-decrypter");var o=e("./bin-utils");var u=function f(e){e.onmessage=function(e){var t=e.data;var i=new Uint8Array(t.encrypted.bytes,t.encrypted.byteOffset,t.encrypted.byteLength);var r=new Uint32Array(t.key.bytes,t.key.byteOffset,t.key.byteLength/4);var n=new Uint32Array(t.iv.bytes,t.iv.byteOffset,t.iv.byteLength/4);new s.Decrypter(i,r,n,function(e,i){a["default"].postMessage((0,o.createTransferableMessage)({source:t.source,decrypted:i}),[i.buffer])})}};i["default"]=function(e){return new u(e)};t.exports=i["default"]},{"./bin-utils":2,"aes-decrypter":21,"global/window":28}],5:[function(e,t,i){(function(t){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,i,r){if(i)e(t.prototype,i);if(r)e(t,r);return t}}();var n=function C(e,t,i){var r=true;e:while(r){var n=e,a=t,s=i;r=false;if(n===null)n=Function.prototype;var o=Object.getOwnPropertyDescriptor(n,a);if(o===undefined){var u=Object.getPrototypeOf(n);if(u===null){return undefined}else{e=u;t=a;i=s;r=true;o=u=undefined;continue e}}else if("value"in o){return o.value}else{var f=o.get;if(f===undefined){return undefined}return f.call(s)}}};function a(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function o(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var u=e("./playlist-loader");var f=a(u);var d=e("./segment-loader");var l=a(d);var c=e("./ranges");var h=a(c);var p=typeof window!=="undefined"?window["videojs"]:typeof t!=="undefined"?t["videojs"]:null;var m=a(p);var v=e("./ad-cue-tags");var y=a(v);var g=e("./sync-controller");var b=a(g);var _=e("videojs-contrib-media-sources/es5/codec-utils");var T=e("webworkify");var w=a(T);var S=e("./decrypter-worker");var k=a(S);var O=5*60*1e3;var P=undefined;var A=function U(e,t){if(typeof e!==typeof t){return true}if(Object.keys(e).length!==Object.keys(t).length){return true}for(var i in e){if(e[i]!==t[i]){return true}}return false};var E=function D(e){var t={codecCount:0,videoCodec:null,videoObjectTypeIndicator:null,audioProfile:null};var i=undefined;t.codecCount=e.split(",").length;t.codecCount=t.codecCount||2;i=/(^|\s|,)+(avc1)([^ ,]*)/i.exec(e);if(i){t.videoCodec=i[2];t.videoObjectTypeIndicator=i[3]}t.audioProfile=/(^|\s|,)+mp4a.[0-9A-Fa-f]+\.([0-9A-Fa-f]+)/i.exec(e);t.audioProfile=t.audioProfile&&t.audioProfile[2];return t};var x=function M(e){return e.replace(/avc1\.(\d+)\.(\d+)/i,function(e){return(0,_.translateLegacyCodecs)([e])[0]})};i.mapLegacyAvcCodecs_=x;var L=function j(e,t){var i="mp2t";var r={videoCodec:"avc1",videoObjectTypeIndicator:".4d400d",audioProfile:"2"};var n=[];var a=undefined;var s=null;if(!t){return[]}if(t.segments&&t.segments.length&&t.segments[0].map){i="mp4"}a=t.attributes||{};if(a.CODECS){(function(){var e=E(a.CODECS);Object.keys(e).forEach(function(t){r[t]=e[t]||r[t]})})()}if(e.mediaGroups.AUDIO){n=e.mediaGroups.AUDIO[a.AUDIO]}for(var o in n){if(s&&!!n[o].uri!==!!s.uri){return["video/"+i+'; codecs="'+r.videoCodec+r.videoObjectTypeIndicator+", mp4a.40."+r.audioProfile+'"',"audio/"+i+'; codecs="mp4a.40.'+r.audioProfile+'"']}s=n[o]}if(s&&s.uri){return["video/"+i+'; codecs="'+r.videoCodec+r.videoObjectTypeIndicator+'"',"audio/"+i+'; codecs="mp4a.40.'+r.audioProfile+'"']}return["video/"+i+'; codecs="'+r.videoCodec+r.videoObjectTypeIndicator+", mp4a.40."+r.audioProfile+'"']};i.mimeTypesForPlaylist_=L;var I=function(e){o(t,e);function t(e){var i=this;s(this,t);n(Object.getPrototypeOf(t.prototype),"constructor",this).call(this);var r=e.url;var a=e.withCredentials;var o=e.mode;var u=e.tech;var d=e.bandwidth;var c=e.externHls;var h=e.useCueTags;if(!r){throw new Error("A non-empty playlist URL is required")}P=c;this.withCredentials=a;this.tech_=u;this.hls_=u.hls;this.mode_=o;this.useCueTags_=h;if(this.useCueTags_){this.cueTagsTrack_=this.tech_.addTextTrack("metadata","ad-cues");this.cueTagsTrack_.inBandMetadataTrackDispatchType=""}this.audioTracks_=[];this.requestOptions_={withCredentials:this.withCredentials,timeout:null};this.audioGroups_={};this.mediaSource=new m["default"].MediaSource({mode:o});this.audioinfo_=null;this.mediaSource.on("audioinfo",this.handleAudioinfoUpdate_.bind(this));this.mediaSource.addEventListener("sourceopen",this.handleSourceOpen_.bind(this));this.seekable_=m["default"].createTimeRanges();this.hasPlayed_=function(){return false};this.syncController_=new b["default"];this.decrypter_=(0,w["default"])(k["default"]);var p={hls:this.hls_,mediaSource:this.mediaSource,currentTime:this.tech_.currentTime.bind(this.tech_),seekable:function v(){return i.seekable()},seeking:function y(){return i.tech_.seeking()},setCurrentTime:function g(e){return i.tech_.setCurrentTime(e)},hasPlayed:function _(){return i.hasPlayed_()},bandwidth:d,syncController:this.syncController_,decrypter:this.decrypter_,loaderType:"main"};this.masterPlaylistLoader_=new f["default"](r,this.hls_,this.withCredentials);this.setupMasterPlaylistLoaderListeners_();this.audioPlaylistLoader_=null;this.mainSegmentLoader_=new l["default"](p);p.loaderType="audio";this.audioSegmentLoader_=new l["default"](p);this.decrypter_.onmessage=function(e){if(e.data.source==="main"){i.mainSegmentLoader_.handleDecrypted_(e.data)}else if(e.data.source==="audio"){i.audioSegmentLoader_.handleDecrypted_(e.data)}};this.setupSegmentLoaderListeners_();this.masterPlaylistLoader_.start()}r(t,[{key:"setupMasterPlaylistLoaderListeners_",value:function i(){var e=this;this.masterPlaylistLoader_.on("loadedmetadata",function(){var t=e.masterPlaylistLoader_.media();var i=e.masterPlaylistLoader_.targetDuration*1.5*1e3;e.requestOptions_.timeout=i;if(t.endList&&e.tech_.preload()!=="none"){e.mainSegmentLoader_.playlist(t,e.requestOptions_);e.mainSegmentLoader_.load()}e.fillAudioTracks_();e.setupAudio();try{e.setupSourceBuffers_()}catch(r){m["default"].log.warn("Failed to create SourceBuffers",r);return e.mediaSource.endOfStream("decode")}e.setupFirstPlay();e.trigger("audioupdate");e.trigger("selectedinitialmedia")});this.masterPlaylistLoader_.on("loadedplaylist",function(){var t=e.masterPlaylistLoader_.media();if(!t){e.initialMedia_=e.selectPlaylist();e.masterPlaylistLoader_.media(e.initialMedia_);return}if(e.useCueTags_){e.updateAdCues_(t)}e.mainSegmentLoader_.playlist(t,e.requestOptions_);e.updateDuration();if(!t.endList){(function(){var t=function i(){var t=e.seekable();if(t.length!==0){e.mediaSource.addSeekableRange_(t.start(0),t.end(0))}};if(e.duration()!==Infinity){(function(){var i=function r(){if(e.duration()===Infinity){t()}else{e.tech_.one("durationchange",r)}};e.tech_.one("durationchange",i)})()}else{t()}})()}});this.masterPlaylistLoader_.on("error",function(){e.blacklistCurrentPlaylist(e.masterPlaylistLoader_.error)});this.masterPlaylistLoader_.on("mediachanging",function(){e.mainSegmentLoader_.abort();e.mainSegmentLoader_.pause()});this.masterPlaylistLoader_.on("mediachange",function(){var t=e.masterPlaylistLoader_.media();var i=e.masterPlaylistLoader_.targetDuration*1.5*1e3;var r=undefined;var n=undefined;if(e.masterPlaylistLoader_.isLowestEnabledRendition_()){e.requestOptions_.timeout=0}else{e.requestOptions_.timeout=i}e.mainSegmentLoader_.playlist(t,e.requestOptions_);e.mainSegmentLoader_.load();r=e.activeAudioGroup();n=r.filter(function(e){return e.enabled})[0];if(!n){e.setupAudio();e.trigger("audioupdate")}e.tech_.trigger({type:"mediachange",bubbles:true})})}},{key:"setupSegmentLoaderListeners_",value:function a(){var e=this;this.mainSegmentLoader_.on("progress",function(){e.masterPlaylistLoader_.media(e.selectPlaylist());e.trigger("progress")});this.mainSegmentLoader_.on("error",function(){e.blacklistCurrentPlaylist(e.mainSegmentLoader_.error())});this.mainSegmentLoader_.on("syncinfoupdate",function(){e.onSyncInfoUpdate_()});this.audioSegmentLoader_.on("syncinfoupdate",function(){e.onSyncInfoUpdate_()});this.audioSegmentLoader_.on("error",function(){m["default"].log.warn("Problem encountered with the current alternate audio track"+". Switching back to default.");e.audioSegmentLoader_.abort();e.audioPlaylistLoader_=null;e.setupAudio()})}},{key:"handleAudioinfoUpdate_",value:function u(e){if(P.supportsAudioInfoChange_()||!this.audioInfo_||!A(this.audioInfo_,e.info)){this.audioInfo_=e.info;return}var t="had different audio properties (channels, sample rate, etc.) "+"or changed in some other way.  This behavior is currently "+"unsupported in Firefox 48 and below due to an issue: \n\n"+"https://bugzilla.mozilla.org/show_bug.cgi?id=1247138\n\n";var i=this.activeAudioGroup().map(function(e){return e.enabled}).indexOf(true);var r=this.activeAudioGroup()[i];var n=this.activeAudioGroup().filter(function(e){return e.properties_&&e.properties_["default"]})[0];if(!this.audioPlaylistLoader_){t="The rendition that we tried to switch to "+t+"Unfortunately that means we will have to blacklist "+"the current playlist and switch to another. Sorry!";this.blacklistCurrentPlaylist()}else{t="The audio track '"+r.label+"' that we tried to "+("switch to "+t+" Unfortunately this means we will have to ")+("return you to the main track '"+n.label+"'. Sorry!");n.enabled=true;this.activeAudioGroup().splice(i,1);this.trigger("audioupdate")}m["default"].log.warn(t);this.setupAudio()}},{key:"mediaRequests_",value:function d(){return this.audioSegmentLoader_.mediaRequests+this.mainSegmentLoader_.mediaRequests}},{key:"mediaTransferDuration_",value:function c(){return this.audioSegmentLoader_.mediaTransferDuration+this.mainSegmentLoader_.mediaTransferDuration}},{key:"mediaBytesTransferred_",value:function p(){return this.audioSegmentLoader_.mediaBytesTransferred+this.mainSegmentLoader_.mediaBytesTransferred}},{key:"mediaSecondsLoaded_",value:function v(){return Math.max(this.audioSegmentLoader_.mediaSecondsLoaded+this.mainSegmentLoader_.mediaSecondsLoaded)}},{key:"fillAudioTracks_",value:function g(){var e=this.master();var t=e.mediaGroups||{};if(!t||!t.AUDIO||Object.keys(t.AUDIO).length===0||this.mode_!=="html5"){t.AUDIO={main:{"default":{"default":true}}}}for(var i in t.AUDIO){if(!this.audioGroups_[i]){this.audioGroups_[i]=[]}for(var r in t.AUDIO[i]){var n=t.AUDIO[i][r];var a=new m["default"].AudioTrack({id:r,kind:n["default"]?"main":"alternative",enabled:false,language:n.language,label:r});a.properties_=n;this.audioGroups_[i].push(a)}}(this.activeAudioGroup().filter(function(e){return e.properties_["default"]})[0]||this.activeAudioGroup()[0]).enabled=true}},{key:"load",value:function _(){this.mainSegmentLoader_.load();if(this.audioPlaylistLoader_){this.audioSegmentLoader_.load()}}},{key:"activeAudioGroup",value:function T(){var e=this.masterPlaylistLoader_.media();var t=undefined;if(e.attributes&&e.attributes.AUDIO){t=this.audioGroups_[e.attributes.AUDIO]}return t||this.audioGroups_.main}},{key:"setupAudio",value:function S(){var e=this;var t=this.activeAudioGroup();var i=t.filter(function(e){return e.enabled})[0];if(!i){i=t.filter(function(e){return e.properties_["default"]})[0]||t[0];i.enabled=true}if(this.audioPlaylistLoader_){this.audioPlaylistLoader_.dispose();this.audioPlaylistLoader_=null}this.audioSegmentLoader_.pause();if(!i.properties_.resolvedUri){this.mainSegmentLoader_.resetEverything();return}this.audioSegmentLoader_.resetEverything();this.audioPlaylistLoader_=new f["default"](i.properties_.resolvedUri,this.hls_,this.withCredentials);this.audioPlaylistLoader_.start();this.audioPlaylistLoader_.on("loadedmetadata",function(){var t=e.audioPlaylistLoader_.media();e.audioSegmentLoader_.playlist(t,e.requestOptions_);if(!e.tech_.paused()||t.endList&&e.tech_.preload()!=="none"){e.audioSegmentLoader_.load()}if(!t.endList){e.audioPlaylistLoader_.trigger("firstplay")}});this.audioPlaylistLoader_.on("loadedplaylist",function(){var t=undefined;if(e.audioPlaylistLoader_){t=e.audioPlaylistLoader_.media()}if(!t){e.audioPlaylistLoader_.media(e.audioPlaylistLoader_.playlists.master.playlists[0]);return}e.audioSegmentLoader_.playlist(t,e.requestOptions_)});this.audioPlaylistLoader_.on("error",function(){m["default"].log.warn("Problem encountered loading the alternate audio track"+". Switching back to default.");e.audioSegmentLoader_.abort();e.setupAudio()})}},{key:"fastQualityChange_",value:function I(){var e=this.selectPlaylist();if(e!==this.masterPlaylistLoader_.media()){this.masterPlaylistLoader_.media(e);this.mainSegmentLoader_.resetLoader();if(this.audiosegmentloader_){this.audioSegmentLoader_.resetLoader()}}}},{key:"play",value:function C(){if(this.setupFirstPlay()){return}if(this.tech_.ended()){this.tech_.setCurrentTime(0)}if(this.hasPlayed_()){this.load()}if(this.tech_.duration()===Infinity){if(this.tech_.currentTime()<this.tech_.seekable().start(0)){return this.tech_.setCurrentTime(this.tech_.seekable().start(0))}}}},{key:"setupFirstPlay",value:function U(){var e=undefined;var t=this.masterPlaylistLoader_.media();if(t&&!this.tech_.paused()&&!this.hasPlayed_()){if(!t.endList){this.trigger("firstplay");e=this.seekable();if(e.length){this.tech_.setCurrentTime(e.end(0))}}this.hasPlayed_=function(){return true};this.load();return true}return false}},{key:"handleSourceOpen_",value:function D(){try{this.setupSourceBuffers_()}catch(e){m["default"].log.warn("Failed to create Source Buffers",e);return this.mediaSource.endOfStream("decode")}if(this.tech_.autoplay()){this.tech_.play()}this.trigger("sourceopen")}},{key:"blacklistCurrentPlaylist",value:function M(){var e=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];var t=undefined;var i=undefined;t=e.playlist||this.masterPlaylistLoader_.media();if(!t){this.error=e;return this.mediaSource.endOfStream("network")}t.excludeUntil=Date.now()+O;i=this.selectPlaylist();if(i){m["default"].log.warn("Problem encountered with the current "+"HLS playlist. Switching to another playlist.");return this.masterPlaylistLoader_.media(i)}m["default"].log.warn("Problem encountered with the current "+"HLS playlist. No suitable alternatives found.");this.error=e;return this.mediaSource.endOfStream("network")}},{key:"pauseLoading",value:function j(){this.mainSegmentLoader_.pause();if(this.audioPlaylistLoader_){this.audioSegmentLoader_.pause()}}},{key:"setCurrentTime",value:function B(e){var t=h["default"].findRange(this.tech_.buffered(),e);if(!(this.masterPlaylistLoader_&&this.masterPlaylistLoader_.media())){return 0}if(!this.masterPlaylistLoader_.media().segments){return 0}if(t&&t.length){return e}this.mainSegmentLoader_.resetEverything();this.mainSegmentLoader_.abort();if(this.audioPlaylistLoader_){this.audioSegmentLoader_.resetEverything();this.audioSegmentLoader_.abort()}if(!this.tech_.paused()){this.mainSegmentLoader_.load();if(this.audioPlaylistLoader_){this.audioSegmentLoader_.load()}}}},{key:"duration",value:function R(){if(!this.masterPlaylistLoader_){return 0}if(this.mediaSource){return this.mediaSource.duration}return P.Playlist.duration(this.masterPlaylistLoader_.media())}},{key:"seekable",value:function N(){return this.seekable_}},{key:"onSyncInfoUpdate_",value:function F(){var e=undefined;var t=undefined;var i=undefined;if(!this.masterPlaylistLoader_){return}e=this.masterPlaylistLoader_.media();if(!e){return}t=P.Playlist.seekable(e);if(t.length===0){return}if(this.audioPlaylistLoader_){i=P.Playlist.seekable(this.audioPlaylistLoader_.media());if(i.length===0){return}}if(!i){this.seekable_=t;return}this.seekable_=m["default"].createTimeRanges([[i.start(0)>t.start(0)?i.start(0):t.start(0),i.end(0)<t.end(0)?i.end(0):t.end(0)]])}},{key:"updateDuration",value:function G(){var e=this;var t=this.mediaSource.duration;var i=P.Playlist.duration(this.masterPlaylistLoader_.media());var r=this.tech_.buffered();var n=function a(){e.mediaSource.duration=i;e.tech_.trigger("durationchange");e.mediaSource.removeEventListener("sourceopen",a)};if(r.length>0){i=Math.max(i,r.end(r.length-1))}if(t!==i){if(this.mediaSource.readyState!=="open"){this.mediaSource.addEventListener("sourceopen",n)}else{n()}}}},{key:"dispose",value:function q(){this.decrypter_.terminate();this.masterPlaylistLoader_.dispose();this.mainSegmentLoader_.dispose();if(this.audioPlaylistLoader_){this.audioPlaylistLoader_.dispose()}this.audioSegmentLoader_.dispose()}},{key:"master",value:function H(){return this.masterPlaylistLoader_.master}},{key:"media",value:function V(){return this.masterPlaylistLoader_.media()||this.initialMedia_}},{key:"setupSourceBuffers_",value:function X(){var e=this.masterPlaylistLoader_.media();var t=undefined;if(!e||this.mediaSource.readyState!=="open"){return}t=L(this.masterPlaylistLoader_.master,e);if(t.length<1){this.error="No compatible SourceBuffer configuration for the variant stream:"+e.resolvedUri;return this.mediaSource.endOfStream("decode")}this.mainSegmentLoader_.mimeType(t[0]);if(t[1]){this.audioSegmentLoader_.mimeType(t[1])}this.excludeIncompatibleVariants_(e)}},{key:"excludeIncompatibleVariants_",value:function z(e){var t=this.masterPlaylistLoader_.master;var i=2;var r=null;var n=undefined;if(e.attributes&&e.attributes.CODECS){n=E(e.attributes.CODECS);r=n.videoCodec;i=n.codecCount}t.playlists.forEach(function(e){var t={codecCount:2,videoCodec:null};if(e.attributes&&e.attributes.CODECS){var n=e.attributes.CODECS;t=E(n);if(window.MediaSource&&window.MediaSource.isTypeSupported&&!window.MediaSource.isTypeSupported('video/mp4; codecs="'+x(n)+'"')){e.excludeUntil=Infinity}}if(t.codecCount!==i){e.excludeUntil=Infinity}if(t.videoCodec!==r){e.excludeUntil=Infinity}})}},{key:"updateAdCues_",value:function W(e){var t=0;var i=this.seekable();if(i.length){t=i.start(0)}y["default"].updateAdCues(e,this.cueTagsTrack_,t)}}]);return t}(m["default"].EventTarget);i.MasterPlaylistController=I}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./ad-cue-tags":1,"./decrypter-worker":4,"./playlist-loader":7,"./ranges":9,"./segment-loader":13,"./sync-controller":16,"videojs-contrib-media-sources/es5/codec-utils":44,webworkify:77}],6:[function(e,t,i){(function(r){"use strict";Object.defineProperty(i,"__esModule",{value:true});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,i,r){if(i)e(t.prototype,i);if(r)e(t,r);return t}}();function a(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var o=e("./ranges");var u=a(o);var f=typeof window!=="undefined"?window["videojs"]:typeof r!=="undefined"?r["videojs"]:null;var d=a(f);var l=["seeking","seeked","pause","playing","error"];var c=function(){function e(t){var i=this;s(this,e);this.tech_=t.tech;this.seekable=t.seekable;this.consecutiveUpdates=0;this.lastRecordedTime=null;this.timer_=null;this.checkCurrentTimeTimeout_=null;if(t.debug){this.logger_=d["default"].log.bind(d["default"],"playback-watcher ->")}this.logger_("initialize");var r=function a(){return i.waiting_()};var n=function o(){return i.cancelTimer_()};this.tech_.on("waiting",r);this.tech_.on(l,n);this.monitorCurrentTime_();this.dispose=function(){i.logger_("dispose");i.tech_.off("waiting",r);i.tech_.off(l,n);if(i.checkCurrentTimeTimeout_){clearTimeout(i.checkCurrentTimeTimeout_)}i.cancelTimer_()}}n(e,[{key:"monitorCurrentTime_",value:function t(){this.checkCurrentTime_();if(this.checkCurrentTimeTimeout_){clearTimeout(this.checkCurrentTimeTimeout_)}this.checkCurrentTimeTimeout_=setTimeout(this.monitorCurrentTime_.bind(this),250)}},{key:"checkCurrentTime_",value:function i(){if(this.tech_.paused()||this.tech_.seeking()){return}var e=this.tech_.currentTime();if(this.consecutiveUpdates>=5&&e===this.lastRecordedTime){this.consecutiveUpdates++;this.waiting_()}else if(e===this.lastRecordedTime){this.consecutiveUpdates++}else{this.consecutiveUpdates=0;this.lastRecordedTime=e}}},{key:"cancelTimer_",value:function r(){this.consecutiveUpdates=0;if(this.timer_){this.logger_("cancelTimer_");clearTimeout(this.timer_)}this.timer_=null}},{key:"waiting_",value:function a(){var e=this.seekable();var t=this.tech_.currentTime();if(this.tech_.seeking()||this.timer_!==null){return}if(this.fellOutOfLiveWindow_(e,t)){var i=e.end(e.length-1);this.logger_("Fell out of live window at time "+t+". Seeking to "+("live point (seekable end) "+i));this.cancelTimer_();this.tech_.setCurrentTime(i);this.tech_.trigger("liveresync");return}var r=this.tech_.buffered();var n=u["default"].findNextRange(r,t);if(this.videoUnderflow_(n,r,t)){this.cancelTimer_();this.tech_.setCurrentTime(t);this.tech_.trigger("videounderflow");return}if(n.length>0){var a=n.start(0)-t;this.logger_("Stopped at "+t+", setting timer for "+a+", seeking "+("to "+n.start(0)));this.timer_=setTimeout(this.skipTheGap_.bind(this),a*1e3,t)}}},{key:"fellOutOfLiveWindow_",value:function o(e,t){if(e.length&&e.start(0)>0&&t<e.start(0)){return true}return false}},{key:"videoUnderflow_",value:function f(e,t,i){if(e.length===0){var r=this.gapFromVideoUnderflow_(t,i);if(r){this.logger_("Encountered a gap in video from "+r.start+" to "+r.end+". "+("Seeking to current time "+i));return true}}return false}},{key:"skipTheGap_",value:function c(e){var t=this.tech_.buffered();var i=this.tech_.currentTime();var r=u["default"].findNextRange(t,i);this.cancelTimer_();if(r.length===0||i!==e){return}this.logger_("skipTheGap_:","currentTime:",i,"scheduled currentTime:",e,"nextRange start:",r.start(0));this.tech_.setCurrentTime(r.start(0)+u["default"].TIME_FUDGE_FACTOR)}},{key:"gapFromVideoUnderflow_",value:function h(e,t){var i=u["default"].findGaps(e);for(var r=0;r<i.length;r++){var n=i.start(r);var a=i.end(r);if(t-n<4&&t-n>2){return{start:n,end:a}}}return null}},{key:"logger_",value:function p(){}}]);return e}();i["default"]=c;t.exports=i["default"]}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./ranges":9}],7:[function(e,t,i){(function(r){"use strict";Object.defineProperty(i,"__esModule",{value:true});function n(e){return e&&e.__esModule?e:{"default":e}}var a=e("./resolve-url");var s=n(a);var o=typeof window!=="undefined"?window["videojs"]:typeof r!=="undefined"?r["videojs"]:null;var u=e("./playlist.js");var f=e("./stream");var d=n(f);var l=e("m3u8-parser");var c=n(l);var h=e("global/window");var p=n(h);var m=function g(e,t,i){var r=t.slice();var n=undefined;var a=undefined;i=i||0;n=Math.min(e.length,t.length+i);for(a=i;a<n;a++){r[a-i]=(0,o.mergeOptions)(e[a],r[a-i])}return r};var v=function b(e,t){var i=false;var r=(0,o.mergeOptions)(e,{});var n=e.playlists.length;var a=undefined;var u=undefined;var f=undefined;while(n--){a=r.playlists[n];if(a.uri===t.uri){if(a.segments&&t.segments&&a.segments.length===t.segments.length&&a.mediaSequence===t.mediaSequence){continue}r.playlists[n]=(0,o.mergeOptions)(a,t);r.playlists[t.uri]=r.playlists[n];if(a.segments){r.playlists[n].segments=m(a.segments,t.segments,t.mediaSequence-a.mediaSequence)}f=0;if(r.playlists[n].segments){f=r.playlists[n].segments.length}while(f--){u=r.playlists[n].segments[f];if(!u.resolvedUri){u.resolvedUri=(0,s["default"])(a.resolvedUri,u.uri)}if(u.key&&!u.key.resolvedUri){u.key.resolvedUri=(0,s["default"])(a.resolvedUri,u.key.uri)}if(u.map&&!u.map.resolvedUri){u.map.resolvedUri=(0,s["default"])(a.resolvedUri,u.map.uri)}}i=true}}return i?r:null};var y=function _(e,t,i){var r=this;var n=this;var a=undefined;var o=undefined;var f=undefined;var d=undefined;var l=undefined;_.prototype.constructor.call(this);this.hls_=t;if(!e){throw new Error("A non-empty playlist URL is required")}d=function(e,t,i){n.setBandwidth(f||e);f=null;if(i){n.state=i}n.error={playlist:n.master.playlists[t],status:e.status,message:"HLS playlist request error at URL: "+t,responseText:e.responseText,code:e.status>=500?4:2};n.trigger("error")};l=function(e,t){var i=undefined;var r=undefined;var a=undefined;n.setBandwidth(f||e);f=null;n.state="HAVE_METADATA";i=new c["default"].Parser;i.push(e.responseText);i.end();i.manifest.uri=t;a=v(n.master,i.manifest);r=(i.manifest.targetDuration||10)*1e3;n.targetDuration=i.manifest.targetDuration;if(a){n.master=a;n.media_=n.master.playlists[i.manifest.uri]}else{r/=2}if(!n.media().endList){p["default"].clearTimeout(o);o=p["default"].setTimeout(function(){n.trigger("mediaupdatetimeout")},r)}n.trigger("loadedplaylist")};n.state="HAVE_NOTHING";a=this.dispose;n.dispose=function(){n.stopRequest();p["default"].clearTimeout(o);a.call(this)};n.stopRequest=function(){if(f){var e=f;f=null;e.onreadystatechange=null;e.abort()}};n.enabledPlaylists_=function(){return n.master.playlists.filter(u.isEnabled).length};n.isLowestEnabledRendition_=function(){var e=n.media();if(!e||!e.attributes){return false}var t=n.media().attributes.BANDWIDTH||0;return!(n.master.playlists.filter(function(e){var i=(0,u.isEnabled)(e);if(!i){return false}var r=0;if(e&&e.attributes){r=e.attributes.BANDWIDTH}return r<=t}).length>1)};n.media=function(e){var t=n.state;var r=undefined;if(!e){return n.media_}if(n.state==="HAVE_NOTHING"){throw new Error("Cannot switch media playlist from "+n.state)}if(typeof e==="string"){if(!n.master.playlists[e]){throw new Error("Unknown playlist URI: "+e)}e=n.master.playlists[e]}r=!n.media_||e.uri!==n.media_.uri;if(n.master.playlists[e.uri].endList){if(f){f.onreadystatechange=null;f.abort();f=null}n.state="HAVE_METADATA";n.media_=e;if(r){n.trigger("mediachanging");n.trigger("mediachange")}return}if(!r){return}n.state="SWITCHING_MEDIA";if(f){if((0,s["default"])(n.master.uri,e.uri)===f.url){return}f.onreadystatechange=null;f.abort();f=null}if(this.media_){this.trigger("mediachanging")}f=this.hls_.xhr({uri:(0,s["default"])(n.master.uri,e.uri),withCredentials:i},function(i,r){if(!f){return}if(i){return d(f,e.uri,t)}l(r,e.uri);if(t==="HAVE_MASTER"){n.trigger("loadedmetadata")}else{n.trigger("mediachange")}})};n.setBandwidth=function(e){n.bandwidth=e.bandwidth};n.on("mediaupdatetimeout",function(){if(n.state!=="HAVE_METADATA"){return}n.state="HAVE_CURRENT_METADATA";f=this.hls_.xhr({uri:(0,s["default"])(n.master.uri,n.media().uri),withCredentials:i},function(e,t){if(!f){return}if(e){return d(f,n.media().uri)}l(f,n.media().uri)})});n.on("firstplay",function(){var e=n.media();if(e){e.syncInfo={mediaSequence:e.mediaSequence,time:0}}});n.pause=function(){n.stopRequest();p["default"].clearTimeout(o)};n.load=function(){if(n.started){if(!n.media().endList){n.trigger("mediaupdatetimeout")}else{n.trigger("loadedplaylist")}}else{n.start()}};n.start=function(){n.started=true;f=r.hls_.xhr({uri:e,withCredentials:i},function(t,i){var r=undefined;var a=undefined;var o=undefined;if(!f){return}f=null;if(t){n.error={status:i.status,message:"HLS playlist request error at URL: "+e,responseText:i.responseText,code:2};return n.trigger("error")}r=new c["default"].Parser;r.push(i.responseText);r.end();n.state="HAVE_MASTER";r.manifest.uri=e;if(r.manifest.playlists){n.master=r.manifest;o=n.master.playlists.length;while(o--){a=n.master.playlists[o];n.master.playlists[a.uri]=a;a.resolvedUri=(0,s["default"])(n.master.uri,a.uri)}for(var u in n.master.mediaGroups.AUDIO){for(var d in n.master.mediaGroups.AUDIO[u]){var h=n.master.mediaGroups.AUDIO[u][d];if(h.uri){h.resolvedUri=(0,s["default"])(n.master.uri,h.uri)}}}n.trigger("loadedplaylist");if(!f){n.media(r.manifest.playlists[0])}return}n.master={mediaGroups:{AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},uri:p["default"].location.href,playlists:[{uri:e}]};n.master.playlists[e]=n.master.playlists[0];n.master.playlists[0].resolvedUri=e;l(i,e);return n.trigger("loadedmetadata")})}};y.prototype=new d["default"];i["default"]=y;t.exports=i["default"]}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./playlist.js":8,"./resolve-url":12,"./stream":15,"global/window":28,"m3u8-parser":29}],8:[function(e,t,i){
(function(t){"use strict";Object.defineProperty(i,"__esModule",{value:true});function r(e){return e&&e.__esModule?e:{"default":e}}var n=typeof window!=="undefined"?window["videojs"]:typeof t!=="undefined"?t["videojs"]:null;var a=e("global/window");var s=r(a);var o={UNSAFE_LIVE_SEGMENTS:3};var u=function S(e,t){var i=0;var r=t-e.mediaSequence;var n=e.segments[r];if(n){if(typeof n.start!=="undefined"){return{result:n.start,precise:true}}if(typeof n.end!=="undefined"){return{result:n.end-n.duration,precise:true}}}while(r--){n=e.segments[r];if(typeof n.end!=="undefined"){return{result:i+n.end,precise:true}}i+=n.duration;if(typeof n.start!=="undefined"){return{result:i+n.start,precise:true}}}return{result:i,precise:false}};var f=function k(e,t){var i=0;var r=undefined;var n=t-e.mediaSequence;for(;n<e.segments.length;n++){r=e.segments[n];if(typeof r.start!=="undefined"){return{result:r.start-i,precise:true}}i+=r.duration;if(typeof r.end!=="undefined"){return{result:r.end-i,precise:true}}}return{result:-1,precise:false}};var d=function O(e,t,i){var r=undefined;var n=undefined;if(typeof t==="undefined"){t=e.mediaSequence+e.segments.length}if(t<e.mediaSequence){return 0}r=u(e,t);if(r.precise){return r.result}n=f(e,t);if(n.precise){return n.result}return r.result+i};var l=function P(e,t,i){if(!e){return 0}if(typeof i!=="number"){i=0}if(typeof t==="undefined"){if(e.totalDuration){return e.totalDuration}if(!e.endList){return s["default"].Infinity}}return d(e,t,i)};i.duration=l;var c=function A(e,t,i){var r=0;if(t>i){var n=[i,t];t=n[0];i=n[1]}if(t<0){for(var a=t;a<Math.min(0,i);a++){r+=e.targetDuration}t=0}for(var a=t;a<i;a++){r+=e.segments[a].duration}return r};i.sumDurations=c;var h=function E(e){if(!e||!e.segments){return[null,null]}var t=e.syncInfo||null;var i=null;for(var r=0,n=e.segments.length;r<n;r++){var a=e.segments[r];if(typeof a.start!=="undefined"){i={mediaSequence:e.mediaSequence+r,time:a.start};break}}return{expiredSync:t,segmentSync:i}};var p=function x(e,t,i){if(t&&i){var r=t.mediaSequence-e.mediaSequence;var n=i.mediaSequence-e.mediaSequence;var a=undefined;var s=undefined;if(Math.abs(r)>Math.abs(n)){a=n;s=-i.time}else{a=r;s=t.time}return Math.abs(s+c(e,a,0))}if(t){var a=t.mediaSequence-e.mediaSequence;return t.time+c(e,a,0)}if(i){var a=i.mediaSequence-e.mediaSequence;return i.time-c(e,a,0)}};var m=function L(e){if(!e||!e.segments){return(0,n.createTimeRange)()}if(e.endList){return(0,n.createTimeRange)(0,l(e))}var t=h(e);var i=t.expiredSync;var r=t.segmentSync;if(!i&&!r){return(0,n.createTimeRange)()}var a=p(e,i,r);var s=a;var u=Math.max(0,e.segments.length-o.UNSAFE_LIVE_SEGMENTS);var f=d(e,e.mediaSequence+u,a);return(0,n.createTimeRange)(s,f)};i.seekable=m;var v=function I(e){return e-Math.floor(e)===0};var y=function C(e,t){if(v(t)){return t+e*.1}var i=t.toString().split(".")[1].length;for(var r=1;r<=i;r++){var n=Math.pow(10,r);var a=t*n;if(v(a)||r===i){return(a+e)/n}}};var g=y.bind(null,1);var b=y.bind(null,-1);var _=function U(e,t,i,r){var n=undefined;var a=undefined;var s=e.segments.length;var o=t-r;if(o<0){if(i>0){for(n=i-1;n>=0;n--){a=e.segments[n];o+=b(a.duration);if(o>0){return{mediaIndex:n,startTime:r-c(e,i,n)}}}}return{mediaIndex:0,startTime:t}}if(i<0){for(n=i;n<0;n++){o-=e.targetDuration;if(o<0){return{mediaIndex:0,startTime:t}}}i=0}for(n=i;n<s;n++){a=e.segments[n];o-=g(a.duration);if(o<0){return{mediaIndex:n,startTime:r+c(e,i,n)}}}return{mediaIndex:s-1,startTime:t}};i.getMediaInfoForTime_=_;var T=function D(e){return e.excludeUntil&&e.excludeUntil>Date.now()};i.isBlacklisted=T;var w=function M(e){var t=T(e);return!e.disabled&&!t};i.isEnabled=w;o.duration=l;o.seekable=m;o.getMediaInfoForTime_=_;o.isEnabled=w;o.isBlacklisted=T;i["default"]=o}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"global/window":28}],9:[function(e,t,i){(function(e){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function e(e,t){var i=[];var r=true;var n=false;var a=undefined;try{for(var s=e[Symbol.iterator](),o;!(r=(o=s.next()).done);r=true){i.push(o.value);if(t&&i.length===t)break}}catch(u){n=true;a=u}finally{try{if(!r&&s["return"])s["return"]()}finally{if(n)throw a}}return i}return function(t,i){if(Array.isArray(t)){return t}else if(Symbol.iterator in Object(t)){return e(t,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();function n(e){return e&&e.__esModule?e:{"default":e}}var a=typeof window!=="undefined"?window["videojs"]:typeof e!=="undefined"?e["videojs"]:null;var s=n(a);var o=1/30;var u=function y(e,t){var i=r(t,2);var n=i[0];var a=i[1];return Math.min(Math.max(n,e),a)};var f=function g(e,t){var i=[];var r=undefined;if(e&&e.length){for(r=0;r<e.length;r++){if(t(e.start(r),e.end(r))){i.push([e.start(r),e.end(r)])}}}return s["default"].createTimeRanges(i)};var d=function b(e,t){return f(e,function(e,i){return e-o<=t&&i+o>=t})};var l=function _(e,t){return f(e,function(e){return e-o>=t})};var c=function T(e){if(e.length<2){return s["default"].createTimeRanges()}var t=[];for(var i=1;i<e.length;i++){var r=e.end(i-1);var n=e.start(i);t.push([r,n])}return s["default"].createTimeRanges(t)};var h=function w(e,t){var i=undefined;var r=undefined;var n=undefined;var a=[];var s=[];var o=function u(e){return e[0]<=n&&e[1]>=n};if(e){for(i=0;i<e.length;i++){r=e.start(i);n=e.end(i);s.push([r,n])}}if(t){for(i=0;i<t.length;i++){r=t.start(i);n=t.end(i);if(s.some(o)){continue}a.push(n)}}if(a.length!==1){return null}return a[0]};var p=function S(e,t){var i=null;var r=null;var n=0;var a=[];var o=[];if(!e||!e.length||!t||!t.length){return s["default"].createTimeRange()}var u=e.length;while(u--){a.push({time:e.start(u),type:"start"});a.push({time:e.end(u),type:"end"})}u=t.length;while(u--){a.push({time:t.start(u),type:"start"});a.push({time:t.end(u),type:"end"})}a.sort(function(e,t){return e.time-t.time});for(u=0;u<a.length;u++){if(a[u].type==="start"){n++;if(n===2){i=a[u].time}}else if(a[u].type==="end"){n--;if(n===1){r=a[u].time}}if(i!==null&&r!==null){o.push([i,r]);i=null;r=null}}return s["default"].createTimeRanges(o)};var m=function k(e,t,i,r){var n=t.end(0)-t.start(0);var a=e.end(0)-e.start(0);var s=n-a;var o=p(e,r);var u=p(t,r);var f=0;var d=0;var l=o.length;while(l--){f+=o.end(l)-o.start(l);if(o.start(l)===i){f+=s}}l=u.length;while(l--){d+=u.end(l)-u.start(l)}return Math.max(f,d)/n*100};var v=function O(e,t,i,r){var n=e+t;var a=s["default"].createTimeRanges([[e,n]]);var o=s["default"].createTimeRanges([[u(e,[i,n]),n]]);if(o.start(0)===o.end(0)){return 0}var f=m(o,a,i,r);if(isNaN(f)||f===Infinity||f===-Infinity){return 0}return f};i["default"]={findRange:d,findNextRange:l,findGaps:c,findSoleUncommonTimeRangesEnd:h,getSegmentBufferedPercent:v,TIME_FUDGE_FACTOR:o};t.exports=i["default"]}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],10:[function(e,t,i){(function(e){"use strict";Object.defineProperty(i,"__esModule",{value:true});function r(e){return e&&e.__esModule?e:{"default":e}}var n=typeof window!=="undefined"?window["videojs"]:typeof e!=="undefined"?e["videojs"]:null;var a=r(n);var s={errorInterval:30,getSource:function f(e){var t=this.tech({IWillNotUseThisInPlugins:true});var i=t.currentSource_;return e(i)}};var o=function d(e,t){var i=0;var r=0;var n=a["default"].mergeOptions(s,t);var o=function h(){if(r){e.currentTime(r)}};var u=function p(t){if(t===null||t===undefined){return}r=e.duration()!==Infinity&&e.currentTime()||0;e.one("loadedmetadata",o);e.src(t);e.play()};var f=function m(){if(Date.now()-i<n.errorInterval*1e3){return}if(!n.getSource||typeof n.getSource!=="function"){a["default"].log.error("ERROR: reloadSourceOnError - The option getSource must be a function!");return}i=Date.now();return n.getSource.call(e,u)};var l=function v(){e.off("loadedmetadata",o);e.off("error",f);e.off("dispose",v)};var c=function y(t){l();d(e,t)};e.on("error",f);e.on("dispose",l);e.reloadSourceOnError=c};var u=function l(e){o(this,e)};i["default"]=u;t.exports=i["default"]}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],11:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});function r(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var n=e("./playlist.js");var a=function u(e,t,i,r){var a=e.master.playlists[t];var s=(0,n.isBlacklisted)(a);var o=(0,n.isEnabled)(a);if(typeof r==="undefined"){return o}if(r){delete a.disabled}else{a.disabled=true}if(r!==o&&!s){i()}return r};var s=function f(e,t,i){r(this,f);var n=e.masterPlaylistController_.fastQualityChange_.bind(e.masterPlaylistController_);if(t.attributes){var s=t.attributes;if(s.RESOLUTION){var o=s.RESOLUTION;this.width=o.width;this.height=o.height}this.bandwidth=s.BANDWIDTH}this.id=i;this.enabled=a.bind(this,e.playlists,t.uri,n)};var o=function d(e){var t=e.playlists;e.representations=function(){return t.master.playlists.filter(function(e){return!(0,n.isBlacklisted)(e)}).map(function(t,i){return new s(e,t,t.uri)})}};i["default"]=o;t.exports=i["default"]},{"./playlist.js":8}],12:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});function r(e){return e&&e.__esModule?e:{"default":e}}var n=e("url-toolkit");var a=r(n);var s=e("global/window");var o=r(s);var u=function f(e,t){if(/^[a-z]+:/i.test(t)){return t}if(!/\/\//i.test(e)){e=a["default"].buildAbsoluteURL(o["default"].location.href,e)}return a["default"].buildAbsoluteURL(e,t)};i["default"]=u;t.exports=i["default"]},{"global/window":28,"url-toolkit":41}],13:[function(e,t,i){(function(r){"use strict";Object.defineProperty(i,"__esModule",{value:true});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,i,r){if(i)e(t.prototype,i);if(r)e(t,r);return t}}();var a=function A(e,t,i){var r=true;e:while(r){var n=e,a=t,s=i;r=false;if(n===null)n=Function.prototype;var o=Object.getOwnPropertyDescriptor(n,a);if(o===undefined){var u=Object.getPrototypeOf(n);if(u===null){return undefined}else{e=u;t=a;i=s;r=true;o=u=undefined;continue e}}else if("value"in o){return o.value}else{var f=o.get;if(f===undefined){return undefined}return f.call(s)}}};function s(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function u(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var f=e("./playlist");var d=typeof window!=="undefined"?window["videojs"]:typeof r!=="undefined"?r["videojs"]:null;var l=s(d);var c=e("./source-updater");var h=s(c);var p=e("./config");var m=s(p);var v=e("global/window");var y=s(v);var g=e("./bin-utils");var b=500;var _="console";var T=function E(){if(y["default"].logit){y["default"][_].log.apply(y["default"][_],arguments)}};var w=function x(e,t,i){if(!e){return false}var r=e.segments;var n=i===r.length;return e.endList&&t.readyState==="open"&&n};var S=function L(e){var t=undefined;var i=undefined;i=e.offset+e.length-1;t=e.offset;return"bytes="+t+"-"+i};var k=function I(e){var t={};if("byterange"in e){t.Range=S(e.byterange)}return t};var O=function C(e){var t=e.byterange||{length:Infinity,offset:0};return[t.length,t.offset,e.resolvedUri].join(",")};var P=function(e){u(t,e);function t(e){var i=this;o(this,t);a(Object.getPrototypeOf(t.prototype),"constructor",this).call(this);var r=undefined;if(!e){throw new TypeError("Initialization options are required")}if(typeof e.currentTime!=="function"){throw new TypeError("No currentTime getter specified")}if(!e.mediaSource){throw new TypeError("No MediaSource specified")}r=l["default"].mergeOptions(l["default"].options.hls,e);this.state="INIT";this.bandwidth=r.bandwidth;this.throughput={rate:0,count:0};this.roundTrip=NaN;this.resetStats_();this.mediaIndex=null;this.hasPlayed_=r.hasPlayed;this.currentTime_=r.currentTime;this.seekable_=r.seekable;this.seeking_=r.seeking;this.setCurrentTime_=r.setCurrentTime;this.mediaSource_=r.mediaSource;this.hls_=r.hls;this.loaderType_=r.loaderType;this.checkBufferTimeout_=null;this.error_=void 0;this.currentTimeline_=-1;this.xhr_=null;this.pendingSegment_=null;this.mimeType_=null;this.sourceUpdater_=null;this.xhrOptions_=null;this.activeInitSegmentId_=null;this.initSegments_={};this.decrypter_=r.decrypter;this.syncController_=r.syncController;this.syncPoint_={segmentIndex:0,time:0};this.syncController_.on("syncinfoupdate",function(){return i.trigger("syncinfoupdate")});this.fetchAtBuffer_=false}n(t,[{key:"resetStats_",value:function i(){this.mediaBytesTransferred=0;this.mediaRequests=0;this.mediaTransferDuration=0;this.mediaSecondsLoaded=0}},{key:"dispose",value:function r(){this.state="DISPOSED";this.abort_();if(this.sourceUpdater_){this.sourceUpdater_.dispose()}this.resetStats_()}},{key:"abort",value:function s(){if(this.state!=="WAITING"){if(this.pendingSegment_){this.pendingSegment_=null}return}this.abort_();if(!this.paused()){this.state="READY";this.monitorBuffer_()}}},{key:"error",value:function d(e){if(typeof e!=="undefined"){this.error_=e}this.pendingSegment_=null;return this.error_}},{key:"load",value:function c(){this.monitorBuffer_();if(!this.playlist_){return}this.syncController_.setDateTimeMapping(this.playlist_);if(this.state==="INIT"&&this.mimeType_){return this.init_()}if(!this.sourceUpdater_||this.state!=="READY"&&this.state!=="INIT"){return}this.state="READY"}},{key:"playlist",value:function p(e){var t=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];if(!e){return}var i=this.playlist_;var r=this.pendingSegment_;this.playlist_=e;this.xhrOptions_=t;if(!this.hasPlayed_()){e.syncInfo={mediaSequence:e.mediaSequence,time:0};this.trigger("syncinfoupdate")}if(this.mimeType_&&this.state==="INIT"&&!this.paused()){return this.init_()}if(!i||i.uri!==e.uri){if(this.mediaIndex!==null){this.resyncLoader()}return}var n=e.mediaSequence-i.mediaSequence;T("mediaSequenceDiff",n);if(this.mediaIndex!==null){this.mediaIndex-=n}if(r){r.mediaIndex-=n;if(r.mediaIndex>=0){r.segment=e.segments[r.mediaIndex]}}this.syncController_.saveExpiredSegmentInfo(i,e)}},{key:"pause",value:function v(){if(this.checkBufferTimeout_){y["default"].clearTimeout(this.checkBufferTimeout_);this.checkBufferTimeout_=null}}},{key:"paused",value:function _(){return this.checkBufferTimeout_===null}},{key:"mimeType",value:function S(e){if(this.mimeType_){return}this.mimeType_=e;if(this.playlist_&&this.state==="INIT"&&!this.paused()){this.init_()}}},{key:"monitorBuffer_",value:function P(){if(this.checkBufferTimeout_){y["default"].clearTimeout(this.checkBufferTimeout_)}this.checkBufferTimeout_=y["default"].setTimeout(this.monitorBufferTick_.bind(this),1)}},{key:"monitorBufferTick_",value:function A(){if(this.state==="READY"){this.fillBuffer_()}if(this.checkBufferTimeout_){y["default"].clearTimeout(this.checkBufferTimeout_)}this.checkBufferTimeout_=y["default"].setTimeout(this.monitorBufferTick_.bind(this),b)}},{key:"getSyncSegmentCandidate_",value:function E(e){var t=this;if(this.currentTimeline_===-1){return 0}var i=e.segments.map(function(e,t){return{timeline:e.timeline,segmentIndex:t}}).filter(function(e){return e.timeline===t.currentTimeline_});if(i.length){return i[Math.min(i.length-1,1)].segmentIndex}return Math.max(e.segments.length-1,0)}},{key:"checkBuffer_",value:function x(e,t,i,r,n,a){var s=0;var o=undefined;if(e.length){s=e.end(e.length-1)}var u=Math.max(0,s-n);if(!t.segments.length){return null}T("cB_","mediaIndex:",i,"hasPlayed:",r,"currentTime:",n,"syncPoint:",a,"fetchAtBuffer:",this.fetchAtBuffer_);T("cB_ 2","bufferedTime:",u);if(u>=m["default"].GOAL_BUFFER_LENGTH){return null}if(!r&&u>=1){return null}if(a===null){i=this.getSyncSegmentCandidate_(t);T("getSync",i);return this.generateSegmentInfo_(t,i,null,true)}if(i!==null){T("++",i+1);var d=t.segments[i];if(d&&d.end){o=d.end}else{o=s}return this.generateSegmentInfo_(t,i+1,o,false)}if(this.fetchAtBuffer_){var l=(0,f.getMediaInfoForTime_)(t,s,a.segmentIndex,a.time);i=l.mediaIndex;o=l.startTime}else{var l=(0,f.getMediaInfoForTime_)(t,n,a.segmentIndex,a.time);i=l.mediaIndex;o=l.startTime}T("gMIFT",i,"sos",o);return this.generateSegmentInfo_(t,i,o,false)}},{key:"generateSegmentInfo_",value:function L(e,t,i,r){if(t<0||t>=e.segments.length){return null}var n=e.segments[t];return{uri:n.resolvedUri,mediaIndex:t,isSyncRequest:r,startOfSegment:i,playlist:e,bytes:null,encryptedBytes:null,timestampOffset:null,timeline:n.timeline,duration:n.duration,segment:n}}},{key:"abort_",value:function I(){if(this.xhr_){this.xhr_.abort()}this.pendingSegment_=null}},{key:"init_",value:function C(){this.state="READY";this.sourceUpdater_=new h["default"](this.mediaSource_,this.mimeType_);this.resetEverything();return this.monitorBuffer_()}},{key:"fillBuffer_",value:function U(){if(this.sourceUpdater_.updating()){return}if(!this.syncPoint_){this.syncPoint_=this.syncController_.getSyncPoint(this.playlist_,this.mediaSource_.duration,this.currentTimeline_)}var e=this.checkBuffer_(this.sourceUpdater_.buffered(),this.playlist_,this.mediaIndex,this.hasPlayed_(),this.currentTime_(),this.syncPoint_);if(!e){return}var t=w(this.playlist_,this.mediaSource_,e.mediaIndex);if(t){this.mediaSource_.endOfStream();return}if(e.mediaIndex===this.playlist_.segments.length-1&&this.mediaSource_.readyState==="ended"&&!this.seeking_()){return}if(e.timeline!==this.currentTimeline_||e.startOfSegment!==null&&e.startOfSegment<this.sourceUpdater_.timestampOffset()){this.syncController_.reset();e.timestampOffset=e.startOfSegment}this.currentTimeline_=e.timeline;this.loadSegment_(e)}},{key:"trimBuffer_",value:function D(e){var t=this.seekable_();var i=this.currentTime_();var r=undefined;if(t.length&&t.start(0)>0&&t.start(0)<i){return t.start(0)}r=i-60;return r}},{key:"loadSegment_",value:function M(e){var t=this;var i=undefined;var r=undefined;var n=undefined;var a=undefined;var s=0;s=this.trimBuffer_(e);if(s>0){this.sourceUpdater_.remove(0,s)}i=e.segment;if(i.key){var o=l["default"].mergeOptions(this.xhrOptions_,{uri:i.key.resolvedUri,responseType:"arraybuffer"});r=this.hls_.xhr(o,this.handleResponse_.bind(this))}if(i.map&&!this.initSegments_[O(i.map)]){var u=l["default"].mergeOptions(this.xhrOptions_,{uri:i.map.resolvedUri,responseType:"arraybuffer",headers:k(i.map)});n=this.hls_.xhr(u,this.handleResponse_.bind(this))}this.pendingSegment_=e;var f=l["default"].mergeOptions(this.xhrOptions_,{uri:e.uri,responseType:"arraybuffer",headers:k(i)});a=this.hls_.xhr(f,this.handleResponse_.bind(this));a.addEventListener("progress",function(e){t.trigger(e)});this.xhr_={keyXhr:r,initSegmentXhr:n,segmentXhr:a,abort:function d(){if(this.segmentXhr){this.segmentXhr.onreadystatechange=null;this.segmentXhr.abort();this.segmentXhr=null}if(this.initSegmentXhr){this.initSegmentXhr.onreadystatechange=null;this.initSegmentXhr.abort();this.initSegmentXhr=null}if(this.keyXhr){this.keyXhr.onreadystatechange=null;this.keyXhr.abort();this.keyXhr=null}}};this.state="WAITING"}},{key:"handleResponse_",value:function j(e,t){var i=undefined;var r=undefined;var n=undefined;if(!this.xhr_||t!==this.xhr_.segmentXhr&&t!==this.xhr_.keyXhr&&t!==this.xhr_.initSegmentXhr){return}i=this.pendingSegment_;r=i.segment;if(t.timedout){this.abort_();this.bandwidth=1;this.roundTrip=NaN;this.state="READY";return this.trigger("progress")}if(!t.aborted&&e){var a=this.xhr_.keyXhr;this.abort_();this.error({status:t.status,message:t===a?"HLS key request error at URL: "+r.key.uri:"HLS segment request error at URL: "+i.uri,code:2,xhr:t});this.state="READY";this.pause();return this.trigger("error")}if(!t.response){this.abort_();return}if(t===this.xhr_.segmentXhr){this.xhr_.segmentXhr=null;i.startOfAppend=Date.now();this.roundTrip=t.roundTripTime;this.bandwidth=t.bandwidth;this.mediaBytesTransferred+=t.bytesReceived||0;this.mediaRequests+=1;this.mediaTransferDuration+=t.roundTripTime||0;if(r.key){i.encryptedBytes=new Uint8Array(t.response)}else{i.bytes=new Uint8Array(t.response)}}if(t===this.xhr_.keyXhr){this.xhr_.keyXhr=null;if(t.response.byteLength!==16){this.abort_();this.error({status:t.status,message:"Invalid HLS key at URL: "+r.key.uri,code:2,xhr:t});this.state="READY";this.pause();return this.trigger("error")}n=new DataView(t.response);r.key.bytes=new Uint32Array([n.getUint32(0),n.getUint32(4),n.getUint32(8),n.getUint32(12)]);r.key.iv=r.key.iv||new Uint32Array([0,0,0,i.mediaIndex+i.playlist.mediaSequence])}if(t===this.xhr_.initSegmentXhr){this.xhr_.initSegmentXhr=null;r.map.bytes=new Uint8Array(t.response);this.initSegments_[O(r.map)]=r.map}if(!this.xhr_.segmentXhr&&!this.xhr_.keyXhr&&!this.xhr_.initSegmentXhr){this.xhr_=null;this.processResponse_()}}},{key:"resetEverything",value:function B(){this.resetLoader();this.remove(0,Infinity)}},{key:"resetLoader",value:function R(){this.fetchAtBuffer_=false;this.resyncLoader()}},{key:"resyncLoader",value:function N(){this.mediaIndex=null;this.syncPoint_=null}},{key:"remove",value:function F(e,t){if(this.sourceUpdater_){this.sourceUpdater_.remove(e,t)}}},{key:"processResponse_",value:function G(){if(!this.pendingSegment_){this.state="READY";return}this.state="DECRYPTING";var e=this.pendingSegment_;var t=e.segment;if(t.key){this.decrypter_.postMessage((0,g.createTransferableMessage)({source:this.loaderType_,encrypted:e.encryptedBytes,key:t.key.bytes,iv:t.key.iv}),[e.encryptedBytes.buffer,t.key.bytes.buffer])}else{this.handleSegment_()}}},{key:"handleDecrypted_",value:function q(e){var t=this.pendingSegment_;var i=e.decrypted;if(t){t.bytes=new Uint8Array(i.bytes,i.byteOffset,i.byteLength)}this.handleSegment_()}},{key:"handleSegment_",value:function H(){var e=this;if(!this.pendingSegment_){this.state="READY";return}this.state="APPENDING";var t=this.pendingSegment_;var i=t.segment;this.syncController_.probeSegmentInfo(t);if(t.isSyncRequest){this.pendingSegment_=null;this.state="READY";return}if(t.timestampOffset!==null&&t.timestampOffset!==this.sourceUpdater_.timestampOffset()){this.sourceUpdater_.timestampOffset(t.timestampOffset)}if(i.map){(function(){var t=O(i.map);if(!e.activeInitSegmentId_||e.activeInitSegmentId_!==t){var r=e.initSegments_[t];e.sourceUpdater_.appendBuffer(r.bytes,function(){e.activeInitSegmentId_=t})}})()}t.byteLength=t.bytes.byteLength;if(typeof i.start==="number"&&typeof i.end==="number"){this.mediaSecondsLoaded+=i.end-i.start}else{this.mediaSecondsLoaded+=i.duration}this.sourceUpdater_.appendBuffer(t.bytes,this.handleUpdateEnd_.bind(this))}},{key:"handleUpdateEnd_",value:function V(){if(!this.pendingSegment_){this.state="READY";if(!this.paused()){this.monitorBuffer_()}return}var e=this.pendingSegment_;this.pendingSegment_=null;this.recordThroughput_(e);this.mediaIndex=e.mediaIndex;this.fetchAtBuffer_=true;T("handleUpdateEnd_",this.mediaIndex);var t=w(e.playlist,this.mediaSource_,this.mediaIndex+1);if(t){this.mediaSource_.endOfStream()}this.state="READY";this.trigger("progress");if(!this.paused()){this.monitorBuffer_()}}},{key:"recordThroughput_",value:function X(e){var t=this.throughput.rate;var i=Date.now()-e.startOfAppend+1;var r=Math.floor(e.byteLength/i*8*1e3);this.throughput.rate+=(r-t)/++this.throughput.count}}]);return t}(l["default"].EventTarget);i["default"]=P;t.exports=i["default"]}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./bin-utils":2,"./config":3,"./playlist":8,"./source-updater":14,"global/window":28}],14:[function(e,t,i){(function(e){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,i,r){if(i)e(t.prototype,i);if(r)e(t,r);return t}}();function n(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var s=typeof window!=="undefined"?window["videojs"]:typeof e!=="undefined"?e["videojs"]:null;var o=n(s);var u=function(){function e(t,i){var r=this;a(this,e);var n=function s(){r.sourceBuffer_=t.addSourceBuffer(i);r.onUpdateendCallback_=function(){var e=r.pendingCallback_;r.pendingCallback_=null;if(e){e()}r.runCallback_()};r.sourceBuffer_.addEventListener("updateend",r.onUpdateendCallback_);r.runCallback_()};this.callbacks_=[];this.pendingCallback_=null;this.timestampOffset_=0;this.mediaSource=t;if(t.readyState==="closed"){t.addEventListener("sourceopen",n)}else{n()}}r(e,[{key:"abort",value:function t(e){var t=this;this.queueCallback_(function(){t.sourceBuffer_.abort()},e)}},{key:"appendBuffer",value:function i(e,t){var i=this;this.queueCallback_(function(){i.sourceBuffer_.appendBuffer(e)},t)}},{key:"buffered",value:function n(){if(!this.sourceBuffer_){return o["default"].createTimeRanges()}return this.sourceBuffer_.buffered}},{key:"duration",value:function s(e){var t=this;this.queueCallback_(function(){t.sourceBuffer_.duration=e})}},{key:"remove",value:function u(e,t){var i=this;this.queueCallback_(function(){i.sourceBuffer_.remove(e,t)})}},{key:"updating",value:function f(){return!this.sourceBuffer_||this.sourceBuffer_.updating}},{key:"timestampOffset",value:function d(e){var t=this;if(typeof e!=="undefined"){this.queueCallback_(function(){t.sourceBuffer_.timestampOffset=e});this.timestampOffset_=e}return this.timestampOffset_}},{key:"queueCallback_",value:function l(e,t){this.callbacks_.push([e.bind(this),t]);this.runCallback_()}},{key:"runCallback_",value:function c(){var e=undefined;if(this.sourceBuffer_&&!this.sourceBuffer_.updating&&this.callbacks_.length){e=this.callbacks_.shift();this.pendingCallback_=e[1];e[0]()}}},{key:"dispose",value:function h(){this.sourceBuffer_.removeEventListener("updateend",this.onUpdateendCallback_);if(this.sourceBuffer_&&this.mediaSource.readyState==="open"){this.sourceBuffer_.abort()}}}]);return e}();i["default"]=u;t.exports=i["default"]}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],15:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,i,r){if(i)e(t.prototype,i);if(r)e(t,r);return t}}();function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=function(){function e(){n(this,e);this.listeners={}}r(e,[{key:"on",value:function t(e,i){if(!this.listeners[e]){this.listeners[e]=[]}this.listeners[e].push(i)}},{key:"off",value:function i(e,t){var i=undefined;if(!this.listeners[e]){return false}i=this.listeners[e].indexOf(t);this.listeners[e].splice(i,1);return i>-1}},{key:"trigger",value:function a(e){var t=undefined;var i=undefined;var r=undefined;var n=undefined;t=this.listeners[e];if(!t){return}if(arguments.length===2){r=t.length;for(i=0;i<r;++i){t[i].call(this,arguments[1])}}else{n=Array.prototype.slice.call(arguments,1);r=t.length;for(i=0;i<r;++i){t[i].apply(this,n)}}}},{key:"dispose",value:function s(){this.listeners={}}},{key:"pipe",value:function o(e){this.on("data",function(t){e.push(t)})}}]);return e}();i["default"]=a;t.exports=i["default"]},{}],16:[function(e,t,i){(function(t){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,i,r){if(i)e(t.prototype,i);if(r)e(t,r);return t}}();var n=function g(e,t,i){var r=true;e:while(r){var n=e,a=t,s=i;r=false;if(n===null)n=Function.prototype;var o=Object.getOwnPropertyDescriptor(n,a);if(o===undefined){var u=Object.getPrototypeOf(n);if(u===null){return undefined}else{e=u;t=a;i=s;r=true;o=u=undefined;continue e}}else if("value"in o){return o.value}else{var f=o.get;if(f===undefined){return undefined}return f.call(s)}}};function a(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function o(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var u=e("mux.js/lib/mp4/probe");var f=a(u);var d=e("mux.js/lib/tools/ts-inspector.js");var l=e("./playlist");var c=typeof window!=="undefined"?window["videojs"]:typeof t!=="undefined"?t["videojs"]:null;var h=a(c);var p="console";var m=function b(){if(window.logit){window[p].log.apply(window[p],arguments)}};var v=[{name:"VOD",run:function _(e,t,i,r){if(i!==Infinity){var n={time:0,segmentIndex:0};return n}return null}},{name:"ProgramDateTime",run:function T(e,t,i,r){if(e.datetimeToDisplayTime&&t.dateTimeObject){var n=t.dateTimeObject.getTime()/1e3;var a=n+e.datetimeToDisplayTime;var s={time:a,segmentIndex:0};return s}return null}},{name:"Segment",run:function w(e,t,i,r){var n=t.segments;for(var a=n.length-1;a>=0;a--){var s=n[a];if(s.timeline===r&&typeof s.start!=="undefined"){var o={time:s.start,segmentIndex:a};return o}}return null}},{name:"Discontinuity",run:function S(e,t,i,r){if(t.discontinuityStarts.length){for(var n=0;n<t.discontinuityStarts.length;n++){var a=t.discontinuityStarts[n];var s=t.discontinuitySequence+n+1;if(e.discontinuities[s]){var o={time:e.discontinuities[s].time,segmentIndex:a};return o}}}return null}},{name:"Playlist",run:function k(e,t,i,r){if(t.syncInfo){var n={time:t.syncInfo.time,segmentIndex:t.syncInfo.mediaSequence-t.mediaSequence};return n}return null}}];i.syncPointStrategies=v;var y=function(e){o(t,e);function t(){s(this,t);n(Object.getPrototypeOf(t.prototype),"constructor",this).call(this);this.inspectCache_=undefined;this.timelines=[];this.discontinuities=[];this.datetimeToDisplayTime=null}r(t,[{key:"getSyncPoint",value:function i(e,t,r){for(var n=0;n<v.length;n++){var a=v[n];var s=a.run(this,e,t,r);if(s){m("syncPoint found via <"+a.name+">:",s);return s}}return null}},{key:"saveExpiredSegmentInfo",value:function a(e,t){var i=t.mediaSequence-e.mediaSequence;for(var r=i-1;r>=0;r--){var n=e.segments[r];if(typeof n.start!=="undefined"){t.syncInfo={mediaSequence:e.mediaSequence+r,time:n.start};m("playlist sync:",t.syncInfo);this.trigger("syncinfoupdate");break}}}},{key:"setDateTimeMapping",value:function u(e){if(!this.datetimeToDisplayTime&&e.dateTimeObject){var t=e.dateTimeObject.getTime()/1e3;this.datetimeToDisplayTime=-t}}},{key:"reset",value:function c(){this.inspectCache_=undefined}},{key:"probeSegmentInfo",value:function h(e){var t=e.segment;var i=undefined;if(t.map){i=this.probeMp4Segment_(e)}else{i=this.probeTsSegment_(e)}if(i){if(this.calculateSegmentTimeMapping_(e,i)){this.saveDiscontinuitySyncInfo_(e)}}}},{key:"probeMp4Segment_",value:function p(e){var t=e.segment;var i=f["default"].timescale(t.map.bytes);var r=f["default"].startTime(i,e.bytes);if(e.timestampOffset!==null){e.timestampOffset-=r}return{start:r,end:r+t.duration}}},{key:"probeTsSegment_",value:function y(e){var t=(0,d.inspect)(e.bytes,this.inspectCache_);var i=undefined;var r=undefined;if(!t){return null}if(t.video&&t.video.length===2){this.inspectCache_=t.video[1].dts;i=t.video[0].dtsTime;r=t.video[1].dtsTime}else if(t.audio&&t.audio.length===2){this.inspectCache_=t.audio[1].dts;

i=t.audio[0].dtsTime;r=t.audio[1].dtsTime}return{start:i,end:r}}},{key:"calculateSegmentTimeMapping_",value:function g(e,t){var i=e.segment;var r=this.timelines[e.timeline];if(e.timestampOffset!==null){m("tsO:",e.timestampOffset);r={time:e.timestampOffset,mapping:e.timestampOffset-t.start};this.timelines[e.timeline]=r;i.start=e.timestampOffset;i.end=t.end+r.mapping}else if(r){i.start=t.start+r.mapping;i.end=t.end+r.mapping}else{return false}this.trigger("syncinfoupdate");return true}},{key:"saveDiscontinuitySyncInfo_",value:function b(e){var t=e.playlist;var i=e.segment;if(i.discontinuity){this.discontinuities[i.timeline]={time:i.start,accuracy:0}}else if(t.discontinuityStarts.length){for(var r=0;r<t.discontinuityStarts.length;r++){var n=t.discontinuityStarts[r];var a=t.discontinuitySequence+r+1;var s=n-e.mediaIndex;if(s>0&&(!this.discontinuities[a]||this.discontinuities[a].accuracy>s)){this.discontinuities[a]={time:i.end+(0,l.sumDurations)(t,e.mediaIndex+1,n),accuracy:s}}}}}}]);return t}(h["default"].EventTarget);i["default"]=y}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./playlist":8,"mux.js/lib/mp4/probe":38,"mux.js/lib/tools/ts-inspector.js":39}],17:[function(e,t,i){(function(e){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=typeof window!=="undefined"?window["videojs"]:typeof e!=="undefined"?e["videojs"]:null;var n=function a(){var e=function t(e,i){e=(0,r.mergeOptions)({timeout:45e3},e);if(t.beforeRequest&&typeof t.beforeRequest==="function"){var n=t.beforeRequest(e);if(n){e=n}}var a=(0,r.xhr)(e,function(e,t){if(!e&&a.response){a.responseTime=Date.now();a.roundTripTime=a.responseTime-a.requestTime;a.bytesReceived=a.response.byteLength||a.response.length;if(!a.bandwidth){a.bandwidth=Math.floor(a.bytesReceived/a.roundTripTime*8*1e3)}}if(e||a.timedout){a.timedout=a.timedout||e.code==="ETIMEDOUT"}else{a.timedout=false}if(!e&&t.statusCode!==200&&t.statusCode!==206&&t.statusCode!==0){e=new Error("XHR Failed with a response of: "+(a&&(a.response||a.responseText)))}i(e,a)});a.requestTime=Date.now();return a};return e};i["default"]=n;t.exports=i["default"]}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],18:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,i,r){if(i)e(t.prototype,i);if(r)e(t,r);return t}}();function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=function u(){var e=[[[],[],[],[],[]],[[],[],[],[],[]]];var t=e[0];var i=e[1];var r=t[4];var n=i[4];var a=undefined;var s=undefined;var o=undefined;var u=[];var f=[];var d=undefined;var l=undefined;var c=undefined;var h=undefined;var p=undefined;var m=undefined;for(a=0;a<256;a++){f[(u[a]=a<<1^(a>>7)*283)^a]=a}for(s=o=0;!r[s];s^=d||1,o=f[o]||1){h=o^o<<1^o<<2^o<<3^o<<4;h=h>>8^h&255^99;r[s]=h;n[h]=s;c=u[l=u[d=u[s]]];m=c*16843009^l*65537^d*257^s*16843008;p=u[h]*257^h*16843008;for(a=0;a<4;a++){t[a][s]=p=p<<24^p>>>8;i[a][h]=m=m<<24^m>>>8}}for(a=0;a<5;a++){t[a]=t[a].slice(0);i[a]=i[a].slice(0)}return e};var s=null;var o=function(){function e(t){n(this,e);if(!s){s=a()}this._tables=[[s[0][0].slice(),s[0][1].slice(),s[0][2].slice(),s[0][3].slice(),s[0][4].slice()],[s[1][0].slice(),s[1][1].slice(),s[1][2].slice(),s[1][3].slice(),s[1][4].slice()]];var i=undefined;var r=undefined;var o=undefined;var u=undefined;var f=undefined;var d=this._tables[0][4];var l=this._tables[1];var c=t.length;var h=1;if(c!==4&&c!==6&&c!==8){throw new Error("Invalid aes key size")}u=t.slice(0);f=[];this._key=[u,f];for(i=c;i<4*c+28;i++){o=u[i-1];if(i%c===0||c===8&&i%c===4){o=d[o>>>24]<<24^d[o>>16&255]<<16^d[o>>8&255]<<8^d[o&255];if(i%c===0){o=o<<8^o>>>24^h<<24;h=h<<1^(h>>7)*283}}u[i]=u[i-c]^o}for(r=0;i;r++,i--){o=u[r&3?i:i-4];if(i<=4||r<4){f[r]=o}else{f[r]=l[0][d[o>>>24]]^l[1][d[o>>16&255]]^l[2][d[o>>8&255]]^l[3][d[o&255]]}}}r(e,[{key:"decrypt",value:function t(e,i,r,n,a,s){var o=this._key[1];var u=e^o[0];var f=n^o[1];var d=r^o[2];var l=i^o[3];var c=undefined;var h=undefined;var p=undefined;var m=o.length/4-2;var v=undefined;var y=4;var g=this._tables[1];var b=g[0];var _=g[1];var T=g[2];var w=g[3];var S=g[4];for(v=0;v<m;v++){c=b[u>>>24]^_[f>>16&255]^T[d>>8&255]^w[l&255]^o[y];h=b[f>>>24]^_[d>>16&255]^T[l>>8&255]^w[u&255]^o[y+1];p=b[d>>>24]^_[l>>16&255]^T[u>>8&255]^w[f&255]^o[y+2];l=b[l>>>24]^_[u>>16&255]^T[f>>8&255]^w[d&255]^o[y+3];y+=4;u=c;f=h;d=p}for(v=0;v<4;v++){a[(3&-v)+s]=S[u>>>24]<<24^S[f>>16&255]<<16^S[d>>8&255]<<8^S[l&255]^o[y++];c=u;u=f;f=d;d=l;l=c}}}]);return e}();i["default"]=o;t.exports=i["default"]},{}],19:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,i,r){if(i)e(t.prototype,i);if(r)e(t,r);return t}}();var n=function l(e,t,i){var r=true;e:while(r){var n=e,a=t,s=i;r=false;if(n===null)n=Function.prototype;var o=Object.getOwnPropertyDescriptor(n,a);if(o===undefined){var u=Object.getPrototypeOf(n);if(u===null){return undefined}else{e=u;t=a;i=s;r=true;o=u=undefined;continue e}}else if("value"in o){return o.value}else{var f=o.get;if(f===undefined){return undefined}return f.call(s)}}};function a(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function o(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var u=e("./stream");var f=a(u);var d=function(e){o(t,e);function t(){s(this,t);n(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,f["default"]);this.jobs=[];this.delay=1;this.timeout_=null}r(t,[{key:"processJob_",value:function i(){this.jobs.shift()();if(this.jobs.length){this.timeout_=setTimeout(this.processJob_.bind(this),this.delay)}else{this.timeout_=null}}},{key:"push",value:function a(e){this.jobs.push(e);if(!this.timeout_){this.timeout_=setTimeout(this.processJob_.bind(this),this.delay)}}}]);return t}(f["default"]);i["default"]=d;t.exports=i["default"]},{"./stream":22}],20:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,i,r){if(i)e(t.prototype,i);if(r)e(t,r);return t}}();function n(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var s=e("./aes");var o=n(s);var u=e("./async-stream");var f=n(u);var d=e("pkcs7");var l=function p(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24};var c=function m(e,t,i){var r=new Int32Array(e.buffer,e.byteOffset,e.byteLength>>2);var n=new o["default"](Array.prototype.slice.call(t));var a=new Uint8Array(e.byteLength);var s=new Int32Array(a.buffer);var u=undefined;var f=undefined;var d=undefined;var c=undefined;var h=undefined;var p=undefined;var m=undefined;var v=undefined;var y=undefined;u=i[0];f=i[1];d=i[2];c=i[3];for(y=0;y<r.length;y+=4){h=l(r[y]);p=l(r[y+1]);m=l(r[y+2]);v=l(r[y+3]);n.decrypt(h,p,m,v,s,y);s[y]=l(s[y]^u);s[y+1]=l(s[y+1]^f);s[y+2]=l(s[y+2]^d);s[y+3]=l(s[y+3]^c);u=h;f=p;d=m;c=v}return a};i.decrypt=c;var h=function(){function e(t,i,r,n){a(this,e);var s=e.STEP;var o=new Int32Array(t.buffer);var u=new Uint8Array(t.byteLength);var c=0;this.asyncStream_=new f["default"];this.asyncStream_.push(this.decryptChunk_(o.subarray(c,c+s),i,r,u));for(c=s;c<o.length;c+=s){r=new Uint32Array([l(o[c-4]),l(o[c-3]),l(o[c-2]),l(o[c-1])]);this.asyncStream_.push(this.decryptChunk_(o.subarray(c,c+s),i,r,u))}this.asyncStream_.push(function(){n(null,(0,d.unpad)(u))})}r(e,[{key:"decryptChunk_",value:function t(e,i,r,n){return function(){var t=c(e,i,r);n.set(t,e.byteOffset)}}}],[{key:"STEP",get:function i(){return 32e3}}]);return e}();i.Decrypter=h;i["default"]={Decrypter:h,decrypt:c}},{"./aes":18,"./async-stream":19,pkcs7:24}],21:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});function r(e){return e&&e.__esModule?e:{"default":e}}var n=e("./decrypter");var a=e("./async-stream");var s=r(a);i["default"]={decrypt:n.decrypt,Decrypter:n.Decrypter,AsyncStream:s["default"]};t.exports=i["default"]},{"./async-stream":19,"./decrypter":20}],22:[function(e,t,i){arguments[4][15][0].apply(i,arguments)},{dup:15}],23:[function(e,t,i){"use strict";var r;t.exports=function n(e){var t=r[e.byteLength%16||0],i=new Uint8Array(e.byteLength+t.length);i.set(e);i.set(t,e.byteLength);return i};r=[[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],[15,15,15,15,15,15,15,15,15,15,15,15,15,15,15],[14,14,14,14,14,14,14,14,14,14,14,14,14,14],[13,13,13,13,13,13,13,13,13,13,13,13,13],[12,12,12,12,12,12,12,12,12,12,12,12],[11,11,11,11,11,11,11,11,11,11,11],[10,10,10,10,10,10,10,10,10,10],[9,9,9,9,9,9,9,9,9],[8,8,8,8,8,8,8,8],[7,7,7,7,7,7,7],[6,6,6,6,6,6],[5,5,5,5,5],[4,4,4,4],[3,3,3],[2,2],[1]]},{}],24:[function(e,t,i){"use strict";i.pad=e("./pad.js");i.unpad=e("./unpad.js")},{"./pad.js":23,"./unpad.js":25}],25:[function(e,t,i){"use strict";t.exports=function r(e){return e.subarray(0,e.byteLength-e[e.byteLength-1])}},{}],26:[function(e,t,i){},{}],27:[function(e,t,i){(function(i){var r=typeof i!=="undefined"?i:typeof window!=="undefined"?window:{};var n=e("min-document");if(typeof document!=="undefined"){t.exports=document}else{var a=r["__GLOBAL_DOCUMENT_CACHE@4"];if(!a){a=r["__GLOBAL_DOCUMENT_CACHE@4"]=n}t.exports=a}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"min-document":26}],28:[function(e,t,i){(function(e){if(typeof window!=="undefined"){t.exports=window}else if(typeof e!=="undefined"){t.exports=e}else if(typeof self!=="undefined"){t.exports=self}else{t.exports={}}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],29:[function(e,t,i){"use strict";var r=e("./line-stream");var n=f(r);var a=e("./parse-stream");var s=f(a);var o=e("./parser");var u=f(o);function f(e){return e&&e.__esModule?e:{"default":e}}t.exports={LineStream:n["default"],ParseStream:s["default"],Parser:u["default"]}},{"./line-stream":30,"./parse-stream":31,"./parser":32}],30:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,i,r){if(i)e(t.prototype,i);if(r)e(t,r);return t}}();var n=e("./stream");var a=s(n);function s(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function u(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function f(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var d=function(e){f(t,e);function t(){o(this,t);var e=u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));e.buffer="";return e}r(t,[{key:"push",value:function i(e){var t=void 0;this.buffer+=e;t=this.buffer.indexOf("\n");for(;t>-1;t=this.buffer.indexOf("\n")){this.trigger("data",this.buffer.substring(0,t));this.buffer=this.buffer.substring(t+1)}}}]);return t}(a["default"]);i["default"]=d},{"./stream":33}],31:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function e(e,t){var i=[];var r=true;var n=false;var a=undefined;try{for(var s=e[Symbol.iterator](),o;!(r=(o=s.next()).done);r=true){i.push(o.value);if(t&&i.length===t)break}}catch(u){n=true;a=u}finally{try{if(!r&&s["return"])s["return"]()}finally{if(n)throw a}}return i}return function(t,i){if(Array.isArray(t)){return t}else if(Symbol.iterator in Object(t)){return e(t,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,i,r){if(i)e(t.prototype,i);if(r)e(t,r);return t}}();var a=e("./stream");var s=o(a);function o(e){return e&&e.__esModule?e:{"default":e}}function u(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function f(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function d(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var l=function p(){var e="[^=]*";var t='"[^"]*"|[^,]*';var i="(?:"+e+")=(?:"+t+")";return new RegExp("(?:^|,)("+i+")")};var c=function m(e){var t=e.split(l());var i={};var r=t.length;var n=void 0;while(r--){if(t[r]===""){continue}n=/([^=]*)=(.*)/.exec(t[r]).slice(1);n[0]=n[0].replace(/^\s+|\s+$/g,"");n[1]=n[1].replace(/^\s+|\s+$/g,"");n[1]=n[1].replace(/^['"](.*)['"]$/g,"$1");i[n[0]]=n[1]}return i};var h=function(e){d(t,e);function t(){u(this,t);return f(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}n(t,[{key:"push",value:function i(e){var t=void 0;var i=void 0;e=e.replace(/^[\u0000\s]+|[\u0000\s]+$/g,"");if(e.length===0){return}if(e[0]!=="#"){this.trigger("data",{type:"uri",uri:e});return}if(e.indexOf("#EXT")!==0){this.trigger("data",{type:"comment",text:e.slice(1)});return}e=e.replace("\r","");t=/^#EXTM3U/.exec(e);if(t){this.trigger("data",{type:"tag",tagType:"m3u"});return}t=/^#EXTINF:?([0-9\.]*)?,?(.*)?$/.exec(e);if(t){i={type:"tag",tagType:"inf"};if(t[1]){i.duration=parseFloat(t[1])}if(t[2]){i.title=t[2]}this.trigger("data",i);return}t=/^#EXT-X-TARGETDURATION:?([0-9.]*)?/.exec(e);if(t){i={type:"tag",tagType:"targetduration"};if(t[1]){i.duration=parseInt(t[1],10)}this.trigger("data",i);return}t=/^#ZEN-TOTAL-DURATION:?([0-9.]*)?/.exec(e);if(t){i={type:"tag",tagType:"totalduration"};if(t[1]){i.duration=parseInt(t[1],10)}this.trigger("data",i);return}t=/^#EXT-X-VERSION:?([0-9.]*)?/.exec(e);if(t){i={type:"tag",tagType:"version"};if(t[1]){i.version=parseInt(t[1],10)}this.trigger("data",i);return}t=/^#EXT-X-MEDIA-SEQUENCE:?(\-?[0-9.]*)?/.exec(e);if(t){i={type:"tag",tagType:"media-sequence"};if(t[1]){i.number=parseInt(t[1],10)}this.trigger("data",i);return}t=/^#EXT-X-DISCONTINUITY-SEQUENCE:?(\-?[0-9.]*)?/.exec(e);if(t){i={type:"tag",tagType:"discontinuity-sequence"};if(t[1]){i.number=parseInt(t[1],10)}this.trigger("data",i);return}t=/^#EXT-X-PLAYLIST-TYPE:?(.*)?$/.exec(e);if(t){i={type:"tag",tagType:"playlist-type"};if(t[1]){i.playlistType=t[1]}this.trigger("data",i);return}t=/^#EXT-X-BYTERANGE:?([0-9.]*)?@?([0-9.]*)?/.exec(e);if(t){i={type:"tag",tagType:"byterange"};if(t[1]){i.length=parseInt(t[1],10)}if(t[2]){i.offset=parseInt(t[2],10)}this.trigger("data",i);return}t=/^#EXT-X-ALLOW-CACHE:?(YES|NO)?/.exec(e);if(t){i={type:"tag",tagType:"allow-cache"};if(t[1]){i.allowed=!/NO/.test(t[1])}this.trigger("data",i);return}t=/^#EXT-X-MAP:?(.*)$/.exec(e);if(t){i={type:"tag",tagType:"map"};if(t[1]){var n=c(t[1]);if(n.URI){i.uri=n.URI}if(n.BYTERANGE){var a=n.BYTERANGE.split("@"),s=r(a,2),o=s[0],u=s[1];i.byterange={};if(o){i.byterange.length=parseInt(o,10)}if(u){i.byterange.offset=parseInt(u,10)}}}this.trigger("data",i);return}t=/^#EXT-X-STREAM-INF:?(.*)$/.exec(e);if(t){i={type:"tag",tagType:"stream-inf"};if(t[1]){i.attributes=c(t[1]);if(i.attributes.RESOLUTION){var f=i.attributes.RESOLUTION.split("x");var d={};if(f[0]){d.width=parseInt(f[0],10)}if(f[1]){d.height=parseInt(f[1],10)}i.attributes.RESOLUTION=d}if(i.attributes.BANDWIDTH){i.attributes.BANDWIDTH=parseInt(i.attributes.BANDWIDTH,10)}if(i.attributes["PROGRAM-ID"]){i.attributes["PROGRAM-ID"]=parseInt(i.attributes["PROGRAM-ID"],10)}}this.trigger("data",i);return}t=/^#EXT-X-MEDIA:?(.*)$/.exec(e);if(t){i={type:"tag",tagType:"media"};if(t[1]){i.attributes=c(t[1])}this.trigger("data",i);return}t=/^#EXT-X-ENDLIST/.exec(e);if(t){this.trigger("data",{type:"tag",tagType:"endlist"});return}t=/^#EXT-X-DISCONTINUITY/.exec(e);if(t){this.trigger("data",{type:"tag",tagType:"discontinuity"});return}t=/^#EXT-X-PROGRAM-DATE-TIME:?(.*)$/.exec(e);if(t){i={type:"tag",tagType:"program-date-time"};if(t[1]){i.dateTimeString=t[1];i.dateTimeObject=new Date(t[1])}this.trigger("data",i);return}t=/^#EXT-X-KEY:?(.*)$/.exec(e);if(t){i={type:"tag",tagType:"key"};if(t[1]){i.attributes=c(t[1]);if(i.attributes.IV){if(i.attributes.IV.substring(0,2).toLowerCase()==="0x"){i.attributes.IV=i.attributes.IV.substring(2)}i.attributes.IV=i.attributes.IV.match(/.{8}/g);i.attributes.IV[0]=parseInt(i.attributes.IV[0],16);i.attributes.IV[1]=parseInt(i.attributes.IV[1],16);i.attributes.IV[2]=parseInt(i.attributes.IV[2],16);i.attributes.IV[3]=parseInt(i.attributes.IV[3],16);i.attributes.IV=new Uint32Array(i.attributes.IV)}}this.trigger("data",i);return}t=/^#EXT-X-CUE-OUT-CONT:?(.*)?$/.exec(e);if(t){i={type:"tag",tagType:"cue-out-cont"};if(t[1]){i.data=t[1]}else{i.data=""}this.trigger("data",i);return}t=/^#EXT-X-CUE-OUT:?(.*)?$/.exec(e);if(t){i={type:"tag",tagType:"cue-out"};if(t[1]){i.data=t[1]}else{i.data=""}this.trigger("data",i);return}t=/^#EXT-X-CUE-IN:?(.*)?$/.exec(e);if(t){i={type:"tag",tagType:"cue-in"};if(t[1]){i.data=t[1]}else{i.data=""}this.trigger("data",i);return}this.trigger("data",{type:"tag",data:e.slice(4)})}}]);return t}(s["default"]);i["default"]=h},{"./stream":33}],32:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i){if(Object.prototype.hasOwnProperty.call(i,r)){e[r]=i[r]}}}return e};var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,i,r){if(i)e(t.prototype,i);if(r)e(t,r);return t}}();var a=e("./stream");var s=l(a);var o=e("./line-stream");var u=l(o);var f=e("./parse-stream");var d=l(f);function l(e){return e&&e.__esModule?e:{"default":e}}function c(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function h(e,t){if(!e){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t&&(typeof t==="object"||typeof t==="function")?t:e}function p(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var m=function(e){p(t,e);function t(){c(this,t);var e=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));e.lineStream=new u["default"];e.parseStream=new d["default"];e.lineStream.pipe(e.parseStream);var i=e;var n=[];var a={};var s=void 0;var o=void 0;var f=function m(){};var l={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}};var p=0;e.manifest={allowCache:true,discontinuityStarts:[],segments:[]};e.parseStream.on("data",function(e){var t=void 0;var u=void 0;({tag:function d(){(({"allow-cache":function d(){this.manifest.allowCache=e.allowed;if(!("allowed"in e)){this.trigger("info",{message:"defaulting allowCache to YES"});this.manifest.allowCache=true}},byterange:function c(){var c={};if("length"in e){a.byterange=c;c.length=e.length;if(!("offset"in e)){this.trigger("info",{message:"defaulting offset to zero"});e.offset=0}}if("offset"in e){a.byterange=c;c.offset=e.offset}},endlist:function h(){this.manifest.endList=true},inf:function m(){if(!("mediaSequence"in this.manifest)){this.manifest.mediaSequence=0;this.trigger("info",{message:"defaulting media sequence to zero"})}if(!("discontinuitySequence"in this.manifest)){this.manifest.discontinuitySequence=0;this.trigger("info",{message:"defaulting discontinuity sequence to zero"})}if(e.duration>0){a.duration=e.duration}if(e.duration===0){a.duration=.01;this.trigger("info",{message:"updating zero segment duration to a small value"})}this.manifest.segments=n},key:function v(){if(!e.attributes){this.trigger("warn",{message:"ignoring key declaration without attribute list"});return}if(e.attributes.METHOD==="NONE"){o=null;return}if(!e.attributes.URI){this.trigger("warn",{message:"ignoring key declaration without URI"});return}if(!e.attributes.METHOD){this.trigger("warn",{message:"defaulting key method to AES-128"})}o={method:e.attributes.METHOD||"AES-128",uri:e.attributes.URI};if(typeof e.attributes.IV!=="undefined"){o.iv=e.attributes.IV}},"media-sequence":function y(){if(!isFinite(e.number)){this.trigger("warn",{message:"ignoring invalid media sequence: "+e.number});return}this.manifest.mediaSequence=e.number},"discontinuity-sequence":function g(){if(!isFinite(e.number)){this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+e.number});return}this.manifest.discontinuitySequence=e.number;p=e.number},"playlist-type":function b(){if(!/VOD|EVENT/.test(e.playlistType)){this.trigger("warn",{message:"ignoring unknown playlist type: "+e.playlist});return}this.manifest.playlistType=e.playlistType},map:function _(){s={};if(e.uri){s.uri=e.uri}if(e.byterange){s.byterange=e.byterange}},"stream-inf":function T(){this.manifest.playlists=n;this.manifest.mediaGroups=this.manifest.mediaGroups||l;if(!e.attributes){this.trigger("warn",{message:"ignoring empty stream-inf attributes"});return}if(!a.attributes){a.attributes={}}r(a.attributes,e.attributes)},media:function w(){this.manifest.mediaGroups=this.manifest.mediaGroups||l;if(!(e.attributes&&e.attributes.TYPE&&e.attributes["GROUP-ID"]&&e.attributes.NAME)){this.trigger("warn",{message:"ignoring incomplete or missing media group"});return}var i=this.manifest.mediaGroups[e.attributes.TYPE];i[e.attributes["GROUP-ID"]]=i[e.attributes["GROUP-ID"]]||{};t=i[e.attributes["GROUP-ID"]];u={"default":/yes/i.test(e.attributes.DEFAULT)};if(u["default"]){u.autoselect=true}else{u.autoselect=/yes/i.test(e.attributes.AUTOSELECT)}if(e.attributes.LANGUAGE){u.language=e.attributes.LANGUAGE}if(e.attributes.URI){u.uri=e.attributes.URI}if(e.attributes["INSTREAM-ID"]){u.instreamId=e.attributes["INSTREAM-ID"]}t[e.attributes.NAME]=u},discontinuity:function S(){p+=1;a.discontinuity=true;this.manifest.discontinuityStarts.push(n.length)},"program-date-time":function k(){this.manifest.dateTimeString=e.dateTimeString;this.manifest.dateTimeObject=e.dateTimeObject},targetduration:function O(){if(!isFinite(e.duration)||e.duration<0){this.trigger("warn",{message:"ignoring invalid target duration: "+e.duration});return}this.manifest.targetDuration=e.duration},totalduration:function P(){if(!isFinite(e.duration)||e.duration<0){this.trigger("warn",{message:"ignoring invalid total duration: "+e.duration});return}this.manifest.totalDuration=e.duration},"cue-out":function A(){a.cueOut=e.data},"cue-out-cont":function E(){a.cueOutCont=e.data},"cue-in":function x(){a.cueIn=e.data}})[e.tagType]||f).call(i)},uri:function c(){a.uri=e.uri;n.push(a);if(this.manifest.targetDuration&&!("duration"in a)){this.trigger("warn",{message:"defaulting segment duration to the target duration"});a.duration=this.manifest.targetDuration}if(o){a.key=o}a.timeline=p;if(s){a.map=s}a={}},comment:function h(){}})[e.type].call(i)});return e}n(t,[{key:"push",value:function i(e){this.lineStream.push(e)}},{key:"end",value:function a(){this.lineStream.push("\n")}}]);return t}(s["default"]);i["default"]=m},{"./line-stream":30,"./parse-stream":31,"./stream":33}],33:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,i,r){if(i)e(t.prototype,i);if(r)e(t,r);return t}}();function n(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var a=function(){function e(){n(this,e);this.listeners={}}r(e,[{key:"on",value:function t(e,i){if(!this.listeners[e]){this.listeners[e]=[]}this.listeners[e].push(i)}},{key:"off",value:function i(e,t){if(!this.listeners[e]){return false}var i=this.listeners[e].indexOf(t);this.listeners[e].splice(i,1);return i>-1}},{key:"trigger",value:function a(e){var t=this.listeners[e];var i=void 0;var r=void 0;var n=void 0;if(!t){return}if(arguments.length===2){r=t.length;for(i=0;i<r;++i){t[i].call(this,arguments[1])}}else{n=Array.prototype.slice.call(arguments,1);r=t.length;for(i=0;i<r;++i){t[i].apply(this,n)}}}},{key:"dispose",value:function s(){this.listeners={}}},{key:"pipe",value:function o(e){this.on("data",function(t){e.push(t)})}}]);return e}();i["default"]=a},{}],34:[function(e,t,i){"use strict";var r=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];var n=function(e){return e[0]<<21|e[1]<<14|e[2]<<7|e[3]};var a=function(e,t,i){var r,n="";for(r=t;r<i;r++){n+="%"+("00"+e[r].toString(16)).slice(-2)}return n};var s=function(e,t,i){return unescape(a(e,t,i))};var o=function(e,t){var i=e[t+6]<<21|e[t+7]<<14|e[t+8]<<7|e[t+9],r=e[t+5],n=(r&16)>>4;if(n){return i+20}return i+10};var u=function(e,t){var i=(e[t+5]&224)>>5,r=e[t+4]<<3,n=e[t+3]&3<<11;return n|r|i};var f=function(e,t){if(e[t]==="I".charCodeAt(0)&&e[t+1]==="D".charCodeAt(0)&&e[t+2]==="3".charCodeAt(0)){return"timed-metadata"}else if(e[t]&255===255&&(e[t+1]&240)===240){return"audio"}return null};var d=function(e){var t=0;while(t+5<e.length){if(e[t]!==255||(e[t+1]&246)!==240){t++;continue}return r[(e[t+2]&60)>>>2]}return null};var l=function(e){var t,i,r,a;t=10;if(e[5]&64){t+=4;t+=n(e.subarray(10,14))}do{i=n(e.subarray(t+4,t+8));if(i<1){return null}a=String.fromCharCode(e[t],e[t+1],e[t+2],e[t+3]);if(a==="PRIV"){r=e.subarray(t+10,t+i+10);for(var o=0;o<r.byteLength;o++){if(r[o]===0){var u=s(r,0,o);if(u==="com.apple.streaming.transportStreamTimestamp"){var f=r.subarray(o+1);var d=(f[3]&1)<<30|f[4]<<22|f[5]<<14|f[6]<<6|f[7]>>>2;d*=4;d+=f[7]&3;return d}break}}}t+=10;t+=i}while(t<e.byteLength);return null};t.exports={parseId3TagSize:o,parseAdtsSize:u,parseType:f,parseSampleRate:d,parseAacTimestamp:l}},{}],35:[function(e,t,i){"use strict";var r=e("./stream-types.js");var n=function(e){var t=e[1]&31;t<<=8;t|=e[2];return t};var a=function(e){return!!(e[1]&64)};var s=function(e){var t=0;if((e[3]&48)>>>4>1){t+=e[4]+1}return t};var o=function(e,t){var i=n(e);if(i===0){return"pat"}else if(i===t){return"pmt"}else if(t){return"pes"}return null};var u=function(e){var t=a(e);var i=4+s(e);if(t){i+=e[i]+1}return(e[i+10]&31)<<8|e[i+11]};var f=function(e){var t={};var i=a(e);var r=4+s(e);if(i){r+=e[r]+1}if(!(e[r+5]&1)){return}var n,o,u;n=(e[r+1]&15)<<8|e[r+2];o=3+n-4;u=(e[r+10]&15)<<8|e[r+11];var f=12+u;while(f<o){var d=r+f;t[(e[d+1]&31)<<8|e[d+2]]=e[d];f+=((e[d+3]&15)<<8|e[d+4])+5}return t};var d=function(e,t){var i=n(e);var a=t[i];switch(a){case r.H264_STREAM_TYPE:return"video";case r.ADTS_STREAM_TYPE:return"audio";case r.METADATA_STREAM_TYPE:return"timed-metadata";default:return null}};var l=function(e){var t=a(e);if(!t){return null}var i=4+s(e);var r={};var n;n=e[i+7];if(n&192){r.pts=(e[i+9]&14)<<27|(e[i+10]&255)<<20|(e[i+11]&254)<<12|(e[i+12]&255)<<5|(e[i+13]&254)>>>3;r.pts*=4;r.pts+=(e[i+13]&6)>>>1;r.dts=r.pts;if(n&64){r.dts=(e[i+14]&14)<<27|(e[i+15]&255)<<20|(e[i+16]&254)<<12|(e[i+17]&255)<<5|(e[i+18]&254)>>>3;r.dts*=4;r.dts+=(e[i+18]&6)>>>1}}return r};var c=function(e){switch(e){case 5:return"slice_layer_without_partitioning_rbsp_idr";case 6:return"sei_rbsp";case 7:return"seq_parameter_set_rbsp";case 8:return"pic_parameter_set_rbsp";case 9:return"access_unit_delimiter_rbsp";default:return null}};var h=function(e){var t=4+s(e);var i=e.subarray(t);var r=0;var n=0;var a=false;var o;for(;n<i.byteLength-3;n++){if(i[n+2]===1){r=n+5;break}}while(r<i.byteLength){switch(i[r]){case 0:if(i[r-1]!==0){r+=2;break}else if(i[r-2]!==0){r++;break}if(n+3!==r-2){o=c(i[n+3]&31);if(o==="slice_layer_without_partitioning_rbsp_idr"){a=true}}do{r++}while(i[r]!==1&&r<i.length);n=r-2;r+=3;break;case 1:if(i[r-1]!==0||i[r-2]!==0){r+=3;break}o=c(i[n+3]&31);if(o==="slice_layer_without_partitioning_rbsp_idr"){a=true}n=r-2;r+=3;break;default:r+=3;break}}i=i.subarray(n);r-=n;n=0;if(i&&i.byteLength>3){o=c(i[n+3]&31);if(o==="slice_layer_without_partitioning_rbsp_idr"){a=true}}return a};t.exports={parseType:o,parsePat:u,parsePmt:f,parsePayloadUnitStartIndicator:a,parsePesType:d,parsePesTime:l,videoPacketContainsKeyFrame:h}},{"./stream-types.js":36}],36:[function(e,t,i){"use strict";t.exports={H264_STREAM_TYPE:27,ADTS_STREAM_TYPE:15,METADATA_STREAM_TYPE:21}},{}],37:[function(e,t,i){"use strict";var r=e("../utils/stream");var n=8589934592;var a=4294967296;var s=function(e,t){var i=1;if(e>t){i=-1}while(Math.abs(t-e)>a){e+=i*n}return e};var o=function(e){var t,i;o.prototype.init.call(this);this.type_=e;this.push=function(e){if(e.type!==this.type_){return}if(i===undefined){i=e.dts}e.dts=s(e.dts,i);e.pts=s(e.pts,i);t=e.dts;this.trigger("data",e)};this.flush=function(){i=t;this.trigger("done")}};o.prototype=new r;t.exports={TimestampRolloverStream:o,handleRollover:s}},{"../utils/stream":40}],38:[function(e,t,i){"use strict";var r,n,a,s;r=function(e,t){var i=[],a,s,o,u,f;if(!t.length){return null}for(a=0;a<e.byteLength;){s=e[a]<<24;s|=e[a+1]<<16;s|=e[a+2]<<8;s|=e[a+3];o=n(e.subarray(a+4,a+8));u=s>1?a+s:e.byteLength;if(o===t[0]){if(t.length===1){i.push(e.subarray(a+8,u))}else{f=r(e.subarray(a+8,u),t.slice(1));if(f.length){i=i.concat(f)}}}a=u}return i};n=function(e){var t="";t+=String.fromCharCode(e[0]);t+=String.fromCharCode(e[1]);t+=String.fromCharCode(e[2]);t+=String.fromCharCode(e[3]);return t};a=function(e){var t={},i=r(e,["moov","trak"]);return i.reduce(function(e,t){var i,n,a,s,o;i=r(t,["tkhd"])[0];if(!i){return null}n=i[0];a=n===0?12:20;s=i[a]<<24|i[a+1]<<16|i[a+2]<<8|i[a+3];o=r(t,["mdia","mdhd"])[0];if(!o){return null}n=o[0];a=n===0?12:20;e[s]=o[a]<<24|o[a+1]<<16|o[a+2]<<8|o[a+3];return e},t)};s=function(e,t){var i,n,a;i=r(t,["moof","traf"]);n=[].concat.apply([],i.map(function(t){return r(t,["tfhd"]).map(function(i){var n,a,s;n=i[4]<<24|i[5]<<16|i[6]<<8|i[7];a=e[n]||9e4;s=r(t,["tfdt"]).map(function(e){var t,i;t=e[0];i=e[4]<<24|e[5]<<16|e[6]<<8|e[7];if(t===1){i*=Math.pow(2,32);i+=e[8]<<24|e[9]<<16|e[10]<<8|e[11]}return i})[0];s=s||Infinity;return s/a})}));a=Math.min.apply(null,n);return isFinite(a)?a:0};t.exports={parseType:n,timescale:a,startTime:s}},{}],39:[function(e,t,i){"use strict";var r=e("../m2ts/stream-types.js");var n=e("../m2ts/timestamp-rollover-stream.js").handleRollover;var a={};a.ts=e("../m2ts/probe.js");a.aac=e("../aac/probe.js");var s=9e4,o=188,u=71;var f=function(e){if(e[0]==="I".charCodeAt(0)&&e[1]==="D".charCodeAt(0)&&e[2]==="3".charCodeAt(0)){return true;

}return false};var d=function(e,t){var i=0,r=o,n,s;while(r<e.byteLength){if(e[i]===u&&e[r]===u){n=e.subarray(i,r);s=a.ts.parseType(n,t.pid);switch(s){case"pat":if(!t.pid){t.pid=a.ts.parsePat(n)}break;case"pmt":if(!t.table){t.table=a.ts.parsePmt(n)}break;default:break}if(t.pid&&t.table){return}i+=o;r+=o;continue}i++;r++}};var l=function(e,t,i){var r=0,n=o,s,f,d,l,c;var h=false;while(n<e.byteLength){if(e[r]===u&&e[n]===u){s=e.subarray(r,n);f=a.ts.parseType(s,t.pid);switch(f){case"pes":d=a.ts.parsePesType(s,t.table);l=a.ts.parsePayloadUnitStartIndicator(s);if(d==="audio"&&l){c=a.ts.parsePesTime(s);c.type="audio";i.audio.push(c);h=true}break;default:break}if(h){break}r+=o;n+=o;continue}r++;n++}n=e.byteLength;r=n-o;h=false;while(r>=0){if(e[r]===u&&e[n]===u){s=e.subarray(r,n);f=a.ts.parseType(s,t.pid);switch(f){case"pes":d=a.ts.parsePesType(s,t.table);l=a.ts.parsePayloadUnitStartIndicator(s);if(d==="audio"&&l){c=a.ts.parsePesTime(s);c.type="audio";i.audio.push(c);h=true}break;default:break}if(h){break}r-=o;n-=o;continue}r--;n--}};var c=function(e,t,i){var r=0,n=o,s,f,d,l,c,h,p,m;var v=false;var y={data:[],size:0};while(n<e.byteLength){if(e[r]===u&&e[n]===u){s=e.subarray(r,n);f=a.ts.parseType(s,t.pid);switch(f){case"pes":d=a.ts.parsePesType(s,t.table);l=a.ts.parsePayloadUnitStartIndicator(s);if(d==="video"){if(l&&!v){c=a.ts.parsePesTime(s);c.type="video";i.video.push(c);v=true}if(!i.firstKeyFrame){if(l){if(y.size!==0){h=new Uint8Array(y.size);p=0;while(y.data.length){m=y.data.shift();h.set(m,p);p+=m.byteLength}if(a.ts.videoPacketContainsKeyFrame(h)){i.firstKeyFrame=a.ts.parsePesTime(h);i.firstKeyFrame.type="video"}y.size=0}}y.data.push(s);y.size+=s.byteLength}}break;default:break}if(v&&i.firstKeyFrame){break}r+=o;n+=o;continue}r++;n++}n=e.byteLength;r=n-o;v=false;while(r>=0){if(e[r]===u&&e[n]===u){s=e.subarray(r,n);f=a.ts.parseType(s,t.pid);switch(f){case"pes":d=a.ts.parsePesType(s,t.table);l=a.ts.parsePayloadUnitStartIndicator(s);if(d==="video"&&l){c=a.ts.parsePesTime(s);c.type="video";i.video.push(c);v=true}break;default:break}if(v){break}r-=o;n-=o;continue}r--;n--}};var h=function(e,t){if(e.audio&&e.audio.length){var i=t;if(typeof i==="undefined"){i=e.audio[0].dts}e.audio.forEach(function(e){e.dts=n(e.dts,i);e.pts=n(e.pts,i);e.dtsTime=e.dts/s;e.ptsTime=e.pts/s})}if(e.video&&e.video.length){var r=t;if(typeof r==="undefined"){r=e.video[0].dts}e.video.forEach(function(e){e.dts=n(e.dts,r);e.pts=n(e.pts,r);e.dtsTime=e.dts/s;e.ptsTime=e.pts/s});if(e.firstKeyFrame){var a=e.firstKeyFrame;a.dts=n(a.dts,r);a.pts=n(a.pts,r);a.dtsTime=a.dts/s;a.ptsTime=a.dts/s}}};var p=function(e){var t=false,i=0,r=null,n=null,o=0,u=0,f;while(e.length-u>=3){var d=a.aac.parseType(e,u);switch(d){case"timed-metadata":if(e.length-u<10){t=true;break}o=a.aac.parseId3TagSize(e,u);if(o>e.length){t=true;break}if(n===null){f=e.subarray(u,u+o);n=a.aac.parseAacTimestamp(f)}u+=o;break;case"audio":if(e.length-u<7){t=true;break}o=a.aac.parseAdtsSize(e,u);if(o>e.length){t=true;break}if(r===null){f=e.subarray(u,u+o);r=a.aac.parseSampleRate(f)}i++;u+=o;break;default:u++;break}if(t){return null}}if(r===null||n===null){return null}var l=s/r;var c={audio:[{type:"audio",dts:n,pts:n},{type:"audio",dts:n+i*1024*l,pts:n+i*1024*l}]};return c};var m=function(e){var t={pid:null,table:null};var i={};d(e,t);for(var n in t.table){if(t.table.hasOwnProperty(n)){var a=t.table[n];switch(a){case r.H264_STREAM_TYPE:i.video=[];c(e,t,i);if(i.video.length===0){delete i.video}break;case r.ADTS_STREAM_TYPE:i.audio=[];l(e,t,i);if(i.audio.length===0){delete i.audio}break;default:break}}}return i};var v=function(e,t){var i=f(e);var r;if(i){r=p(e)}else{r=m(e)}if(!r||!r.audio&&!r.video){return null}h(r,t);return r};t.exports={inspect:v}},{"../aac/probe.js":34,"../m2ts/probe.js":35,"../m2ts/stream-types.js":36,"../m2ts/timestamp-rollover-stream.js":37}],40:[function(e,t,i){"use strict";var r=function(){this.init=function(){var e={};this.on=function(t,i){if(!e[t]){e[t]=[]}e[t]=e[t].concat(i)};this.off=function(t,i){var r;if(!e[t]){return false}r=e[t].indexOf(i);e[t]=e[t].slice();e[t].splice(r,1);return r>-1};this.trigger=function(t){var i,r,n,a;i=e[t];if(!i){return}if(arguments.length===2){n=i.length;for(r=0;r<n;++r){i[r].call(this,arguments[1])}}else{a=[];r=arguments.length;for(r=1;r<arguments.length;++r){a.push(arguments[r])}n=i.length;for(r=0;r<n;++r){i[r].apply(this,a)}}};this.dispose=function(){e={}}}};r.prototype.pipe=function(e){this.on("data",function(t){e.push(t)});this.on("done",function(t){e.flush(t)});return e};r.prototype.push=function(e){this.trigger("data",e)};r.prototype.flush=function(e){this.trigger("done",e)};t.exports=r},{}],41:[function(t,i,r){(function(t){var n=/^([^#]*)(.*)$/;var a=/^([^\?]*)(.*)$/;var s=/^(([a-z]+:\/\/)?[^:\/]+(?::[0-9]+)?)?(\/?.*)$/i;var o={buildAbsoluteURL:function(e,t){t=t.trim();if(/^[a-z]+:/i.test(t)){return t}var i=null;var r=null;var u=n.exec(t);if(u){r=u[2];t=u[1]}var f=a.exec(t);if(f){i=f[2];t=f[1]}var d=n.exec(e);if(d){e=d[1]}var l=a.exec(e);if(l){e=l[1]}var c=s.exec(e);if(!c){throw new Error("Error trying to parse base URL.")}var h=c[2]||"";var p=c[1]||"";var m=c[3];if(m.indexOf("/")!==0&&p!==""){m="/"+m}var v=null;if(/^\/\//.test(t)){v=h+o.buildAbsolutePath("",t.substring(2))}else if(/^\//.test(t)){v=p+"/"+o.buildAbsolutePath("",t.substring(1))}else{v=o.buildAbsolutePath(p+m,t)}if(i){v+=i}if(r){v+=r}return v},buildAbsolutePath:function(e,t){var i=t;var r,n="",a=e.replace(/[^\/]*$/,i.replace(/(\/|^)(?:\.?\/+)+/g,"$1"));for(var s,o=0;s=a.indexOf("/../",o),s>-1;o=s+r){r=/^\/(?:\.\.\/)*/.exec(a.slice(s))[0].length;n=(n+a.substring(o,s)).replace(new RegExp("(?:\\/+[^\\/]*){0,"+(r-1)/3+"}$"),"/")}return n+a.substr(o)}};if(typeof r==="object"&&typeof i==="object")i.exports=o;else if(typeof e==="function"&&e.amd)e([],function(){return o});else if(typeof r==="object")r["URLToolkit"]=o;else t["URLToolkit"]=o})(this)},{}],42:[function(e,t,i){(function(r){"use strict";Object.defineProperty(i,"__esModule",{value:true});function n(e){return e&&e.__esModule?e:{"default":e}}var a=e("global/window");var s=n(a);var o=typeof window!=="undefined"?window["videojs"]:typeof r!=="undefined"?r["videojs"]:null;var u=n(o);var f=function c(e){Object.defineProperties(e.frame,{id:{get:function t(){u["default"].log.warn("cue.frame.id is deprecated. Use cue.value.key instead.");return e.value.key}},value:{get:function i(){u["default"].log.warn("cue.frame.value is deprecated. Use cue.value.data instead.");return e.value.data}},privateData:{get:function r(){u["default"].log.warn("cue.frame.privateData is deprecated. Use cue.value.data instead.");return e.value.data}}})};var d=function h(e){var t=undefined;if(isNaN(e)||Math.abs(e)===Infinity){t=Number.MAX_VALUE}else{t=e}return t};var l=function p(e,t,i){var r=s["default"].WebKitDataCue||s["default"].VTTCue;if(t){t.forEach(function(e){this.inbandTextTrack_.addCue(new r(e.startTime+this.timestampOffset,e.endTime+this.timestampOffset,e.text))},e)}if(i){var n=d(e.mediaSource_.duration);i.forEach(function(e){var t=e.cueTime+this.timestampOffset;e.frames.forEach(function(e){var i=new r(t,t,e.value||e.url||e.data||"");i.frame=e;i.value=e;f(i);this.metadataTrack_.addCue(i)},this)},e);if(e.metadataTrack_&&e.metadataTrack_.cues&&e.metadataTrack_.cues.length){var a=e.metadataTrack_.cues;var o=[];for(var u=0;u<a.length;u++){o.push(a[u])}o.sort(function(e,t){return e.startTime-t.startTime});for(var l=0;l<o.length-1;l++){if(o[l].endTime!==o[l+1].startTime){o[l].endTime=o[l+1].startTime}}o[o.length-1].endTime=n}}};i["default"]={addTextTrackData:l,durationOfVideo:d};t.exports=i["default"]}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"global/window":28}],43:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function a(e,t,i){var r=e.remoteTextTracks()||[];for(var n=0;n<r.length;n++){var a=r[n];if(a.kind===t&&a.label===i){e.removeRemoteTextTrack(a)}}};i.removeExistingTrack=r;var n=function s(e){r(e,"captions","cc1");r(e,"metadata","Timed Metadata")};i.cleanupTextTracks=n},{}],44:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function o(e){return/mp4a\.\d+.\d+/i.test(e)};var n=function u(e){return/avc1\.[\da-f]+/i.test(e)};var a=function f(e){var t={type:"",parameters:{}};var i=e.trim().split(";");t.type=i.shift().trim();i.forEach(function(e){var i=e.trim().split("=");if(i.length>1){var r=i[0].replace(/"/g,"").trim();var n=i[1].replace(/"/g,"").trim();t.parameters[r]=n}});return t};var s=function d(e){return e.map(function(e){return e.replace(/avc1\.(\d+)\.(\d+)/i,function(e,t,i){var r=("00"+Number(t).toString(16)).slice(-2);var n=("00"+Number(i).toString(16)).slice(-2);return"avc1."+r+"00"+n})})};i["default"]={isAudioCodec:r,parseContentType:a,isVideoCodec:n,translateLegacyCodecs:s};t.exports=i["default"]},{}],45:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=e("./cleanup-text-tracks");var n=function a(e,t,i){var n=t.player_;if(i.captions&&i.captions.length&&!e.inbandTextTrack_){(0,r.removeExistingTrack)(n,"captions","cc1");e.inbandTextTrack_=n.addRemoteTextTrack({kind:"captions",label:"cc1"},false).track}if(i.metadata&&i.metadata.length&&!e.metadataTrack_){(0,r.removeExistingTrack)(n,"metadata","Timed Metadata",true);e.metadataTrack_=n.addRemoteTextTrack({kind:"metadata",label:"Timed Metadata"},false).track;e.metadataTrack_.inBandMetadataTrackDispatchType=i.metadata.dispatchType}};i["default"]=n;t.exports=i["default"]},{"./cleanup-text-tracks":43}],46:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r={TIME_BETWEEN_CHUNKS:1,BYTES_PER_CHUNK:1024*32};i["default"]=r;t.exports=i["default"]},{}],47:[function(e,t,i){(function(r){"use strict";Object.defineProperty(i,"__esModule",{value:true});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,i,r){if(i)e(t.prototype,i);if(r)e(t,r);return t}}();var a=function w(e,t,i){var r=true;e:while(r){var n=e,a=t,s=i;r=false;if(n===null)n=Function.prototype;var o=Object.getOwnPropertyDescriptor(n,a);if(o===undefined){var u=Object.getPrototypeOf(n);if(u===null){return undefined}else{e=u;t=a;i=s;r=true;o=u=undefined;continue e}}else if("value"in o){return o.value}else{var f=o.get;if(f===undefined){return undefined}return f.call(s)}}};function s(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function u(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var f=e("global/document");var d=s(f);var l=typeof window!=="undefined"?window["videojs"]:typeof r!=="undefined"?r["videojs"]:null;var c=s(l);var h=e("./flash-source-buffer");var p=s(h);var m=e("./flash-constants");var v=s(m);var y=e("./codec-utils");var g=e("./cleanup-text-tracks");var b=function(e){u(t,e);function t(){var e=this;o(this,t);a(Object.getPrototypeOf(t.prototype),"constructor",this).call(this);this.sourceBuffers=[];this.readyState="closed";this.on(["sourceopen","webkitsourceopen"],function(t){e.swfObj=d["default"].getElementById(t.swfId);e.player_=(0,c["default"])(e.swfObj.parentNode);e.tech_=e.swfObj.tech;e.readyState="open";e.tech_.on("seeking",function(){var t=e.sourceBuffers.length;while(t--){e.sourceBuffers[t].abort()}});if(e.tech_.hls){e.tech_.hls.on("dispose",function(){(0,g.cleanupTextTracks)(e.player_)})}if(e.swfObj){e.swfObj.vjs_load()}})}n(t,[{key:"addSeekableRange_",value:function i(){}},{key:"addSourceBuffer",value:function r(e){var t=(0,y.parseContentType)(e);var i=undefined;if(t.type==="video/mp2t"){i=new p["default"](this)}else{throw new Error("NotSupportedError (Video.js)")}this.sourceBuffers.push(i);return i}},{key:"endOfStream",value:function s(e){if(e==="network"){this.tech_.error(2)}else if(e==="decode"){this.tech_.error(3)}if(this.readyState!=="ended"){this.readyState="ended";this.swfObj.vjs_endOfStream()}}}]);return t}(c["default"].EventTarget);i["default"]=b;try{Object.defineProperty(b.prototype,"duration",{get:function S(){if(!this.swfObj){return NaN}return this.swfObj.vjs_getProperty("duration")},set:function k(e){var t=undefined;var i=this.swfObj.vjs_getProperty("duration");this.swfObj.vjs_setProperty("duration",e);if(e<i){for(t=0;t<this.sourceBuffers.length;t++){this.sourceBuffers[t].remove(e,i)}}return e}})}catch(_){b.prototype.duration=NaN}for(var T in v["default"]){b[T]=v["default"][T]}t.exports=i["default"]}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./cleanup-text-tracks":43,"./codec-utils":44,"./flash-constants":46,"./flash-source-buffer":48,"global/document":27}],48:[function(e,t,i){(function(r){"use strict";Object.defineProperty(i,"__esModule",{value:true});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,i,r){if(i)e(t.prototype,i);if(r)e(t,r);return t}}();var a=function L(e,t,i){var r=true;e:while(r){var n=e,a=t,s=i;r=false;if(n===null)n=Function.prototype;var o=Object.getOwnPropertyDescriptor(n,a);if(o===undefined){var u=Object.getPrototypeOf(n);if(u===null){return undefined}else{e=u;t=a;i=s;r=true;o=u=undefined;continue e}}else if("value"in o){return o.value}else{var f=o.get;if(f===undefined){return undefined}return f.call(s)}}};function s(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function u(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var f=e("global/window");var d=s(f);var l=typeof window!=="undefined"?window["videojs"]:typeof r!=="undefined"?r["videojs"]:null;var c=s(l);var h=e("mux.js/lib/flv");var p=s(h);var m=e("./remove-cues-from-track");var v=s(m);var y=e("./create-text-tracks-if-necessary");var g=s(y);var b=e("./add-text-track-data");var _=e("./flash-transmuxer-worker");var T=s(_);var w=e("webworkify");var S=s(w);var k=e("./flash-constants");var O=s(k);var P=function I(e){d["default"].setTimeout(e,O["default"].TIME_BETWEEN_CHUNKS)};var A=function C(){return Math.random().toString(36).slice(2,8)};var E=function U(e,t){if(typeof t!=="number"||t<0){t=0}var i=Math.pow(10,t);return Math.round(e*i)/i};var x=function(e){u(t,e);function t(e){var i=this;o(this,t);a(Object.getPrototypeOf(t.prototype),"constructor",this).call(this);var r=undefined;this.chunkSize_=O["default"].BYTES_PER_CHUNK;this.buffer_=[];this.bufferSize_=0;this.basePtsOffset_=NaN;this.mediaSource_=e;this.updating=false;this.timestampOffset_=0;r=d["default"].btoa(String.fromCharCode.apply(null,Array.prototype.slice.call(p["default"].getFlvHeader())));var n=this.mediaSource_.player_.id().replace(/[^a-zA-Z0-9]/g,"_");this.flashEncodedHeaderName_="vjs_flashEncodedHeader_"+n+A();this.flashEncodedDataName_="vjs_flashEncodedData_"+n+A();d["default"][this.flashEncodedHeaderName_]=function(){delete d["default"][i.flashEncodedHeaderName_];return r};this.mediaSource_.swfObj.vjs_appendChunkReady(this.flashEncodedHeaderName_);this.transmuxer_=(0,S["default"])(T["default"]);this.transmuxer_.postMessage({action:"init",options:{}});this.transmuxer_.onmessage=function(e){if(e.data.action==="data"){i.receiveBuffer_(e.data.segment)}};this.one("updateend",function(){i.mediaSource_.tech_.trigger("loadedmetadata")});Object.defineProperty(this,"timestampOffset",{get:function s(){return this.timestampOffset_},set:function u(e){if(typeof e==="number"&&e>=0){this.timestampOffset_=e;this.mediaSource_.swfObj.vjs_discontinuity();this.basePtsOffset_=NaN;this.transmuxer_.postMessage({action:"reset"})}}});Object.defineProperty(this,"buffered",{get:function f(){if(!this.mediaSource_||!this.mediaSource_.swfObj||!("vjs_getProperty"in this.mediaSource_.swfObj)){return c["default"].createTimeRange()}var e=this.mediaSource_.swfObj.vjs_getProperty("buffered");if(e&&e.length){e[0][0]=E(e[0][0],3);e[0][1]=E(e[0][1],3)}return c["default"].createTimeRanges(e)}});this.mediaSource_.player_.on("seeked",function(){(0,v["default"])(0,Infinity,i.metadataTrack_);(0,v["default"])(0,Infinity,i.inbandTextTrack_)});this.mediaSource_.player_.tech_.hls.on("dispose",function(){i.transmuxer_.terminate()})}n(t,[{key:"appendBuffer",value:function i(e){var t=undefined;if(this.updating){t=new Error("SourceBuffer.append() cannot be called "+"while an update is in progress");t.name="InvalidStateError";t.code=11;throw t}this.updating=true;this.mediaSource_.readyState="open";this.trigger({type:"update"});this.transmuxer_.postMessage({action:"push",data:e.buffer,byteOffset:e.byteOffset,byteLength:e.byteLength},[e.buffer]);this.transmuxer_.postMessage({action:"flush"})}},{key:"abort",value:function r(){this.buffer_=[];this.bufferSize_=0;this.mediaSource_.swfObj.vjs_abort();if(this.updating){this.updating=false;this.trigger({type:"updateend"})}}},{key:"remove",value:function s(e,t){(0,v["default"])(e,t,this.metadataTrack_);(0,v["default"])(e,t,this.inbandTextTrack_);this.trigger({type:"update"});this.trigger({type:"updateend"})}},{key:"receiveBuffer_",value:function f(e){var t=this;(0,g["default"])(this,this.mediaSource_,e);(0,b.addTextTrackData)(this,e.captions,e.metadata);P(function(){var i=t.convertTagsToData_(e);if(t.buffer_.length===0){P(t.processBuffer_.bind(t))}if(i){t.buffer_.push(i);t.bufferSize_+=i.byteLength}})}},{key:"processBuffer_",value:function l(){var e=this;var t=O["default"].BYTES_PER_CHUNK;if(!this.buffer_.length){if(this.updating!==false){this.updating=false;this.trigger({type:"updateend"})}return}var i=this.buffer_[0].subarray(0,t);if(i.byteLength<t||this.buffer_[0].byteLength===t){this.buffer_.shift()}else{this.buffer_[0]=this.buffer_[0].subarray(t)}this.bufferSize_-=i.byteLength;var r=[];var n=i.byteLength;for(var a=0;a<n;a++){r.push(String.fromCharCode(i[a]))}var s=d["default"].btoa(r.join(""));d["default"][this.flashEncodedDataName_]=function(){P(e.processBuffer_.bind(e));delete d["default"][e.flashEncodedDataName_];return s};this.mediaSource_.swfObj.vjs_appendChunkReady(this.flashEncodedDataName_)}},{key:"convertTagsToData_",value:function h(e){var t=0;var i=this.mediaSource_.tech_;var r=0;var n=undefined;var a=[];var s=[];var o=e.tags.videoTags;var u=e.tags.audioTags;if(isNaN(this.basePtsOffset_)&&(o.length||u.length)){var f=o[0]||{pts:Infinity};var d=u[0]||{pts:Infinity};this.basePtsOffset_=Math.min(d.pts,f.pts)}if(i.buffered().length){r=i.buffered().end(0)-this.timestampOffset}if(i.seeking()){r=Math.max(r,i.currentTime()-this.timestampOffset)}r*=1e3;r+=this.basePtsOffset_;for(var l=0;l<u.length;l++){if(u[l].pts>=r){a.push(u[l])}}var c=0;while(c<o.length){var h=o[c];if(h.pts>=r){s.push(h)}else if(h.keyFrame){var p=c+1;var m=false;while(p<o.length){var v=o[p];if(v.pts>=r){break}else if(v.keyFrame){m=true;break}else{p++}}if(m){c=p}else{while(c<p){s.push(o[c]);c++}}continue}c++}var y=this.getOrderedTags_(s,a);if(y.length===0){return}for(var l=0;l<y.length;l++){t+=y[l].bytes.byteLength}n=new Uint8Array(t);for(var l=0,g=0;l<y.length;l++){n.set(y[l].bytes,g);g+=y[l].bytes.byteLength}return n}},{key:"getOrderedTags_",value:function m(e,t){var i=undefined;var r=[];while(e.length||t.length){if(!e.length){i=t.shift()}else if(!t.length){i=e.shift()}else if(t[0].dts<e[0].dts){i=t.shift()}else{i=e.shift()}r.push(i)}return r}}]);return t}(c["default"].EventTarget);i["default"]=x;t.exports=i["default"]}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./add-text-track-data":42,"./create-text-tracks-if-necessary":45,"./flash-constants":46,"./flash-transmuxer-worker":49,"./remove-cues-from-track":51,"global/window":28,"mux.js/lib/flv":62,webworkify:76}],49:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,i,r){if(i)e(t.prototype,i);if(r)e(t,r);return t}}();function n(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var s=e("global/window");var o=n(s);var u=e("mux.js/lib/flv");var f=n(u);var d=function h(e){e.on("data",function(e){o["default"].postMessage({action:"data",segment:e})});e.on("done",function(e){o["default"].postMessage({action:"done"})})};var l=function(){function e(t){a(this,e);this.options=t||{};this.init()}r(e,[{key:"init",value:function t(){if(this.transmuxer){this.transmuxer.dispose()}this.transmuxer=new f["default"].Transmuxer(this.options);d(this.transmuxer)}},{key:"push",value:function i(e){var t=new Uint8Array(e.data,e.byteOffset,e.byteLength);this.transmuxer.push(t)}},{key:"reset",value:function n(){this.init()}},{key:"flush",value:function s(){this.transmuxer.flush()}}]);return e}();var c=function p(e){e.onmessage=function(e){if(e.data.action==="init"&&e.data.options){this.messageHandlers=new l(e.data.options);return}if(!this.messageHandlers){this.messageHandlers=new l}if(e.data&&e.data.action&&e.data.action!=="init"){if(this.messageHandlers[e.data.action]){this.messageHandlers[e.data.action](e.data)}}}};i["default"]=function(e){return new c(e)};t.exports=i["default"]},{"global/window":28,"mux.js/lib/flv":62}],50:[function(e,t,i){(function(r){"use strict";Object.defineProperty(i,"__esModule",{value:true});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,i,r){if(i)e(t.prototype,i);if(r)e(t,r);return t}}();var a=function T(e,t,i){var r=true;e:while(r){var n=e,a=t,s=i;r=false;if(n===null)n=Function.prototype;var o=Object.getOwnPropertyDescriptor(n,a);if(o===undefined){var u=Object.getPrototypeOf(n);if(u===null){return undefined}else{e=u;t=a;i=s;r=true;o=u=undefined;continue e}}else if("value"in o){return o.value}else{var f=o.get;if(f===undefined){return undefined}return f.call(s)}}};function s(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function u(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var f=e("global/window");var d=s(f);var l=e("global/document");var c=s(l);var h=typeof window!=="undefined"?window["videojs"]:typeof r!=="undefined"?r["videojs"]:null;var p=s(h);var m=e("./virtual-source-buffer");var v=s(m);var y=e("./add-text-track-data");var g=e("./codec-utils");var b=e("./cleanup-text-tracks");var _=function(e){u(t,e);function t(){var e=this;o(this,t);a(Object.getPrototypeOf(t.prototype),"constructor",this).call(this);var i=undefined;this.nativeMediaSource_=new d["default"].MediaSource;for(i in this.nativeMediaSource_){if(!(i in t.prototype)&&typeof this.nativeMediaSource_[i]==="function"){this[i]=this.nativeMediaSource_[i].bind(this.nativeMediaSource_)}}this.duration_=NaN;Object.defineProperty(this,"duration",{get:function r(){if(this.duration_===Infinity){return this.duration_}return this.nativeMediaSource_.duration},set:function n(e){this.duration_=e;if(e!==Infinity){this.nativeMediaSource_.duration=e;return}}});Object.defineProperty(this,"seekable",{get:function s(){if(this.duration_===Infinity){return p["default"].createTimeRanges([[0,this.nativeMediaSource_.duration]])}return this.nativeMediaSource_.seekable}});Object.defineProperty(this,"readyState",{get:function u(){return this.nativeMediaSource_.readyState}});Object.defineProperty(this,"activeSourceBuffers",{get:function f(){return this.activeSourceBuffers_}});this.sourceBuffers=[];this.activeSourceBuffers_=[];this.updateActiveSourceBuffers_=function(){e.activeSourceBuffers_.length=0;var t=false;var i=true;for(var r=0;r<e.player_.audioTracks().length;r++){var n=e.player_.audioTracks()[r];if(n.enabled&&n.kind!=="main"){t=true;i=false;break}}e.sourceBuffers.forEach(function(r){r.appendAudioInitSegment_=true;if(r.videoCodec_&&r.audioCodec_){r.audioDisabled_=t}else if(r.videoCodec_&&!r.audioCodec_){r.audioDisabled_=true;i=false}else if(!r.videoCodec_&&r.audioCodec_){r.audioDisabled_=i;if(i){return}}e.activeSourceBuffers_.push(r)})};this.onPlayerMediachange_=function(){e.sourceBuffers.forEach(function(e){e.appendAudioInitSegment_=true})};["sourceopen","sourceclose","sourceended"].forEach(function(e){this.nativeMediaSource_.addEventListener(e,this.trigger.bind(this))},this);this.on("sourceopen",function(t){var i=c["default"].querySelector('[src="'+e.url_+'"]');if(!i){return}e.player_=(0,p["default"])(i.parentNode);if(e.player_.audioTracks&&e.player_.audioTracks()){e.player_.audioTracks().on("change",e.updateActiveSourceBuffers_);e.player_.audioTracks().on("addtrack",e.updateActiveSourceBuffers_);e.player_.audioTracks().on("removetrack",e.updateActiveSourceBuffers_)}e.player_.on("mediachange",e.onPlayerMediachange_)});this.on("sourceended",function(t){var i=(0,y.durationOfVideo)(e.duration);for(var r=0;r<e.sourceBuffers.length;r++){var n=e.sourceBuffers[r];var a=n.metadataTrack_&&n.metadataTrack_.cues;if(a&&a.length){a[a.length-1].endTime=i}}});this.on("sourceclose",function(e){this.sourceBuffers.forEach(function(e){if(e.transmuxer_){e.transmuxer_.terminate()}});this.sourceBuffers.length=0;if(!this.player_){return}(0,b.cleanupTextTracks)(this.player_);if(this.player_.audioTracks&&this.player_.audioTracks()){this.player_.audioTracks().off("change",this.updateActiveSourceBuffers_);this.player_.audioTracks().off("addtrack",this.updateActiveSourceBuffers_);this.player_.audioTracks().off("removetrack",this.updateActiveSourceBuffers_)}if(this.player_.el_){this.player_.off("mediachange",this.onPlayerMediachange_)}})}n(t,[{key:"addSeekableRange_",value:function i(e,t){var i=undefined;if(this.duration!==Infinity){i=new Error("MediaSource.addSeekableRange() can only be invoked "+"when the duration is Infinity");i.name="InvalidStateError";i.code=11;throw i}if(t>this.nativeMediaSource_.duration||isNaN(this.nativeMediaSource_.duration)){this.nativeMediaSource_.duration=t}}},{key:"addSourceBuffer",value:function r(e){var t=undefined;var i=(0,g.parseContentType)(e);if(/^(video|audio)\/mp2t$/i.test(i.type)){var r=[];if(i.parameters&&i.parameters.codecs){r=i.parameters.codecs.split(",");r=(0,g.translateLegacyCodecs)(r);r=r.filter(function(e){return(0,g.isAudioCodec)(e)||(0,g.isVideoCodec)(e)})}if(r.length===0){r=["avc1.4d400d","mp4a.40.2"]}t=new v["default"](this,r);if(this.sourceBuffers.length!==0){this.sourceBuffers[0].createRealSourceBuffers_();t.createRealSourceBuffers_();this.sourceBuffers[0].audioDisabled_=true}}else{t=this.nativeMediaSource_.addSourceBuffer(e)}this.sourceBuffers.push(t);return t}}]);return t}(p["default"].EventTarget);i["default"]=_;t.exports=i["default"]}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./add-text-track-data":42,"./cleanup-text-tracks":43,"./codec-utils":44,"./virtual-source-buffer":54,"global/document":27,"global/window":28}],51:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function n(e,t,i){var r=undefined;var n=undefined;if(!i){return}if(!i.cues){return}r=i.cues.length;while(r--){n=i.cues[r];if(n.startTime<=t&&n.endTime>=e){i.removeCue(n)}}};i["default"]=r;t.exports=i["default"]},{}],52:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:true});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,i,r){if(i)e(t.prototype,i);if(r)e(t,r);return t}}();function n(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}var s=e("global/window");var o=n(s);var u=e("mux.js/lib/mp4");var f=n(u);var d=function h(e){e.on("data",function(e){var t=e.initSegment;e.initSegment={data:t.buffer,byteOffset:t.byteOffset,byteLength:t.byteLength};var i=e.data;e.data=i.buffer;o["default"].postMessage({action:"data",segment:e,byteOffset:i.byteOffset,byteLength:i.byteLength},[e.data])});if(e.captionStream){e.captionStream.on("data",function(e){o["default"].postMessage({action:"caption",data:e})})}e.on("done",function(e){o["default"].postMessage({action:"done"})})};var l=function(){function e(t){a(this,e);this.options=t||{};this.init()}r(e,[{key:"init",value:function t(){if(this.transmuxer){this.transmuxer.dispose()}this.transmuxer=new f["default"].Transmuxer(this.options);d(this.transmuxer)}},{key:"push",value:function i(e){var t=new Uint8Array(e.data,e.byteOffset,e.byteLength);this.transmuxer.push(t)}},{key:"reset",value:function n(){this.init()}},{key:"setTimestampOffset",value:function s(e){var t=e.timestampOffset||0;this.transmuxer.setBaseMediaDecodeTime(Math.round(t*9e4))}},{key:"setAudioAppendStart",value:function o(e){this.transmuxer.setAudioAppendStart(Math.ceil(e.appendStart*9e4))}},{key:"flush",value:function u(e){this.transmuxer.flush()}}]);return e}();var c=function p(e){e.onmessage=function(e){if(e.data.action==="init"&&e.data.options){this.messageHandlers=new l(e.data.options);return}if(!this.messageHandlers){this.messageHandlers=new l}if(e.data&&e.data.action&&e.data.action!=="init"){if(this.messageHandlers[e.data.action]){this.messageHandlers[e.data.action](e.data)}}}};i["default"]=function(e){return new c(e)};t.exports=i["default"]},{"global/window":28,"mux.js/lib/mp4":70}],53:[function(e,t,i){(function(t){"use strict";Object.defineProperty(i,"__esModule",{value:true});function r(e){return e&&e.__esModule?e:{"default":e}}var n=e("global/window");var a=r(n);var s=e("./flash-media-source");var o=r(s);var u=e("./html-media-source");var f=r(u);var d=typeof window!=="undefined"?window["videojs"]:typeof t!=="undefined"?t["videojs"]:null;var l=r(d);var c=0;var h={mode:"auto"};l["default"].mediaSources={};var p=function g(e,t){var i=l["default"].mediaSources[e];if(i){i.trigger({type:"sourceopen",swfId:t})}else{throw new Error("Media Source not found (Video.js)")}};var m=function b(){return!!a["default"].MediaSource&&!!a["default"].MediaSource.isTypeSupported&&a["default"].MediaSource.isTypeSupported('video/mp4;codecs="avc1.4d400d,mp4a.40.2"')};var v=function _(e){var t=l["default"].mergeOptions(h,e);this.MediaSource={open:p,supportsNativeMediaSources:m};if(t.mode==="html5"||t.mode==="auto"&&m()){return new f["default"]}return new o["default"]};i.MediaSource=v;v.open=p;v.supportsNativeMediaSources=m;var y={createObjectURL:function T(e){var t="blob:vjs-media-source/";var i=undefined;if(e instanceof f["default"]){i=a["default"].URL.createObjectURL(e.nativeMediaSource_);e.url_=i;return i}if(!(e instanceof o["default"])){i=a["default"].URL.createObjectURL(e);e.url_=i;return i}i=t+c;c++;l["default"].mediaSources[i]=e;return i}};i.URL=y;l["default"].MediaSource=v;l["default"].URL=y}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{});

},{"./flash-media-source":47,"./html-media-source":50,"global/window":28}],54:[function(e,t,i){(function(r){"use strict";Object.defineProperty(i,"__esModule",{value:true});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,i,r){if(i)e(t.prototype,i);if(r)e(t,r);return t}}();var a=function w(e,t,i){var r=true;e:while(r){var n=e,a=t,s=i;r=false;if(n===null)n=Function.prototype;var o=Object.getOwnPropertyDescriptor(n,a);if(o===undefined){var u=Object.getPrototypeOf(n);if(u===null){return undefined}else{e=u;t=a;i=s;r=true;o=u=undefined;continue e}}else if("value"in o){return o.value}else{var f=o.get;if(f===undefined){return undefined}return f.call(s)}}};function s(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function u(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var f=typeof window!=="undefined"?window["videojs"]:typeof r!=="undefined"?r["videojs"]:null;var d=s(f);var l=e("./create-text-tracks-if-necessary");var c=s(l);var h=e("./remove-cues-from-track");var p=s(h);var m=e("./add-text-track-data");var v=e("webworkify");var y=s(v);var g=e("./transmuxer-worker");var b=s(g);var _=e("./codec-utils");var T=function(e){u(t,e);function t(e,i){var r=this;o(this,t);a(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,d["default"].EventTarget);this.timestampOffset_=0;this.pendingBuffers_=[];this.bufferUpdating_=false;this.mediaSource_=e;this.codecs_=i;this.audioCodec_=null;this.videoCodec_=null;this.audioDisabled_=false;this.appendAudioInitSegment_=true;var n={remux:false};this.codecs_.forEach(function(e){if((0,_.isAudioCodec)(e)){r.audioCodec_=e}else if((0,_.isVideoCodec)(e)){r.videoCodec_=e}});this.transmuxer_=(0,y["default"])(b["default"]);this.transmuxer_.postMessage({action:"init",options:n});this.transmuxer_.onmessage=function(e){if(e.data.action==="data"){return r.data_(e)}if(e.data.action==="done"){return r.done_(e)}};Object.defineProperty(this,"timestampOffset",{get:function s(){return this.timestampOffset_},set:function u(e){if(typeof e==="number"&&e>=0){this.timestampOffset_=e;this.appendAudioInitSegment_=true;this.transmuxer_.postMessage({action:"setTimestampOffset",timestampOffset:e})}}});Object.defineProperty(this,"appendWindowStart",{get:function f(){return(this.videoBuffer_||this.audioBuffer_).appendWindowStart},set:function l(e){if(this.videoBuffer_){this.videoBuffer_.appendWindowStart=e}if(this.audioBuffer_){this.audioBuffer_.appendWindowStart=e}}});Object.defineProperty(this,"updating",{get:function c(){return!!(this.bufferUpdating_||!this.audioDisabled_&&this.audioBuffer_&&this.audioBuffer_.updating||this.videoBuffer_&&this.videoBuffer_.updating)}});Object.defineProperty(this,"buffered",{get:function h(){var e=null;var t=null;var i=0;var r=[];var n=[];if(!this.videoBuffer_&&!this.audioBuffer_){return d["default"].createTimeRange()}if(!this.videoBuffer_){return this.audioBuffer_.buffered}if(!this.audioBuffer_){return this.videoBuffer_.buffered}if(this.audioDisabled_){return this.videoBuffer_.buffered}if(this.videoBuffer_.buffered.length===0&&this.audioBuffer_.buffered.length===0){return d["default"].createTimeRange()}var a=this.videoBuffer_.buffered;var s=this.audioBuffer_.buffered;var o=a.length;while(o--){r.push({time:a.start(o),type:"start"});r.push({time:a.end(o),type:"end"})}o=s.length;while(o--){r.push({time:s.start(o),type:"start"});r.push({time:s.end(o),type:"end"})}r.sort(function(e,t){return e.time-t.time});for(o=0;o<r.length;o++){if(r[o].type==="start"){i++;if(i===2){e=r[o].time}}else if(r[o].type==="end"){i--;if(i===1){t=r[o].time}}if(e!==null&&t!==null){n.push([e,t]);e=null;t=null}}return d["default"].createTimeRanges(n)}})}n(t,[{key:"data_",value:function i(e){var t=e.data.segment;t.data=new Uint8Array(t.data,e.data.byteOffset,e.data.byteLength);t.initSegment=new Uint8Array(t.initSegment.data,t.initSegment.byteOffset,t.initSegment.byteLength);(0,c["default"])(this,this.mediaSource_,t);this.pendingBuffers_.push(t);return}},{key:"done_",value:function r(e){this.processPendingSegments_();return}},{key:"createRealSourceBuffers_",value:function s(){var e=this;var t=["audio","video"];t.forEach(function(i){if(!e[i+"Codec_"]){return}if(e[i+"Buffer_"]){return}var r=null;if(e.mediaSource_[i+"Buffer_"]){r=e.mediaSource_[i+"Buffer_"]}else{r=e.mediaSource_.nativeMediaSource_.addSourceBuffer(i+'/mp4;codecs="'+e[i+"Codec_"]+'"');e.mediaSource_[i+"Buffer_"]=r}e[i+"Buffer_"]=r;["update","updatestart","updateend"].forEach(function(n){r.addEventListener(n,function(){if(i==="audio"&&e.audioDisabled_){return}var r=t.every(function(t){if(t==="audio"&&e.audioDisabled_){return true}if(i!==t&&e[t+"Buffer_"]&&e[t+"Buffer_"].updating){return false}return true});if(r){return e.trigger(n)}})})})}},{key:"appendBuffer",value:function f(e){this.bufferUpdating_=true;if(this.audioBuffer_&&this.audioBuffer_.buffered.length){var t=this.audioBuffer_.buffered;this.transmuxer_.postMessage({action:"setAudioAppendStart",appendStart:t.end(t.length-1)})}this.transmuxer_.postMessage({action:"push",data:e.buffer,byteOffset:e.byteOffset,byteLength:e.byteLength},[e.buffer]);this.transmuxer_.postMessage({action:"flush"})}},{key:"remove",value:function l(e,t){if(this.videoBuffer_){this.videoBuffer_.remove(e,t)}if(this.audioBuffer_){this.audioBuffer_.remove(e,t)}(0,p["default"])(e,t,this.metadataTrack_);(0,p["default"])(e,t,this.inbandTextTrack_)}},{key:"processPendingSegments_",value:function h(){var e={video:{segments:[],bytes:0},audio:{segments:[],bytes:0},captions:[],metadata:[]};e=this.pendingBuffers_.reduce(function(e,t){var i=t.type;var r=t.data;var n=t.initSegment;e[i].segments.push(r);e[i].bytes+=r.byteLength;e[i].initSegment=n;if(t.captions){e.captions=e.captions.concat(t.captions)}if(t.info){e[i].info=t.info}if(t.metadata){e.metadata=e.metadata.concat(t.metadata)}return e},e);if(!this.videoBuffer_&&!this.audioBuffer_){if(e.video.bytes===0){this.videoCodec_=null}if(e.audio.bytes===0){this.audioCodec_=null}this.createRealSourceBuffers_()}if(e.audio.info){this.mediaSource_.trigger({type:"audioinfo",info:e.audio.info})}if(e.video.info){this.mediaSource_.trigger({type:"videoinfo",info:e.video.info})}if(this.appendAudioInitSegment_){if(!this.audioDisabled_&&this.audioBuffer_){e.audio.segments.unshift(e.audio.initSegment);e.audio.bytes+=e.audio.initSegment.byteLength}this.appendAudioInitSegment_=false}if(this.videoBuffer_){e.video.segments.unshift(e.video.initSegment);e.video.bytes+=e.video.initSegment.byteLength;this.concatAndAppendSegments_(e.video,this.videoBuffer_);(0,m.addTextTrackData)(this,e.captions,e.metadata)}if(!this.audioDisabled_&&this.audioBuffer_){this.concatAndAppendSegments_(e.audio,this.audioBuffer_)}this.pendingBuffers_.length=0;this.bufferUpdating_=false}},{key:"concatAndAppendSegments_",value:function v(e,t){var i=0;var r=undefined;if(e.bytes){r=new Uint8Array(e.bytes);e.segments.forEach(function(e){r.set(e,i);i+=e.byteLength});try{t.appendBuffer(r)}catch(n){if(this.mediaSource_.player_){this.mediaSource_.player_.error({code:-3,type:"APPEND_BUFFER_ERR",message:n.message,originalError:n})}}}}},{key:"abort",value:function g(){if(this.videoBuffer_){this.videoBuffer_.abort()}if(this.audioBuffer_){this.audioBuffer_.abort()}if(this.transmuxer_){this.transmuxer_.postMessage({action:"reset"})}this.pendingBuffers_.length=0;this.bufferUpdating_=false}}]);return t}(d["default"].EventTarget);i["default"]=T;t.exports=i["default"]}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./add-text-track-data":42,"./codec-utils":44,"./create-text-tracks-if-necessary":45,"./remove-cues-from-track":51,"./transmuxer-worker":52,webworkify:76}],55:[function(e,t,i){"use strict";var r=e("../utils/stream.js");var n;n=function(){var e=new Uint8Array,t=0;n.prototype.init.call(this);this.setTimestamp=function(e){t=e};this.parseId3TagSize=function(e,t){var i=e[t+6]<<21|e[t+7]<<14|e[t+8]<<7|e[t+9],r=e[t+5],n=(r&16)>>4;if(n){return i+20}return i+10};this.parseAdtsSize=function(e,t){var i=(e[t+5]&224)>>5,r=e[t+4]<<3,n=e[t+3]&3<<11;return n|r|i};this.push=function(i){var r=0,n=0,a,s,o,u;if(e.length){u=e.length;e=new Uint8Array(i.byteLength+u);e.set(e.subarray(0,u));e.set(i,u)}else{e=i}while(e.length-n>=3){if(e[n]==="I".charCodeAt(0)&&e[n+1]==="D".charCodeAt(0)&&e[n+2]==="3".charCodeAt(0)){if(e.length-n<10){break}r=this.parseId3TagSize(e,n);if(r>e.length){break}s={type:"timed-metadata",data:e.subarray(n,n+r)};this.trigger("data",s);n+=r;continue}else if(e[n]&255===255&&(e[n+1]&240)===240){if(e.length-n<7){break}r=this.parseAdtsSize(e,n);if(r>e.length){break}o={type:"audio",data:e.subarray(n,n+r),pts:t,dts:t};this.trigger("data",o);n+=r;continue}n++}a=e.length-n;if(a>0){e=e.subarray(n)}else{e=new Uint8Array}}};n.prototype=new r;t.exports=n},{"../utils/stream.js":75}],56:[function(e,t,i){"use strict";var r=e("../utils/stream.js");var n;var a=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];n=function(){var e;n.prototype.init.call(this);this.push=function(t){var i=0,r=0,n,s,o,u,f,d;if(t.type!=="audio"){return}if(e){u=e;e=new Uint8Array(u.byteLength+t.data.byteLength);e.set(u);e.set(t.data,u.byteLength)}else{e=t.data}while(i+5<e.length){if(e[i]!==255||(e[i+1]&246)!==240){i++;continue}s=(~e[i+1]&1)*2;n=(e[i+3]&3)<<11|e[i+4]<<3|(e[i+5]&224)>>5;f=((e[i+6]&3)+1)*1024;d=f*9e4/a[(e[i+2]&60)>>>2];o=i+n;if(e.byteLength<o){return}this.trigger("data",{pts:t.pts+r*d,dts:t.dts+r*d,sampleCount:f,audioobjecttype:(e[i+2]>>>6&3)+1,channelcount:(e[i+2]&1)<<2|(e[i+3]&192)>>>6,samplerate:a[(e[i+2]&60)>>>2],samplingfrequencyindex:(e[i+2]&60)>>>2,samplesize:16,data:e.subarray(i+7+s,o)});if(e.byteLength===o){e=undefined;return}r++;e=e.subarray(o)}};this.flush=function(){this.trigger("done")}};n.prototype=new r;t.exports=n},{"../utils/stream.js":75}],57:[function(e,t,i){"use strict";var r=e("../utils/stream.js");var n=e("../utils/exp-golomb.js");var a,s;var o;s=function(){var e=0,t,i;s.prototype.init.call(this);this.push=function(r){var n;if(!i){i=r.data}else{n=new Uint8Array(i.byteLength+r.data.byteLength);n.set(i);n.set(r.data,i.byteLength);i=n}for(;e<i.byteLength-3;e++){if(i[e+2]===1){t=e+5;break}}while(t<i.byteLength){switch(i[t]){case 0:if(i[t-1]!==0){t+=2;break}else if(i[t-2]!==0){t++;break}if(e+3!==t-2){this.trigger("data",i.subarray(e+3,t-2))}do{t++}while(i[t]!==1&&t<i.length);e=t-2;t+=3;break;case 1:if(i[t-1]!==0||i[t-2]!==0){t+=3;break}this.trigger("data",i.subarray(e+3,t-2));e=t-2;t+=3;break;default:t+=3;break}}i=i.subarray(e);t-=e;e=0};this.flush=function(){if(i&&i.byteLength>3){this.trigger("data",i.subarray(e+3))}i=null;e=0;this.trigger("done")}};s.prototype=new r;o={100:true,110:true,122:true,244:true,44:true,83:true,86:true,118:true,128:true,138:true,139:true,134:true};a=function(){var e=new s,t,i,r,u,f,d,l;a.prototype.init.call(this);t=this;this.push=function(t){if(t.type!=="video"){return}i=t.trackId;r=t.pts;u=t.dts;e.push(t)};e.on("data",function(e){var n={trackId:i,pts:r,dts:u,data:e};switch(e[0]&31){case 5:n.nalUnitType="slice_layer_without_partitioning_rbsp_idr";break;case 6:n.nalUnitType="sei_rbsp";n.escapedRBSP=f(e.subarray(1));break;case 7:n.nalUnitType="seq_parameter_set_rbsp";n.escapedRBSP=f(e.subarray(1));n.config=d(n.escapedRBSP);break;case 8:n.nalUnitType="pic_parameter_set_rbsp";break;case 9:n.nalUnitType="access_unit_delimiter_rbsp";break;default:break}t.trigger("data",n)});e.on("done",function(){t.trigger("done")});this.flush=function(){e.flush()};l=function(e,t){var i=8,r=8,n,a;for(n=0;n<e;n++){if(r!==0){a=t.readExpGolomb();r=(i+a+256)%256}i=r===0?i:r}};f=function(e){var t=e.byteLength,i=[],r=1,n,a;while(r<t-2){if(e[r]===0&&e[r+1]===0&&e[r+2]===3){i.push(r+2);r+=2}else{r++}}if(i.length===0){return e}n=t-i.length;a=new Uint8Array(n);var s=0;for(r=0;r<n;s++,r++){if(s===i[0]){s++;i.shift()}a[r]=e[s]}return a};d=function(e){var t=0,i=0,r=0,a=0,s=1,u,f,d,c,h,p,m,v,y,g,b,_,T,w;u=new n(e);f=u.readUnsignedByte();c=u.readUnsignedByte();d=u.readUnsignedByte();u.skipUnsignedExpGolomb();if(o[f]){h=u.readUnsignedExpGolomb();if(h===3){u.skipBits(1)}u.skipUnsignedExpGolomb();u.skipUnsignedExpGolomb();u.skipBits(1);if(u.readBoolean()){b=h!==3?8:12;for(w=0;w<b;w++){if(u.readBoolean()){if(w<6){l(16,u)}else{l(64,u)}}}}}u.skipUnsignedExpGolomb();p=u.readUnsignedExpGolomb();if(p===0){u.readUnsignedExpGolomb()}else if(p===1){u.skipBits(1);u.skipExpGolomb();u.skipExpGolomb();m=u.readUnsignedExpGolomb();for(w=0;w<m;w++){u.skipExpGolomb()}}u.skipUnsignedExpGolomb();u.skipBits(1);v=u.readUnsignedExpGolomb();y=u.readUnsignedExpGolomb();g=u.readBits(1);if(g===0){u.skipBits(1)}u.skipBits(1);if(u.readBoolean()){t=u.readUnsignedExpGolomb();i=u.readUnsignedExpGolomb();r=u.readUnsignedExpGolomb();a=u.readUnsignedExpGolomb()}if(u.readBoolean()){if(u.readBoolean()){T=u.readUnsignedByte();switch(T){case 1:_=[1,1];break;case 2:_=[12,11];break;case 3:_=[10,11];break;case 4:_=[16,11];break;case 5:_=[40,33];break;case 6:_=[24,11];break;case 7:_=[20,11];break;case 8:_=[32,11];break;case 9:_=[80,33];break;case 10:_=[18,11];break;case 11:_=[15,11];break;case 12:_=[64,33];break;case 13:_=[160,99];break;case 14:_=[4,3];break;case 15:_=[3,2];break;case 16:_=[2,1];break;case 255:{_=[u.readUnsignedByte()<<8|u.readUnsignedByte(),u.readUnsignedByte()<<8|u.readUnsignedByte()];break}}if(_){s=_[0]/_[1]}}}return{profileIdc:f,levelIdc:d,profileCompatibility:c,width:Math.ceil(((v+1)*16-t*2-i*2)*s),height:(2-g)*(y+1)*16-r*2-a*2}}};a.prototype=new r;t.exports={H264Stream:a,NalByteStream:s}},{"../utils/exp-golomb.js":74,"../utils/stream.js":75}],58:[function(e,t,i){var r=[33,16,5,32,164,27];var n=[33,65,108,84,1,2,4,8,168,2,4,8,17,191,252];var a=function(e){var t=[];while(e--){t.push(0)}return t};var s=function(e){return Object.keys(e).reduce(function(t,i){t[i]=new Uint8Array(e[i].reduce(function(e,t){return e.concat(t)},[]));return t},{})};var o={96e3:[r,[227,64],a(154),[56]],88200:[r,[231],a(170),[56]],64e3:[r,[248,192],a(240),[56]],48e3:[r,[255,192],a(268),[55,148,128],a(54),[112]],44100:[r,[255,192],a(268),[55,163,128],a(84),[112]],32e3:[r,[255,192],a(268),[55,234],a(226),[112]],24e3:[r,[255,192],a(268),[55,255,128],a(268),[111,112],a(126),[224]],16e3:[r,[255,192],a(268),[55,255,128],a(268),[111,255],a(269),[223,108],a(195),[1,192]],12e3:[n,a(268),[3,127,248],a(268),[6,255,240],a(268),[13,255,224],a(268),[27,253,128],a(259),[56]],11025:[n,a(268),[3,127,248],a(268),[6,255,240],a(268),[13,255,224],a(268),[27,255,192],a(268),[55,175,128],a(108),[112]],8e3:[n,a(268),[3,121,16],a(47),[7]]};t.exports=s(o)},{}],59:[function(e,t,i){"use strict";var r=e("../utils/stream.js");var n=function(e){this.numberOfTracks=0;this.metadataStream=e.metadataStream;this.videoTags=[];this.audioTags=[];this.videoTrack=null;this.audioTrack=null;this.pendingCaptions=[];this.pendingMetadata=[];this.pendingTracks=0;this.processedTracks=0;n.prototype.init.call(this);this.push=function(e){if(e.text){return this.pendingCaptions.push(e)}if(e.frames){return this.pendingMetadata.push(e)}if(e.track.type==="video"){this.videoTrack=e.track;this.videoTags=e.tags;this.pendingTracks++}if(e.track.type==="audio"){this.audioTrack=e.track;this.audioTags=e.tags;this.pendingTracks++}}};n.prototype=new r;n.prototype.flush=function(e){var t,i,r,n,a={tags:{},captions:[],metadata:[]};if(this.pendingTracks<this.numberOfTracks){if(e!=="VideoSegmentStream"&&e!=="AudioSegmentStream"){return}else if(this.pendingTracks===0){this.processedTracks++;if(this.processedTracks<this.numberOfTracks){return}}}this.processedTracks+=this.pendingTracks;this.pendingTracks=0;if(this.processedTracks<this.numberOfTracks){return}if(this.videoTrack){n=this.videoTrack.timelineStartInfo.pts}else if(this.audioTrack){n=this.audioTrack.timelineStartInfo.pts}a.tags.videoTags=this.videoTags;a.tags.audioTags=this.audioTags;for(r=0;r<this.pendingCaptions.length;r++){i=this.pendingCaptions[r];i.startTime=i.startPts-n;i.startTime/=9e4;i.endTime=i.endPts-n;i.endTime/=9e4;a.captions.push(i)}for(r=0;r<this.pendingMetadata.length;r++){t=this.pendingMetadata[r];t.cueTime=t.pts-n;t.cueTime/=9e4;a.metadata.push(t)}a.metadata.dispatchType=this.metadataStream.dispatchType;this.videoTrack=null;this.audioTrack=null;this.videoTags=[];this.audioTags=[];this.pendingCaptions.length=0;this.pendingMetadata.length=0;this.pendingTracks=0;this.processedTracks=0;this.trigger("data",a);this.trigger("done")};t.exports=n},{"../utils/stream.js":75}],60:[function(e,t,i){"use strict";var r=e("./flv-tag.js");var n=function(e,t,i){var n=new Uint8Array(3+1+1+4),a=new DataView(n.buffer),s,o,u;e=e||0;t=t===undefined?true:t;i=i===undefined?true:i;a.setUint8(0,70);a.setUint8(1,76);a.setUint8(2,86);a.setUint8(3,1);a.setUint8(4,(t?4:0)|(i?1:0));a.setUint32(5,n.byteLength);if(e<=0){o=new Uint8Array(n.byteLength+4);o.set(n);o.set([0,0,0,0],n.byteLength);return o}s=new r(r.METADATA_TAG);s.pts=s.dts=0;s.writeMetaDataDouble("duration",e);u=s.finalize().length;o=new Uint8Array(n.byteLength+u);o.set(n);o.set(a.byteLength,u);return o};t.exports=n},{"./flv-tag.js":61}],61:[function(e,t,i){"use strict";var r;r=function(e,t){var i=0,n=16384,a=function(e,t){var i,r=e.position+t;if(r<e.bytes.byteLength){return}i=new Uint8Array(r*2);i.set(e.bytes.subarray(0,e.position),0);e.bytes=i;e.view=new DataView(e.bytes.buffer)},s=r.widthBytes||new Uint8Array("width".length),o=r.heightBytes||new Uint8Array("height".length),u=r.videocodecidBytes||new Uint8Array("videocodecid".length),f;if(!r.widthBytes){for(f=0;f<"width".length;f++){s[f]="width".charCodeAt(f)}for(f=0;f<"height".length;f++){o[f]="height".charCodeAt(f)}for(f=0;f<"videocodecid".length;f++){u[f]="videocodecid".charCodeAt(f)}r.widthBytes=s;r.heightBytes=o;r.videocodecidBytes=u}this.keyFrame=false;switch(e){case r.VIDEO_TAG:this.length=16;n*=6;break;case r.AUDIO_TAG:this.length=13;this.keyFrame=true;break;case r.METADATA_TAG:this.length=29;this.keyFrame=true;break;default:throw new Error("Unknown FLV tag type")}this.bytes=new Uint8Array(n);this.view=new DataView(this.bytes.buffer);this.bytes[0]=e;this.position=this.length;this.keyFrame=t;this.pts=0;this.dts=0;this.writeBytes=function(e,t,i){var r=t||0,n;i=i||e.byteLength;n=r+i;a(this,i);this.bytes.set(e.subarray(r,n),this.position);this.position+=i;this.length=Math.max(this.length,this.position)};this.writeByte=function(e){a(this,1);this.bytes[this.position]=e;this.position++;this.length=Math.max(this.length,this.position)};this.writeShort=function(e){a(this,2);this.view.setUint16(this.position,e);this.position+=2;this.length=Math.max(this.length,this.position)};this.negIndex=function(e){return this.bytes[this.length-e]};this.nalUnitSize=function(){if(i===0){return 0}return this.length-(i+4)};this.startNalUnit=function(){if(i>0){throw new Error("Attempted to create new NAL wihout closing the old one")}i=this.length;this.length+=4;this.position=this.length};this.endNalUnit=function(e){var t,r;if(this.length===i+4){this.length-=4}else if(i>0){t=i+4;r=this.length-t;this.position=i;this.view.setUint32(this.position,r);this.position=this.length;if(e){e.push(this.bytes.subarray(t,t+r))}}i=0};this.writeMetaDataDouble=function(e,t){var r;a(this,2+e.length+9);this.view.setUint16(this.position,e.length);this.position+=2;if(e==="width"){this.bytes.set(s,this.position);this.position+=5}else if(e==="height"){this.bytes.set(o,this.position);this.position+=6}else if(e==="videocodecid"){this.bytes.set(u,this.position);this.position+=12}else{for(r=0;r<e.length;r++){this.bytes[this.position]=e.charCodeAt(r);this.position++}}this.position++;this.view.setFloat64(this.position,t);this.position+=8;this.length=Math.max(this.length,this.position);++i};this.writeMetaDataBoolean=function(e,t){var r;a(this,2);this.view.setUint16(this.position,e.length);this.position+=2;for(r=0;r<e.length;r++){a(this,1);this.bytes[this.position]=e.charCodeAt(r);this.position++}a(this,2);this.view.setUint8(this.position,1);this.position++;this.view.setUint8(this.position,t?1:0);this.position++;this.length=Math.max(this.length,this.position);++i};this.finalize=function(){var e,n;switch(this.bytes[0]){case r.VIDEO_TAG:this.bytes[11]=(this.keyFrame||t?16:32)|7;this.bytes[12]=t?0:1;e=this.pts-this.dts;this.bytes[13]=(e&16711680)>>>16;this.bytes[14]=(e&65280)>>>8;this.bytes[15]=(e&255)>>>0;break;case r.AUDIO_TAG:this.bytes[11]=175;this.bytes[12]=t?0:1;break;case r.METADATA_TAG:this.position=11;this.view.setUint8(this.position,2);this.position++;this.view.setUint16(this.position,10);this.position+=2;this.bytes.set([111,110,77,101,116,97,68,97,116,97],this.position);this.position+=10;this.bytes[this.position]=8;this.position++;this.view.setUint32(this.position,i);this.position=this.length;this.bytes.set([0,0,9],this.position);this.position+=3;this.length=this.position;break}n=this.length-11;this.bytes[1]=(n&16711680)>>>16;this.bytes[2]=(n&65280)>>>8;this.bytes[3]=(n&255)>>>0;this.bytes[4]=(this.dts&16711680)>>>16;this.bytes[5]=(this.dts&65280)>>>8;this.bytes[6]=(this.dts&255)>>>0;this.bytes[7]=(this.dts&4278190080)>>>24;this.bytes[8]=0;this.bytes[9]=0;this.bytes[10]=0;a(this,4);this.view.setUint32(this.length,this.length);this.length+=4;this.position+=4;this.bytes=this.bytes.subarray(0,this.length);this.frameTime=r.frameTime(this.bytes);return this}};r.AUDIO_TAG=8;r.VIDEO_TAG=9;r.METADATA_TAG=18;r.isAudioFrame=function(e){return r.AUDIO_TAG===e[0]};r.isVideoFrame=function(e){return r.VIDEO_TAG===e[0]};r.isMetaData=function(e){return r.METADATA_TAG===e[0]};r.isKeyFrame=function(e){if(r.isVideoFrame(e)){return e[11]===23}if(r.isAudioFrame(e)){return true}if(r.isMetaData(e)){return true}return false};r.frameTime=function(e){var t=e[4]<<16;t|=e[5]<<8;t|=e[6]<<0;t|=e[7]<<24;return t};t.exports=r},{}],62:[function(e,t,i){t.exports={tag:e("./flv-tag"),Transmuxer:e("./transmuxer"),getFlvHeader:e("./flv-header")}},{"./flv-header":60,"./flv-tag":61,"./transmuxer":64}],63:[function(e,t,i){"use strict";var r=function(){var e=this;this.list=[];this.push=function(e){this.list.push({bytes:e.bytes,dts:e.dts,pts:e.pts})};Object.defineProperty(this,"length",{get:function(){return e.list.length}})};t.exports=r},{}],64:[function(e,t,i){"use strict";var r=e("../utils/stream.js");var n=e("./flv-tag.js");var a=e("../m2ts/m2ts.js");var s=e("../codecs/adts.js");var o=e("../codecs/h264").H264Stream;var u=e("./coalesce-stream.js");var f=e("./tag-list.js");var d,l,c,h,p,m;h=function(e,t){if(typeof t.pts==="number"){if(e.timelineStartInfo.pts===undefined){e.timelineStartInfo.pts=t.pts}else{e.timelineStartInfo.pts=Math.min(e.timelineStartInfo.pts,t.pts)}}if(typeof t.dts==="number"){if(e.timelineStartInfo.dts===undefined){e.timelineStartInfo.dts=t.dts}else{e.timelineStartInfo.dts=Math.min(e.timelineStartInfo.dts,t.dts)}}};p=function(e,t){var i=new n(n.METADATA_TAG);i.dts=t;i.pts=t;i.writeMetaDataDouble("videocodecid",7);i.writeMetaDataDouble("width",e.width);i.writeMetaDataDouble("height",e.height);return i};m=function(e,t){var i,r=new n(n.VIDEO_TAG,true);r.dts=t;r.pts=t;r.writeByte(1);r.writeByte(e.profileIdc);r.writeByte(e.profileCompatibility);r.writeByte(e.levelIdc);r.writeByte(252|3);r.writeByte(224|1);r.writeShort(e.sps[0].length);r.writeBytes(e.sps[0]);r.writeByte(e.pps.length);for(i=0;i<e.pps.length;++i){r.writeShort(e.pps[i].length);r.writeBytes(e.pps[i])}return r};c=function(e){var t=[],i;c.prototype.init.call(this);this.push=function(i){h(e,i);if(e&&e.channelcount===undefined){e.audioobjecttype=i.audioobjecttype;e.channelcount=i.channelcount;e.samplerate=i.samplerate;e.samplingfrequencyindex=i.samplingfrequencyindex;e.samplesize=i.samplesize;e.extraData=e.audioobjecttype<<11|e.samplingfrequencyindex<<7|e.channelcount<<3}i.pts=Math.round(i.pts/90);i.dts=Math.round(i.dts/90);t.push(i)};this.flush=function(){var r,a,s,o=new f;if(t.length===0){this.trigger("done","AudioSegmentStream");return}s=-Infinity;while(t.length){r=t.shift();if(e.extraData!==i||r.pts-s>=1e3){a=new n(n.METADATA_TAG);a.pts=r.pts;a.dts=r.dts;a.writeMetaDataDouble("audiocodecid",10);a.writeMetaDataBoolean("stereo",e.channelcount===2);a.writeMetaDataDouble("audiosamplerate",e.samplerate);a.writeMetaDataDouble("audiosamplesize",16);o.push(a.finalize());i=e.extraData;a=new n(n.AUDIO_TAG,true);a.pts=r.pts;a.dts=r.dts;a.view.setUint16(a.position,e.extraData);a.position+=2;a.length=Math.max(a.length,a.position);o.push(a.finalize());s=r.pts}a=new n(n.AUDIO_TAG);a.pts=r.pts;a.dts=r.dts;a.writeBytes(r.data);o.push(a.finalize())}i=null;this.trigger("data",{track:e,tags:o.list});this.trigger("done","AudioSegmentStream")}};c.prototype=new r;l=function(e){var t=[],i,r;l.prototype.init.call(this);this.finishFrame=function(t,n){if(!n){return}if(i&&e&&e.newMetadata&&(n.keyFrame||t.length===0)){t.push(p(i,n.dts).finalize());t.push(m(e,n.dts).finalize());e.newMetadata=false}n.endNalUnit();t.push(n.finalize());r=null};this.push=function(i){h(e,i);i.pts=Math.round(i.pts/90);i.dts=Math.round(i.dts/90);t.push(i)};this.flush=function(){var a,s=new f;while(t.length){if(t[0].nalUnitType==="access_unit_delimiter_rbsp"){break}t.shift()}if(t.length===0){this.trigger("done","VideoSegmentStream");return}while(t.length){a=t.shift();if(a.nalUnitType==="seq_parameter_set_rbsp"){e.newMetadata=true;i=a.config;e.width=i.width;e.height=i.height;e.sps=[a.data];e.profileIdc=i.profileIdc;e.levelIdc=i.levelIdc;e.profileCompatibility=i.profileCompatibility;r.endNalUnit()}else if(a.nalUnitType==="pic_parameter_set_rbsp"){e.newMetadata=true;e.pps=[a.data];r.endNalUnit()}else if(a.nalUnitType==="access_unit_delimiter_rbsp"){if(r){this.finishFrame(s,r)}r=new n(n.VIDEO_TAG);r.pts=a.pts;r.dts=a.dts}else{if(a.nalUnitType==="slice_layer_without_partitioning_rbsp_idr"){r.keyFrame=true}r.endNalUnit()}r.startNalUnit();r.writeBytes(a.data)}if(r){this.finishFrame(s,r)}this.trigger("data",{track:e,tags:s.list});this.trigger("done","VideoSegmentStream")}};l.prototype=new r;d=function(e){var t=this,i,r,n,f,h,p,m,v,y,g,b,_;d.prototype.init.call(this);e=e||{};this.metadataStream=new a.MetadataStream;e.metadataStream=this.metadataStream;i=new a.TransportPacketStream;r=new a.TransportParseStream;n=new a.ElementaryStream;f=new a.TimestampRolloverStream("video");h=new a.TimestampRolloverStream("audio");p=new a.TimestampRolloverStream("timed-metadata");m=new s;v=new o;_=new u(e);i.pipe(r).pipe(n);n.pipe(f).pipe(v);n.pipe(h).pipe(m);n.pipe(p).pipe(this.metadataStream).pipe(_);b=new a.CaptionStream;v.pipe(b).pipe(_);n.on("data",function(e){var t,i,r;if(e.type==="metadata"){t=e.tracks.length;while(t--){if(e.tracks[t].type==="video"){i=e.tracks[t]}else if(e.tracks[t].type==="audio"){r=e.tracks[t]}}if(i&&!y){_.numberOfTracks++;y=new l(i);v.pipe(y).pipe(_)}if(r&&!g){_.numberOfTracks++;g=new c(r);m.pipe(g).pipe(_)}}});this.push=function(e){i.push(e)};this.flush=function(){i.flush()};_.on("data",function(e){t.trigger("data",e)});_.on("done",function(){t.trigger("done")})};d.prototype=new r;t.exports=d},{"../codecs/adts.js":56,"../codecs/h264":57,"../m2ts/m2ts.js":66,"../utils/stream.js":75,"./coalesce-stream.js":59,"./flv-tag.js":61,"./tag-list.js":63}],65:[function(e,t,i){"use strict";var r=4,n=128,a=e("../utils/stream");var s=function(e){var t=0,i={payloadType:-1,payloadSize:0},a=0,s=0;while(t<e.byteLength){if(e[t]===n){break}while(e[t]===255){a+=255;t++}a+=e[t++];while(e[t]===255){s+=255;t++}s+=e[t++];if(!i.payload&&a===r){i.payloadType=a;i.payloadSize=s;i.payload=e.subarray(t,t+s);break}t+=s;a=0;s=0}return i};var o=function(e){if(e.payload[0]!==181){return null}if((e.payload[1]<<8|e.payload[2])!==49){return null}if(String.fromCharCode(e.payload[3],e.payload[4],e.payload[5],e.payload[6])!=="GA94"){return null}if(e.payload[7]!==3){return null}return e.payload.subarray(8,e.payload.length-1)};var u=function(e,t){var i=[],r,n,a,s;if(!(t[0]&64)){return i}n=t[0]&31;for(r=0;r<n;r++){a=r*3;s={type:t[a+2]&3,pts:e};if(t[a+2]&4){s.ccData=t[a+3]<<8|t[a+4];i.push(s)}}return i};var f=function(){f.prototype.init.call(this);this.captionPackets_=[];this.field1_=new k;this.field1_.on("data",this.trigger.bind(this,"data"));this.field1_.on("done",this.trigger.bind(this,"done"))};f.prototype=new a;f.prototype.push=function(e){var t,i;if(e.nalUnitType!=="sei_rbsp"){return}t=s(e.escapedRBSP);if(t.payloadType!==r){return}i=o(t);if(!i){return}this.captionPackets_=this.captionPackets_.concat(u(e.pts,i))};f.prototype.flush=function(){if(!this.captionPackets_.length){this.field1_.flush();return}this.captionPackets_.forEach(function(e,t){e.presortIndex=t});this.captionPackets_.sort(function(e,t){if(e.pts===t.pts){return e.presortIndex-t.presortIndex}return e.pts-t.pts});this.captionPackets_.forEach(this.field1_.push,this.field1_);this.captionPackets_.length=0;this.field1_.flush();return};var d={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608};var l=function(e){if(e===null){return""}e=d[e]||e;return String.fromCharCode(e)};var c=0,h=5152,p=5167,m=5157,v=5158,y=5159,g=5165,b=5153,_=5164,T=5166;var w=14;var S=function(){var e=[],t=w+1;while(t--){e.push("")}return e};var k=function(){k.prototype.init.call(this);this.mode_="popOn";this.topRow_=0;this.startPts_=0;this.displayed_=S();this.nonDisplayed_=S();this.lastControlCode_=null;this.push=function(e){if(e.type!==0){return}var t,i,r,n;t=e.ccData&32639;if(t===this.lastControlCode_){this.lastControlCode_=null;return}if((t&61440)===4096){this.lastControlCode_=t}else{this.lastControlCode_=null}switch(t){case c:break;case h:this.mode_="popOn";break;case p:this.flushDisplayed(e.pts);i=this.displayed_;this.displayed_=this.nonDisplayed_;this.nonDisplayed_=i;this.startPts_=e.pts;break;case m:this.topRow_=w-1;this.mode_="rollUp";break;case v:this.topRow_=w-2;this.mode_="rollUp";break;case y:this.topRow_=w-3;this.mode_="rollUp";break;case g:this.flushDisplayed(e.pts);this.shiftRowsUp_();this.startPts_=e.pts;break;case b:if(this.mode_==="popOn"){this.nonDisplayed_[w]=this.nonDisplayed_[w].slice(0,-1)}else{this.displayed_[w]=this.displayed_[w].slice(0,-1)}break;case _:this.flushDisplayed(e.pts);this.displayed_=S();break;case T:this.nonDisplayed_=S();break;default:r=t>>>8;n=t&255;if(r>=16&&r<=23&&n>=64&&n<=127&&(r!==16||n<96)){r=32;n=null}if((r===17||r===25)&&(n>=48&&n<=63)){r=9834;n=""}if((r&240)===16){return}if(r===0){r=null}if(n===0){n=null}this[this.mode_](e.pts,r,n);break}}};k.prototype=new a;k.prototype.flushDisplayed=function(e){var t=this.displayed_.map(function(e){return e.trim()}).filter(function(e){return e.length}).join("\n");if(t.length){this.trigger("data",{startPts:this.startPts_,endPts:e,text:t})}};k.prototype.popOn=function(e,t,i){var r=this.nonDisplayed_[w];r+=l(t);r+=l(i);this.nonDisplayed_[w]=r};k.prototype.rollUp=function(e,t,i){var r=this.displayed_[w];if(r===""){this.flushDisplayed(e);this.startPts_=e}r+=l(t);r+=l(i);this.displayed_[w]=r};k.prototype.shiftRowsUp_=function(){var e;for(e=0;e<this.topRow_;e++){this.displayed_[e]=""}for(e=this.topRow_;e<w;e++){this.displayed_[e]=this.displayed_[e+1]}this.displayed_[w]=""};t.exports={CaptionStream:f,Cea608Stream:k}},{"../utils/stream":75}],66:[function(e,t,i){"use strict";var r=e("../utils/stream.js"),n=e("./caption-stream"),a=e("./stream-types"),s=e("./timestamp-rollover-stream").TimestampRolloverStream;var o=e("./stream-types.js");var u,f,d;var l=188,c=71;u=function(){var e=new Uint8Array(l),t=0;u.prototype.init.call(this);this.push=function(i){var r=0,n=l,a;if(t){a=new Uint8Array(i.byteLength+t);a.set(e.subarray(0,t));a.set(i,t);t=0}else{a=i}while(n<a.byteLength){if(a[r]===c&&a[n]===c){this.trigger("data",a.subarray(r,n));r+=l;n+=l;continue}r++;n++}if(r<a.byteLength){
e.set(a.subarray(r),0);t=a.byteLength-r}};this.flush=function(){if(t===l&&e[0]===c){this.trigger("data",e);t=0}this.trigger("done")}};u.prototype=new r;f=function(){var e,t,i,r;f.prototype.init.call(this);r=this;this.packetsWaitingForPmt=[];this.programMapTable=undefined;e=function(e,r){var n=0;if(r.payloadUnitStartIndicator){n+=e[n]+1}if(r.type==="pat"){t(e.subarray(n),r)}else{i(e.subarray(n),r)}};t=function(e,t){t.section_number=e[7];t.last_section_number=e[8];r.pmtPid=(e[10]&31)<<8|e[11];t.pmtPid=r.pmtPid};i=function(e,t){var i,n,a,s;if(!(e[5]&1)){return}r.programMapTable={};i=(e[1]&15)<<8|e[2];n=3+i-4;a=(e[10]&15)<<8|e[11];s=12+a;while(s<n){r.programMapTable[(e[s+1]&31)<<8|e[s+2]]=e[s];s+=((e[s+3]&15)<<8|e[s+4])+5}t.programMapTable=r.programMapTable;while(r.packetsWaitingForPmt.length){r.processPes_.apply(r,r.packetsWaitingForPmt.shift())}};this.push=function(t){var i={},r=4;i.payloadUnitStartIndicator=!!(t[1]&64);i.pid=t[1]&31;i.pid<<=8;i.pid|=t[2];if((t[3]&48)>>>4>1){r+=t[r]+1}if(i.pid===0){i.type="pat";e(t.subarray(r),i);this.trigger("data",i)}else if(i.pid===this.pmtPid){i.type="pmt";e(t.subarray(r),i);this.trigger("data",i)}else if(this.programMapTable===undefined){this.packetsWaitingForPmt.push([t,r,i])}else{this.processPes_(t,r,i)}};this.processPes_=function(e,t,i){i.streamType=this.programMapTable[i.pid];i.type="pes";i.data=e.subarray(t);this.trigger("data",i)}};f.prototype=new r;f.STREAM_TYPES={h264:27,adts:15};d=function(){var e=this,t={data:[],size:0},i={data:[],size:0},r={data:[],size:0},n=function(e,t){var i;t.dataAlignmentIndicator=(e[6]&4)!==0;i=e[7];if(i&192){t.pts=(e[9]&14)<<27|(e[10]&255)<<20|(e[11]&254)<<12|(e[12]&255)<<5|(e[13]&254)>>>3;t.pts*=4;t.pts+=(e[13]&6)>>>1;t.dts=t.pts;if(i&64){t.dts=(e[14]&14)<<27|(e[15]&255)<<20|(e[16]&254)<<12|(e[17]&255)<<5|(e[18]&254)>>>3;t.dts*=4;t.dts+=(e[18]&6)>>>1}}t.data=e.subarray(9+e[8])},s=function(t,i){var r=new Uint8Array(t.size),a={type:i},s=0,o;if(!t.data.length){return}a.trackId=t.data[0].pid;while(t.data.length){o=t.data.shift();r.set(o.data,s);s+=o.data.byteLength}n(r,a);t.size=0;e.trigger("data",a)};d.prototype.init.call(this);this.push=function(n){({pat:function(){},pes:function(){var e,u;switch(n.streamType){case a.H264_STREAM_TYPE:case o.H264_STREAM_TYPE:e=t;u="video";break;case a.ADTS_STREAM_TYPE:e=i;u="audio";break;case a.METADATA_STREAM_TYPE:e=r;u="timed-metadata";break;default:return}if(n.payloadUnitStartIndicator){s(e,u)}e.data.push(n);e.size+=n.data.byteLength},pmt:function(){var t={type:"metadata",tracks:[]},i=n.programMapTable,r,a;for(r in i){if(i.hasOwnProperty(r)){a={timelineStartInfo:{baseMediaDecodeTime:0}};a.id=+r;if(i[r]===o.H264_STREAM_TYPE){a.codec="avc";a.type="video"}else if(i[r]===o.ADTS_STREAM_TYPE){a.codec="adts";a.type="audio"}t.tracks.push(a)}}e.trigger("data",t)}})[n.type]()};this.flush=function(){s(t,"video");s(i,"audio");s(r,"timed-metadata");this.trigger("done")}};d.prototype=new r;var h={PAT_PID:0,MP2T_PACKET_LENGTH:l,TransportPacketStream:u,TransportParseStream:f,ElementaryStream:d,TimestampRolloverStream:s,CaptionStream:n.CaptionStream,Cea608Stream:n.Cea608Stream,MetadataStream:e("./metadata-stream")};for(var p in a){if(a.hasOwnProperty(p)){h[p]=a[p]}}t.exports=h},{"../utils/stream.js":75,"./caption-stream":65,"./metadata-stream":67,"./stream-types":68,"./stream-types.js":68,"./timestamp-rollover-stream":69}],67:[function(e,t,i){"use strict";var r=e("../utils/stream"),n=e("./stream-types"),a=function(e,t,i){var r,n="";for(r=t;r<i;r++){n+="%"+("00"+e[r].toString(16)).slice(-2)}return n},s=function(e,t,i){return decodeURIComponent(a(e,t,i))},o=function(e,t,i){return unescape(a(e,t,i))},u=function(e){return e[0]<<21|e[1]<<14|e[2]<<7|e[3]},f={TXXX:function(e){var t;if(e.data[0]!==3){return}for(t=1;t<e.data.length;t++){if(e.data[t]===0){e.description=s(e.data,1,t);e.value=s(e.data,t+1,e.data.length-1);break}}e.data=e.value},WXXX:function(e){var t;if(e.data[0]!==3){return}for(t=1;t<e.data.length;t++){if(e.data[t]===0){e.description=s(e.data,1,t);e.url=s(e.data,t+1,e.data.length);break}}},PRIV:function(e){var t;for(t=0;t<e.data.length;t++){if(e.data[t]===0){e.owner=o(e.data,0,t);break}}e.privateData=e.data.subarray(t+1);e.data=e.privateData}},d;d=function(e){var t={debug:!!(e&&e.debug),descriptor:e&&e.descriptor},i=0,r=[],a=0,s;d.prototype.init.call(this);this.dispatchType=n.METADATA_STREAM_TYPE.toString(16);if(t.descriptor){for(s=0;s<t.descriptor.length;s++){this.dispatchType+=("00"+t.descriptor[s].toString(16)).slice(-2)}}this.push=function(e){var n,s,o,d,l,c;if(e.type!=="timed-metadata"){return}if(e.dataAlignmentIndicator){a=0;r.length=0}if(r.length===0&&(e.data.length<10||e.data[0]!=="I".charCodeAt(0)||e.data[1]!=="D".charCodeAt(0)||e.data[2]!=="3".charCodeAt(0))){if(t.debug){console.log("Skipping unrecognized metadata packet")}return}r.push(e);a+=e.data.byteLength;if(r.length===1){i=u(e.data.subarray(6,10));i+=10}if(a<i){return}n={data:new Uint8Array(i),frames:[],pts:r[0].pts,dts:r[0].dts};for(l=0;l<i;){n.data.set(r[0].data.subarray(0,i-l),l);l+=r[0].data.byteLength;a-=r[0].data.byteLength;r.shift()}s=10;if(n.data[5]&64){s+=4;s+=u(n.data.subarray(10,14));i-=u(n.data.subarray(16,20))}do{o=u(n.data.subarray(s+4,s+8));if(o<1){return console.log("Malformed ID3 frame encountered. Skipping metadata parsing.")}c=String.fromCharCode(n.data[s],n.data[s+1],n.data[s+2],n.data[s+3]);d={id:c,data:n.data.subarray(s+10,s+o+10)};d.key=d.id;if(f[d.id]){f[d.id](d);if(d.owner==="com.apple.streaming.transportStreamTimestamp"){var h=d.data,p=(h[3]&1)<<30|h[4]<<22|h[5]<<14|h[6]<<6|h[7]>>>2;p*=4;p+=h[7]&3;d.timeStamp=p;if(n.pts===undefined&&n.dts===undefined){n.pts=d.timeStamp;n.dts=d.timeStamp}this.trigger("timestamp",d)}}n.frames.push(d);s+=10;s+=o}while(s<i);this.trigger("data",n)}};d.prototype=new r;t.exports=d},{"../utils/stream":75,"./stream-types":68}],68:[function(e,t,i){arguments[4][36][0].apply(i,arguments)},{dup:36}],69:[function(e,t,i){arguments[4][37][0].apply(i,arguments)},{"../utils/stream":75,dup:37}],70:[function(e,t,i){t.exports={generator:e("./mp4-generator"),Transmuxer:e("./transmuxer").Transmuxer,AudioSegmentStream:e("./transmuxer").AudioSegmentStream,VideoSegmentStream:e("./transmuxer").VideoSegmentStream}},{"./mp4-generator":71,"./transmuxer":72}],71:[function(e,t,i){"use strict";var r=Math.pow(2,32)-1;var n,a,s,o,u,f,d,l,c,h,p,m,v,y,g,b,_,T,w,S,k,O,P,A,E,x,L,I,C,U,D,M,j,B,R,N;(function(){var e;P={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],smhd:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],styp:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[]};if(typeof Uint8Array==="undefined"){return}for(e in P){if(P.hasOwnProperty(e)){P[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]}}A=new Uint8Array(["i".charCodeAt(0),"s".charCodeAt(0),"o".charCodeAt(0),"m".charCodeAt(0)]);x=new Uint8Array(["a".charCodeAt(0),"v".charCodeAt(0),"c".charCodeAt(0),"1".charCodeAt(0)]);E=new Uint8Array([0,0,0,1]);L=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]);I=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);C={video:L,audio:I};M=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]);D=new Uint8Array([0,0,0,0,0,0,0,0]);j=new Uint8Array([0,0,0,0,0,0,0,0]);B=j;R=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]);N=j;U=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])})();n=function(e){var t=[],i=0,r,n,a;for(r=1;r<arguments.length;r++){t.push(arguments[r])}r=t.length;while(r--){i+=t[r].byteLength}n=new Uint8Array(i+8);a=new DataView(n.buffer,n.byteOffset,n.byteLength);a.setUint32(0,n.byteLength);n.set(e,4);for(r=0,i=8;r<t.length;r++){n.set(t[r],i);i+=t[r].byteLength}return n};a=function(){return n(P.dinf,n(P.dref,M))};s=function(e){return n(P.esds,new Uint8Array([0,0,0,0,3,25,0,0,0,4,17,64,21,0,6,0,0,0,218,192,0,0,218,192,5,2,e.audioobjecttype<<3|e.samplingfrequencyindex>>>1,e.samplingfrequencyindex<<7|e.channelcount<<3,6,1,2]))};o=function(){return n(P.ftyp,A,E,A,x)};b=function(e){return n(P.hdlr,C[e])};u=function(e){return n(P.mdat,e)};g=function(e){var t=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,e.duration>>>24&255,e.duration>>>16&255,e.duration>>>8&255,e.duration&255,85,196,0,0]);if(e.samplerate){t[12]=e.samplerate>>>24&255;t[13]=e.samplerate>>>16&255;t[14]=e.samplerate>>>8&255;t[15]=e.samplerate&255}return n(P.mdhd,t)};y=function(e){return n(P.mdia,g(e),b(e.type),d(e))};f=function(e){return n(P.mfhd,new Uint8Array([0,0,0,0,(e&4278190080)>>24,(e&16711680)>>16,(e&65280)>>8,e&255]))};d=function(e){return n(P.minf,e.type==="video"?n(P.vmhd,U):n(P.smhd,D),a(),T(e))};l=function(e,t){var i=[],r=t.length;while(r--){i[r]=S(t[r])}return n.apply(null,[P.moof,f(e)].concat(i))};c=function(e){var t=e.length,i=[];while(t--){i[t]=m(e[t])}return n.apply(null,[P.moov,p(4294967295)].concat(i).concat(h(e)))};h=function(e){var t=e.length,i=[];while(t--){i[t]=k(e[t])}return n.apply(null,[P.mvex].concat(i))};p=function(e){var t=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(e&4278190080)>>24,(e&16711680)>>16,(e&65280)>>8,e&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return n(P.mvhd,t)};_=function(e){var t=e.samples||[],i=new Uint8Array(4+t.length),r,a;for(a=0;a<t.length;a++){r=t[a].flags;i[a+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy}return n(P.sdtp,i)};T=function(e){return n(P.stbl,w(e),n(P.stts,N),n(P.stsc,B),n(P.stsz,R),n(P.stco,j))};(function(){var e,t;w=function(i){return n(P.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),i.type==="video"?e(i):t(i))};e=function(e){var t=e.sps||[],i=e.pps||[],r=[],a=[],s;for(s=0;s<t.length;s++){r.push((t[s].byteLength&65280)>>>8);r.push(t[s].byteLength&255);r=r.concat(Array.prototype.slice.call(t[s]))}for(s=0;s<i.length;s++){a.push((i[s].byteLength&65280)>>>8);a.push(i[s].byteLength&255);a=a.concat(Array.prototype.slice.call(i[s]))}return n(P.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(e.width&65280)>>8,e.width&255,(e.height&65280)>>8,e.height&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),n(P.avcC,new Uint8Array([1,e.profileIdc,e.profileCompatibility,e.levelIdc,255].concat([t.length]).concat(r).concat([i.length]).concat(a))),n(P.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])))};t=function(e){return n(P.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(e.channelcount&65280)>>8,e.channelcount&255,(e.samplesize&65280)>>8,e.samplesize&255,0,0,0,0,(e.samplerate&65280)>>8,e.samplerate&255,0,0]),s(e))}})();v=function(e){var t=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,(e.id&4278190080)>>24,(e.id&16711680)>>16,(e.id&65280)>>8,e.id&255,0,0,0,0,(e.duration&4278190080)>>24,(e.duration&16711680)>>16,(e.duration&65280)>>8,e.duration&255,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(e.width&65280)>>8,e.width&255,0,0,(e.height&65280)>>8,e.height&255,0,0]);return n(P.tkhd,t)};S=function(e){var t,i,a,s,o,u,f;t=n(P.tfhd,new Uint8Array([0,0,0,58,(e.id&4278190080)>>24,(e.id&16711680)>>16,(e.id&65280)>>8,e.id&255,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0]));u=Math.floor(e.baseMediaDecodeTime/(r+1));f=Math.floor(e.baseMediaDecodeTime%(r+1));i=n(P.tfdt,new Uint8Array([1,0,0,0,u>>>24&255,u>>>16&255,u>>>8&255,u&255,f>>>24&255,f>>>16&255,f>>>8&255,f&255]));o=32+20+8+16+8+8;if(e.type==="audio"){a=O(e,o);return n(P.traf,t,i,a)}s=_(e);a=O(e,s.length+o);return n(P.traf,t,i,a,s)};m=function(e){e.duration=e.duration||4294967295;return n(P.trak,v(e),y(e))};k=function(e){var t=new Uint8Array([0,0,0,0,(e.id&4278190080)>>24,(e.id&16711680)>>16,(e.id&65280)>>8,e.id&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);if(e.type!=="video"){t[t.length-1]=0}return n(P.trex,t)};(function(){var e,t,i;i=function(e,t){var i=0,r=0,n=0,a=0;if(e.length){if(e[0].duration!==undefined){i=1}if(e[0].size!==undefined){r=2}if(e[0].flags!==undefined){n=4}if(e[0].compositionTimeOffset!==undefined){a=8}}return[0,0,i|r|n|a,1,(e.length&4278190080)>>>24,(e.length&16711680)>>>16,(e.length&65280)>>>8,e.length&255,(t&4278190080)>>>24,(t&16711680)>>>16,(t&65280)>>>8,t&255]};t=function(e,t){var r,a,s,o;a=e.samples||[];t+=8+12+16*a.length;r=i(a,t);for(o=0;o<a.length;o++){s=a[o];r=r.concat([(s.duration&4278190080)>>>24,(s.duration&16711680)>>>16,(s.duration&65280)>>>8,s.duration&255,(s.size&4278190080)>>>24,(s.size&16711680)>>>16,(s.size&65280)>>>8,s.size&255,s.flags.isLeading<<2|s.flags.dependsOn,s.flags.isDependedOn<<6|s.flags.hasRedundancy<<4|s.flags.paddingValue<<1|s.flags.isNonSyncSample,s.flags.degradationPriority&240<<8,s.flags.degradationPriority&15,(s.compositionTimeOffset&4278190080)>>>24,(s.compositionTimeOffset&16711680)>>>16,(s.compositionTimeOffset&65280)>>>8,s.compositionTimeOffset&255])}return n(P.trun,new Uint8Array(r))};e=function(e,t){var r,a,s,o;a=e.samples||[];t+=8+12+8*a.length;r=i(a,t);for(o=0;o<a.length;o++){s=a[o];r=r.concat([(s.duration&4278190080)>>>24,(s.duration&16711680)>>>16,(s.duration&65280)>>>8,s.duration&255,(s.size&4278190080)>>>24,(s.size&16711680)>>>16,(s.size&65280)>>>8,s.size&255])}return n(P.trun,new Uint8Array(r))};O=function(i,r){if(i.type==="audio"){return e(i,r)}return t(i,r)}})();t.exports={ftyp:o,mdat:u,moof:l,moov:c,initSegment:function(e){var t=o(),i=c(e),r;r=new Uint8Array(t.byteLength+i.byteLength);r.set(t);r.set(i,t.byteLength);return r}}},{}],72:[function(e,t,i){"use strict";var r=e("../utils/stream.js");var n=e("./mp4-generator.js");var a=e("../m2ts/m2ts.js");var s=e("../codecs/adts.js");var o=e("../codecs/h264").H264Stream;var u=e("../aac");var f=e("../data/silence");var d=e("../utils/clock");var l=["audioobjecttype","channelcount","samplerate","samplingfrequencyindex","samplesize"];var c=["width","height","profileIdc","levelIdc","profileCompatibility"];var h=9e4;var p,m,v,y;var g,b,_,T,w,S,k;g=function(){return{size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0}}};b=function(e){if(e[0]==="I".charCodeAt(0)&&e[1]==="D".charCodeAt(0)&&e[2]==="3".charCodeAt(0)){return true}return false};S=function(e,t){var i;if(e.length!==t.length){return false}for(i=0;i<e.length;i++){if(e[i]!==t[i]){return false}}return true};k=function(e){var t,i,r=0;for(t=0;t<e.length;t++){i=e[t];r+=i.data.byteLength}return r};m=function(e){var t=[],i=0,r=0,a=0,s=Infinity;m.prototype.init.call(this);this.push=function(i){_(e,i);if(e){l.forEach(function(t){e[t]=i[t]})}t.push(i)};this.setEarliestDts=function(t){r=t-e.timelineStartInfo.baseMediaDecodeTime};this.setVideoBaseMediaDecodeTime=function(e){s=e};this.setAudioAppendStart=function(e){a=e};this.flush=function(){var r,a,s,o;if(t.length===0){this.trigger("done","AudioSegmentStream");return}r=this.trimAdtsFramesByEarliestDts_(t);e.baseMediaDecodeTime=w(e);this.prefixWithSilence_(e,r);e.samples=this.generateSampleTable_(r);s=n.mdat(this.concatenateFrameData_(r));t=[];a=n.moof(i,[e]);o=new Uint8Array(a.byteLength+s.byteLength);i++;o.set(a);o.set(s,a.byteLength);T(e);this.trigger("data",{track:e,boxes:o});this.trigger("done","AudioSegmentStream")};this.prefixWithSilence_=function(e,t){var i,r=0,n=0,o=0,u=0,l,c;if(!t.length){return}i=d.audioTsToVideoTs(e.baseMediaDecodeTime,e.samplerate);if(a&&s&&a<i){n=i-s;r=Math.ceil(h/(e.samplerate/1024));o=Math.floor(n/r);u=o*r}if(o<1||u>h/2){return}l=f[e.samplerate];if(!l){l=t[0].data}for(c=0;c<o;c++){t.splice(c,0,{data:l})}e.baseMediaDecodeTime-=Math.floor(d.videoTsToAudioTs(u,e.samplerate))};this.trimAdtsFramesByEarliestDts_=function(t){if(e.minSegmentDts>=r){return t}e.minSegmentDts=Infinity;return t.filter(function(t){if(t.dts>=r){e.minSegmentDts=Math.min(e.minSegmentDts,t.dts);e.minSegmentPts=e.minSegmentDts;return true}return false})};this.generateSampleTable_=function(e){var t,i,r=[];for(t=0;t<e.length;t++){i=e[t];r.push({size:i.data.byteLength,duration:1024})}return r};this.concatenateFrameData_=function(e){var t,i,r=0,n=new Uint8Array(k(e));for(t=0;t<e.length;t++){i=e[t];n.set(i.data,r);r+=i.data.byteLength}return n}};m.prototype=new r;p=function(e){var t=0,i=[],r,a;p.prototype.init.call(this);delete e.minPTS;this.gopCache_=[];this.push=function(t){_(e,t);if(t.nalUnitType==="seq_parameter_set_rbsp"&&!r){r=t.config;e.sps=[t.data];c.forEach(function(t){e[t]=r[t]},this)}if(t.nalUnitType==="pic_parameter_set_rbsp"&&!a){a=t.data;e.pps=[t.data]}i.push(t)};this.flush=function(){var r,a,s,o,u,f;while(i.length){if(i[0].nalUnitType==="access_unit_delimiter_rbsp"){break}i.shift()}if(i.length===0){this.resetStream_();this.trigger("done","VideoSegmentStream");return}r=this.groupNalsIntoFrames_(i);s=this.groupFramesIntoGops_(r);if(!s[0][0].keyFrame){a=this.getGopForFusion_(i[0],e);if(a){s.unshift(a);s.byteLength+=a.byteLength;s.nalCount+=a.nalCount;s.pts=a.pts;s.dts=a.dts;s.duration+=a.duration}else{s=this.extendFirstKeyFrame_(s)}}_(e,s);e.samples=this.generateSampleTable_(s);u=n.mdat(this.concatenateNalData_(s));this.gopCache_.unshift({gop:s.pop(),pps:e.pps,sps:e.sps});this.gopCache_.length=Math.min(6,this.gopCache_.length);i=[];e.baseMediaDecodeTime=w(e);this.trigger("baseMediaDecodeTime",e.baseMediaDecodeTime);this.trigger("timelineStartInfo",e.timelineStartInfo);o=n.moof(t,[e]);f=new Uint8Array(o.byteLength+u.byteLength);t++;f.set(o);f.set(u,o.byteLength);this.trigger("data",{track:e,boxes:f});this.resetStream_();this.trigger("done","VideoSegmentStream")};this.resetStream_=function(){T(e);r=undefined;a=undefined};this.getGopForFusion_=function(t){var i=45e3,r=1e4,n=Infinity,a,s,o,u,f;for(f=0;f<this.gopCache_.length;f++){u=this.gopCache_[f];o=u.gop;if(!(e.pps&&S(e.pps[0],u.pps[0]))||!(e.sps&&S(e.sps[0],u.sps[0]))){continue}if(o.dts<e.timelineStartInfo.dts){continue}a=t.dts-o.dts-o.duration;if(a>=-r&&a<=i){if(!s||n>a){s=u;n=a}}}if(s){return s.gop}return null};this.extendFirstKeyFrame_=function(e){var t;if(!e[0][0].keyFrame){t=e.shift();e.byteLength-=t.byteLength;e.nalCount-=t.nalCount;e[0][0].dts=t.dts;e[0][0].pts=t.pts;e[0][0].duration+=t.duration}return e};this.groupNalsIntoFrames_=function(e){var t,i,r=[],n=[];r.byteLength=0;for(t=0;t<e.length;t++){i=e[t];if(i.nalUnitType==="access_unit_delimiter_rbsp"){if(r.length){r.duration=i.dts-r.dts;n.push(r)}r=[i];r.byteLength=i.data.byteLength;r.pts=i.pts;r.dts=i.dts}else{if(i.nalUnitType==="slice_layer_without_partitioning_rbsp_idr"){r.keyFrame=true}r.duration=i.dts-r.dts;r.byteLength+=i.data.byteLength;r.push(i)}}if(n.length&&(!r.duration||r.duration<=0)){r.duration=n[n.length-1].duration}n.push(r);return n};this.groupFramesIntoGops_=function(e){var t,i,r=[],n=[];r.byteLength=0;r.nalCount=0;r.duration=0;r.pts=e[0].pts;r.dts=e[0].dts;n.byteLength=0;n.nalCount=0;n.duration=0;n.pts=e[0].pts;n.dts=e[0].dts;for(t=0;t<e.length;t++){i=e[t];if(i.keyFrame){if(r.length){n.push(r);n.byteLength+=r.byteLength;n.nalCount+=r.nalCount;n.duration+=r.duration}r=[i];r.nalCount=i.length;r.byteLength=i.byteLength;r.pts=i.pts;r.dts=i.dts;r.duration=i.duration}else{r.duration+=i.duration;r.nalCount+=i.length;r.byteLength+=i.byteLength;r.push(i)}}if(n.length&&r.duration<=0){r.duration=n[n.length-1].duration}n.byteLength+=r.byteLength;n.nalCount+=r.nalCount;n.duration+=r.duration;n.push(r);return n};this.generateSampleTable_=function(e,t){var i,r,n,a,s,o=t||0,u=[];for(i=0;i<e.length;i++){a=e[i];for(r=0;r<a.length;r++){s=a[r];n=g();n.dataOffset=o;n.compositionTimeOffset=s.pts-s.dts;n.duration=s.duration;n.size=4*s.length;n.size+=s.byteLength;if(s.keyFrame){n.flags.dependsOn=2}o+=n.size;u.push(n)}}return u};this.concatenateNalData_=function(e){var t,i,r,n,a,s,o=0,u=e.byteLength,f=e.nalCount,d=u+4*f,l=new Uint8Array(d),c=new DataView(l.buffer);for(t=0;t<e.length;t++){n=e[t];for(i=0;i<n.length;i++){a=n[i];for(r=0;r<a.length;r++){s=a[r];c.setUint32(o,s.data.byteLength);o+=4;l.set(s.data,o);o+=s.data.byteLength}}}return l}};p.prototype=new r;_=function(e,t){if(typeof t.pts==="number"){if(e.timelineStartInfo.pts===undefined){e.timelineStartInfo.pts=t.pts}if(e.minSegmentPts===undefined){e.minSegmentPts=t.pts}else{e.minSegmentPts=Math.min(e.minSegmentPts,t.pts)}if(e.maxSegmentPts===undefined){e.maxSegmentPts=t.pts}else{e.maxSegmentPts=Math.max(e.maxSegmentPts,t.pts)}}if(typeof t.dts==="number"){if(e.timelineStartInfo.dts===undefined){e.timelineStartInfo.dts=t.dts}if(e.minSegmentDts===undefined){e.minSegmentDts=t.dts}else{e.minSegmentDts=Math.min(e.minSegmentDts,t.dts)}if(e.maxSegmentDts===undefined){e.maxSegmentDts=t.dts}else{e.maxSegmentDts=Math.max(e.maxSegmentDts,t.dts)}}};T=function(e){delete e.minSegmentDts;delete e.maxSegmentDts;delete e.minSegmentPts;delete e.maxSegmentPts};w=function(e){var t,i,r=e.minSegmentDts-e.timelineStartInfo.dts;t=e.timelineStartInfo.baseMediaDecodeTime;t+=r;t=Math.max(0,t);if(e.type==="audio"){i=e.samplerate/h;t*=i;t=Math.floor(t)}return t};y=function(e,t){this.numberOfTracks=0;this.metadataStream=t;if(typeof e.remux!=="undefined"){this.remuxTracks=!!e.remux}else{this.remuxTracks=true}this.pendingTracks=[];this.videoTrack=null;this.pendingBoxes=[];this.pendingCaptions=[];this.pendingMetadata=[];this.pendingBytes=0;this.emittedTracks=0;y.prototype.init.call(this);this.push=function(e){if(e.text){return this.pendingCaptions.push(e)}if(e.frames){return this.pendingMetadata.push(e)}this.pendingTracks.push(e.track);this.pendingBoxes.push(e.boxes);this.pendingBytes+=e.boxes.byteLength;if(e.track.type==="video"){this.videoTrack=e.track}if(e.track.type==="audio"){this.audioTrack=e.track}}};y.prototype=new r;y.prototype.flush=function(e){var t=0,i={captions:[],metadata:[],info:{}},r,a,s,o=0,u;if(this.pendingTracks.length<this.numberOfTracks){if(e!=="VideoSegmentStream"&&e!=="AudioSegmentStream"){return}else if(this.remuxTracks){return}else if(this.pendingTracks.length===0){this.emittedTracks++;if(this.emittedTracks>=this.numberOfTracks){this.trigger("done");this.emittedTracks=0}return}}if(this.videoTrack){o=this.videoTrack.timelineStartInfo.pts;c.forEach(function(e){i.info[e]=this.videoTrack[e]},this)}else if(this.audioTrack){o=this.audioTrack.timelineStartInfo.pts;l.forEach(function(e){i.info[e]=this.audioTrack[e]},this)}if(this.pendingTracks.length===1){i.type=this.pendingTracks[0].type}else{i.type="combined"}this.emittedTracks+=this.pendingTracks.length;s=n.initSegment(this.pendingTracks);i.initSegment=new Uint8Array(s.byteLength);i.initSegment.set(s);i.data=new Uint8Array(this.pendingBytes);for(u=0;u<this.pendingBoxes.length;u++){i.data.set(this.pendingBoxes[u],t);t+=this.pendingBoxes[u].byteLength}for(u=0;u<this.pendingCaptions.length;u++){r=this.pendingCaptions[u];r.startTime=r.startPts-o;r.startTime/=9e4;r.endTime=r.endPts-o;r.endTime/=9e4;i.captions.push(r)}for(u=0;u<this.pendingMetadata.length;u++){a=this.pendingMetadata[u];a.cueTime=a.pts-o;a.cueTime/=9e4;i.metadata.push(a)}i.metadata.dispatchType=this.metadataStream.dispatchType;this.pendingTracks.length=0;this.videoTrack=null;this.pendingBoxes.length=0;this.pendingCaptions.length=0;this.pendingBytes=0;this.pendingMetadata.length=0;this.trigger("data",i);if(this.emittedTracks>=this.numberOfTracks){this.trigger("done");this.emittedTracks=0}};v=function(e){var t=this,i=true,r,n;v.prototype.init.call(this);e=e||{};this.baseMediaDecodeTime=e.baseMediaDecodeTime||0;this.transmuxPipeline_={};this.setupAacPipeline=function(){var i={};this.transmuxPipeline_=i;i.type="aac";i.metadataStream=new a.MetadataStream;i.aacStream=new u;i.audioTimestampRolloverStream=new a.TimestampRolloverStream("audio");i.timedMetadataTimestampRolloverStream=new a.TimestampRolloverStream("timed-metadata");i.adtsStream=new s;i.coalesceStream=new y(e,i.metadataStream);i.headOfPipeline=i.aacStream;i.aacStream.pipe(i.audioTimestampRolloverStream).pipe(i.adtsStream);i.aacStream.pipe(i.timedMetadataTimestampRolloverStream).pipe(i.metadataStream).pipe(i.coalesceStream);i.metadataStream.on("timestamp",function(e){i.aacStream.setTimestamp(e.timeStamp)});i.aacStream.on("data",function(e){if(e.type==="timed-metadata"&&!i.audioSegmentStream){n=n||{timelineStartInfo:{baseMediaDecodeTime:t.baseMediaDecodeTime},codec:"adts",type:"audio"};i.coalesceStream.numberOfTracks++;i.audioSegmentStream=new m(n);i.adtsStream.pipe(i.audioSegmentStream).pipe(i.coalesceStream)}});i.coalesceStream.on("data",this.trigger.bind(this,"data"));i.coalesceStream.on("done",this.trigger.bind(this,"done"))};this.setupTsPipeline=function(){var i={};this.transmuxPipeline_=i;i.type="ts";i.metadataStream=new a.MetadataStream;i.packetStream=new a.TransportPacketStream;i.parseStream=new a.TransportParseStream;i.elementaryStream=new a.ElementaryStream;i.videoTimestampRolloverStream=new a.TimestampRolloverStream("video");i.audioTimestampRolloverStream=new a.TimestampRolloverStream("audio");i.timedMetadataTimestampRolloverStream=new a.TimestampRolloverStream("timed-metadata");i.adtsStream=new s;i.h264Stream=new o;i.captionStream=new a.CaptionStream;i.coalesceStream=new y(e,i.metadataStream);i.headOfPipeline=i.packetStream;i.packetStream.pipe(i.parseStream).pipe(i.elementaryStream);i.elementaryStream.pipe(i.videoTimestampRolloverStream).pipe(i.h264Stream);i.elementaryStream.pipe(i.audioTimestampRolloverStream).pipe(i.adtsStream);i.elementaryStream.pipe(i.timedMetadataTimestampRolloverStream).pipe(i.metadataStream).pipe(i.coalesceStream);i.h264Stream.pipe(i.captionStream).pipe(i.coalesceStream);i.elementaryStream.on("data",function(e){var a;if(e.type==="metadata"){a=e.tracks.length;while(a--){if(!r&&e.tracks[a].type==="video"){r=e.tracks[a];r.timelineStartInfo.baseMediaDecodeTime=t.baseMediaDecodeTime}else if(!n&&e.tracks[a].type==="audio"){n=e.tracks[a];n.timelineStartInfo.baseMediaDecodeTime=t.baseMediaDecodeTime}}if(r&&!i.videoSegmentStream){i.coalesceStream.numberOfTracks++;i.videoSegmentStream=new p(r);i.videoSegmentStream.on("timelineStartInfo",function(e){if(n){n.timelineStartInfo=e;i.audioSegmentStream.setEarliestDts(e.dts)}});i.videoSegmentStream.on("baseMediaDecodeTime",function(e){if(n){i.audioSegmentStream.setVideoBaseMediaDecodeTime(e)}});i.h264Stream.pipe(i.videoSegmentStream).pipe(i.coalesceStream)}if(n&&!i.audioSegmentStream){i.coalesceStream.numberOfTracks++;i.audioSegmentStream=new m(n);i.adtsStream.pipe(i.audioSegmentStream).pipe(i.coalesceStream)}}});i.coalesceStream.on("data",this.trigger.bind(this,"data"));i.coalesceStream.on("done",this.trigger.bind(this,"done"))};this.setBaseMediaDecodeTime=function(e){var t=this.transmuxPipeline_;this.baseMediaDecodeTime=e;if(n){n.timelineStartInfo.dts=undefined;n.timelineStartInfo.pts=undefined;T(n);n.timelineStartInfo.baseMediaDecodeTime=e}if(r){if(t.videoSegmentStream){t.videoSegmentStream.gopCache_=[]}r.timelineStartInfo.dts=undefined;r.timelineStartInfo.pts=undefined;T(r);r.timelineStartInfo.baseMediaDecodeTime=e}};this.setAudioAppendStart=function(e){if(n){this.transmuxPipeline_.audioSegmentStream.setAudioAppendStart(e)}};this.push=function(e){if(i){var t=b(e);if(t&&this.transmuxPipeline_.type!=="aac"){this.setupAacPipeline()}else if(!t&&this.transmuxPipeline_.type!=="ts"){this.setupTsPipeline()}i=false}this.transmuxPipeline_.headOfPipeline.push(e)};this.flush=function(){i=true;this.transmuxPipeline_.headOfPipeline.flush()}};v.prototype=new r;t.exports={Transmuxer:v,VideoSegmentStream:p,AudioSegmentStream:m,AUDIO_PROPERTIES:l,VIDEO_PROPERTIES:c}},{"../aac":55,"../codecs/adts.js":56,"../codecs/h264":57,"../data/silence":58,"../m2ts/m2ts.js":66,"../utils/clock":73,"../utils/stream.js":75,"./mp4-generator.js":71}],73:[function(e,t,i){var r=9e4,n,a,s,o,u,f;n=function(e){return e*r};a=function(e,t){return e*t};s=function(e){return e/r};o=function(e,t){return e/t};u=function(e,t){return n(o(e,t))};f=function(e,t){return a(s(e),t)};t.exports={secondsToVideoTs:n,secondsToAudioTs:a,videoTsToSeconds:s,audioTsToSeconds:o,audioTsToVideoTs:u,videoTsToAudioTs:f}},{}],74:[function(e,t,i){"use strict";var r;r=function(e){var t=e.byteLength,i=0,r=0;this.length=function(){return 8*t};this.bitsAvailable=function(){return 8*t+r};this.loadWord=function(){var n=e.byteLength-t,a=new Uint8Array(4),s=Math.min(4,t);if(s===0){throw new Error("no bytes available")}a.set(e.subarray(n,n+s));i=new DataView(a.buffer).getUint32(0);r=s*8;t-=s};this.skipBits=function(e){var n;if(r>e){i<<=e;r-=e}else{e-=r;n=Math.floor(e/8);e-=n*8;t-=n;this.loadWord();i<<=e;r-=e}};this.readBits=function(e){var n=Math.min(r,e),a=i>>>32-n;r-=n;if(r>0){i<<=n}else if(t>0){this.loadWord()}n=e-n;if(n>0){return a<<n|this.readBits(n)}return a};this.skipLeadingZeros=function(){var e;for(e=0;e<r;++e){if((i&2147483648>>>e)!==0){i<<=e;r-=e;return e}}this.loadWord();return e+this.skipLeadingZeros()};this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())};this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())};this.readUnsignedExpGolomb=function(){var e=this.skipLeadingZeros();return this.readBits(e+1)-1};this.readExpGolomb=function(){var e=this.readUnsignedExpGolomb();if(1&e){return 1+e>>>1}return-1*(e>>>1)};this.readBoolean=function(){return this.readBits(1)===1};this.readUnsignedByte=function(){return this.readBits(8)};this.loadWord()};t.exports=r},{}],75:[function(e,t,i){arguments[4][40][0].apply(i,arguments)},{dup:40}],76:[function(e,t,i){var r=arguments[3];var n=arguments[4];var a=arguments[5];var s=JSON.stringify;t.exports=function(e){var t=[];var i;var o=Object.keys(a);for(var u=0,f=o.length;u<f;u++){var d=o[u];if(a[d].exports===e){i=d;break}}if(!i){i=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var l={};for(var u=0,f=o.length;u<f;u++){var d=o[u];l[d]=d}n[i]=[Function(["require","module","exports"],"("+e+")(self)"),l]}var c=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var h={};h[i]=i;n[c]=[Function(["require"],"require("+s(i)+")(self)"),h];var p="("+r+")({"+Object.keys(n).map(function(e){return s(e)+":["+n[e][0]+","+s(n[e][1])+"]"}).join(",")+"},{},["+s(c)+"])";var m=window.URL||window.webkitURL||window.mozURL||window.msURL;return new Worker(m.createObjectURL(new Blob([p],{type:"text/javascript"})))}},{}],77:[function(e,t,i){arguments[4][76][0].apply(i,arguments)},{dup:76}],78:[function(e,t,i){(function(i){"use strict";var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(e,r.key,r)}}return function(t,i,r){if(i)e(t.prototype,i);if(r)e(t,r);return t}}();var n=function z(e,t,i){var r=true;e:while(r){var n=e,a=t,s=i;r=false;if(n===null)n=Function.prototype;var o=Object.getOwnPropertyDescriptor(n,a);if(o===undefined){var u=Object.getPrototypeOf(n);if(u===null){return undefined}else{e=u;t=a;i=s;r=true;o=u=undefined;continue e}}else if("value"in o){return o.value}else{var f=o.get;if(f===undefined){return undefined}return f.call(s)}}};function a(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function o(e,t){if(typeof t!=="function"&&t!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof t)}e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:false,writable:true,configurable:true}});if(t)Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t}var u=e("global/document");var f=a(u);var d=e("./playlist-loader");var l=a(d);var c=e("./playlist");var h=a(c);var p=e("./xhr");var m=a(p);var v=e("aes-decrypter");var y=e("./bin-utils");var g=a(y);var b=e("videojs-contrib-media-sources");var _=e("m3u8-parser");var T=a(_);var w=typeof window!=="undefined"?window["videojs"]:typeof i!=="undefined"?i["videojs"]:null;var S=a(w);var k=e("./master-playlist-controller");var O=e("./config");var P=a(O);var A=e("./rendition-mixin");var E=a(A);var x=e("global/window");var L=a(x);var I=e("./playback-watcher");

var C=a(I);var U=e("./reload-source-on-error");var D=a(U);var M={PlaylistLoader:l["default"],Playlist:h["default"],Decrypter:v.Decrypter,AsyncStream:v.AsyncStream,decrypt:v.decrypt,utils:g["default"],xhr:(0,m["default"])()};Object.defineProperty(M,"GOAL_BUFFER_LENGTH",{get:function W(){S["default"].log.warn("using Hls.GOAL_BUFFER_LENGTH is UNSAFE be sure "+"you know what you are doing");return P["default"].GOAL_BUFFER_LENGTH},set:function Y(e){S["default"].log.warn("using Hls.GOAL_BUFFER_LENGTH is UNSAFE be sure "+"you know what you are doing");if(typeof e!=="number"||e<=0){S["default"].log.warn("value passed to Hls.GOAL_BUFFER_LENGTH "+"must be a number and greater than 0");return}P["default"].GOAL_BUFFER_LENGTH=e}});var j=1.2;var B=function $(e,t){var i=undefined;if(!e){return""}i=L["default"].getComputedStyle(e);if(!i){return""}return i[t]};var R=function K(e,t){var i=t.media();var r=-1;for(var n=0;n<e.length;n++){if(e[n].id===i.uri){r=n;break}}e.selectedIndex_=r;e.trigger({selectedIndex:r,type:"change"})};var N=function Q(e,t){t.representations().forEach(function(t){e.addQualityLevel(t)});R(e,t.playlists)};var F=function Z(e,t){var i=e.slice();e.sort(function(e,r){var n=t(e,r);if(n===0){return i.indexOf(e)-i.indexOf(r)}return n})};M.STANDARD_PLAYLIST_SELECTOR=function(){var e=this.playlists.master.playlists.slice();var t=[];var i=undefined;var r=undefined;var n=undefined;var a=undefined;var s=undefined;var o=undefined;var u=undefined;var f=[];var d=[];var l=[];F(e,M.comparePlaylistBandwidth);e=e.filter(h["default"].isEnabled);o=this.systemBandwidth;t=e.filter(function(e){return e.attributes&&e.attributes.BANDWIDTH&&e.attributes.BANDWIDTH*j<o});i=t.filter(function(e){return e.attributes.BANDWIDTH===t[t.length-1].attributes.BANDWIDTH})[0];F(t,M.comparePlaylistResolution);a=parseInt(B(this.tech_.el(),"width"),10);s=parseInt(B(this.tech_.el(),"height"),10);u=t.filter(function(e){return e.attributes&&e.attributes.RESOLUTION&&e.attributes.RESOLUTION.width&&e.attributes.RESOLUTION.height});l=u.filter(function(e){return e.attributes.RESOLUTION.width===a&&e.attributes.RESOLUTION.height===s});n=l.filter(function(e){return e.attributes.BANDWIDTH===l[l.length-1].attributes.BANDWIDTH})[0];if(!n){f=u.filter(function(e){return e.attributes.RESOLUTION.width>a||e.attributes.RESOLUTION.height>s});d=f.filter(function(e){return e.attributes.RESOLUTION.width===f[0].attributes.RESOLUTION.width&&e.attributes.RESOLUTION.height===f[0].attributes.RESOLUTION.height});r=d.filter(function(e){return e.attributes.BANDWIDTH===d[d.length-1].attributes.BANDWIDTH})[0]}return r||n||i||e[0]};M.canPlaySource=function(){return S["default"].log.warn("HLS is no longer a tech. Please remove it from "+"your player's techOrder.")};M.supportsNativeHls=function(){var e=f["default"].createElement("video");if(!S["default"].getTech("Html5").isSupported()){return false}var t=["application/vnd.apple.mpegurl","audio/mpegurl","audio/x-mpegurl","application/x-mpegurl","video/x-mpegurl","video/mpegurl","application/mpegurl"];return t.some(function(t){return/maybe|probably/i.test(e.canPlayType(t))})}();M.isSupported=function(){return S["default"].log.warn("HLS is no longer a tech. Please remove it from "+"your player's techOrder.")};var G=L["default"].navigator&&L["default"].navigator.userAgent||"";M.supportsAudioInfoChange_=function(){if(S["default"].browser.IS_FIREFOX){var e=/Firefox\/([\d.]+)/i.exec(G);var t=parseInt(e[1],10);return t>=49}return true};var q=S["default"].getComponent("Component");var H=function(e){o(t,e);function t(e,i,r){var a=this;s(this,t);n(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,i);if(i.options_&&i.options_.playerId){var o=(0,S["default"])(i.options_.playerId);if(!o.hasOwnProperty("hls")){Object.defineProperty(o,"hls",{get:function u(){S["default"].log.warn("player.hls is deprecated. Use player.tech_.hls instead.");return a}})}}if(S["default"].options.hls.overrideNative&&(i.featuresNativeVideoTracks||i.featuresNativeAudioTracks)){throw new Error("Overriding native HLS requires emulated tracks. "+"See https://git.io/vMpjB")}this.tech_=i;this.source_=e;this.stats={};this.ignoreNextSeekingEvent_=false;this.options_=S["default"].mergeOptions(S["default"].options.hls||{},r.hls);this.setOptions_();this.on(f["default"],["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],function(e){var t=f["default"].fullscreenElement||f["default"].webkitFullscreenElement||f["default"].mozFullScreenElement||f["default"].msFullscreenElement;if(t&&t.contains(a.tech_.el())){a.masterPlaylistController_.fastQualityChange_()}});this.on(this.tech_,"seeking",function(){if(this.ignoreNextSeekingEvent_){this.ignoreNextSeekingEvent_=false;return}this.setCurrentTime(this.tech_.currentTime())});this.on(this.tech_,"error",function(){if(this.masterPlaylistController_){this.masterPlaylistController_.pauseLoading()}});this.audioTrackChange_=function(){a.masterPlaylistController_.setupAudio()};this.on(this.tech_,"play",this.play)}r(t,[{key:"setOptions_",value:function i(){var e=this;this.options_.withCredentials=this.options_.withCredentials||false;if(typeof this.options_.bandwidth!=="number"){this.options_.bandwidth=4194304}["withCredentials","bandwidth"].forEach(function(t){if(typeof e.source_[t]!=="undefined"){e.options_[t]=e.source_[t]}});this.bandwidth=this.options_.bandwidth}},{key:"src",value:function a(e){var t=this;if(!e){return}this.setOptions_();this.options_.url=this.source_.src;this.options_.tech=this.tech_;this.options_.externHls=M;this.masterPlaylistController_=new k.MasterPlaylistController(this.options_);this.playbackWatcher_=new C["default"](S["default"].mergeOptions(this.options_,{seekable:function i(){return t.seekable()}}));this.masterPlaylistController_.selectPlaylist=this.selectPlaylist?this.selectPlaylist.bind(this):M.STANDARD_PLAYLIST_SELECTOR.bind(this);this.playlists=this.masterPlaylistController_.masterPlaylistLoader_;this.mediaSource=this.masterPlaylistController_.mediaSource;Object.defineProperties(this,{selectPlaylist:{get:function r(){return this.masterPlaylistController_.selectPlaylist},set:function n(e){this.masterPlaylistController_.selectPlaylist=e.bind(this)}},throughput:{get:function a(){return this.masterPlaylistController_.mainSegmentLoader_.throughput.rate},set:function s(e){this.masterPlaylistController_.mainSegmentLoader_.throughput.rate=e;this.masterPlaylistController_.mainSegmentLoader_.throughput.count=1}},bandwidth:{get:function o(){return this.masterPlaylistController_.mainSegmentLoader_.bandwidth},set:function u(e){this.masterPlaylistController_.mainSegmentLoader_.bandwidth=e;this.masterPlaylistController_.mainSegmentLoader_.throughput={rate:0,count:0}}},systemBandwidth:{get:function f(){var e=1/(this.bandwidth||1);var t=undefined;if(this.throughput>0){t=1/this.throughput}else{t=0}var i=Math.floor(1/(e+t));return i},set:function d(){S["default"].log.error('The "systemBandwidth" property is read-only')}}});Object.defineProperties(this.stats,{bandwidth:{get:function l(){return t.bandwidth||0},enumerable:true},mediaRequests:{get:function c(){return t.masterPlaylistController_.mediaRequests_()||0},enumerable:true},mediaTransferDuration:{get:function h(){return t.masterPlaylistController_.mediaTransferDuration_()||0},enumerable:true},mediaBytesTransferred:{get:function p(){return t.masterPlaylistController_.mediaBytesTransferred_()||0},enumerable:true},mediaSecondsLoaded:{get:function m(){return t.masterPlaylistController_.mediaSecondsLoaded_()||0},enumerable:true}});this.tech_.one("canplay",this.masterPlaylistController_.setupFirstPlay.bind(this.masterPlaylistController_));this.masterPlaylistController_.on("sourceopen",function(){t.tech_.audioTracks().addEventListener("change",t.audioTrackChange_)});this.masterPlaylistController_.on("selectedinitialmedia",function(){(0,E["default"])(t)});this.masterPlaylistController_.on("audioupdate",function(){t.tech_.clearTracks("audio");t.masterPlaylistController_.activeAudioGroup().forEach(function(e){t.tech_.audioTracks().addTrack(e)})});this.on(this.masterPlaylistController_,"progress",function(){this.tech_.trigger("progress")});this.on(this.masterPlaylistController_,"firstplay",function(){this.ignoreNextSeekingEvent_=true});this.tech_.ready(function(){return t.setupQualityLevels_()});if(!this.tech_.el()){return}this.tech_.src(S["default"].URL.createObjectURL(this.masterPlaylistController_.mediaSource))}},{key:"setupQualityLevels_",value:function u(){var e=this;var t=S["default"].players[this.tech_.options_.playerId];if(t&&t.qualityLevels){this.qualityLevels_=t.qualityLevels();this.masterPlaylistController_.on("selectedinitialmedia",function(){N(e.qualityLevels_,e)});this.playlists.on("mediachange",function(){R(e.qualityLevels_,e.playlists)})}}},{key:"activeAudioGroup_",value:function d(){return this.masterPlaylistController_.activeAudioGroup()}},{key:"play",value:function l(){this.masterPlaylistController_.play()}},{key:"setCurrentTime",value:function c(e){this.masterPlaylistController_.setCurrentTime(e)}},{key:"duration",value:function h(){return this.masterPlaylistController_.duration()}},{key:"seekable",value:function p(){return this.masterPlaylistController_.seekable()}},{key:"dispose",value:function m(){if(this.playbackWatcher_){this.playbackWatcher_.dispose()}if(this.masterPlaylistController_){this.masterPlaylistController_.dispose()}if(this.qualityLevels_){this.qualityLevels_.dispose()}this.tech_.audioTracks().removeEventListener("change",this.audioTrackChange_);n(Object.getPrototypeOf(t.prototype),"dispose",this).call(this)}}]);return t}(q);var V=function J(e){return{canHandleSource:function t(i){if(S["default"].options.hls&&S["default"].options.hls.mode&&S["default"].options.hls.mode!==e){return false}return J.canPlayType(i.type)},handleSource:function i(t,r,n){if(e==="flash"){r.setTimeout(function(){r.trigger("loadstart")},1)}var a=S["default"].mergeOptions(n,{hls:{mode:e}});r.hls=new H(t,r,a);r.hls.xhr=(0,m["default"])();if(S["default"].Hls.xhr.beforeRequest){r.hls.xhr.beforeRequest=S["default"].Hls.xhr.beforeRequest}r.hls.src(t.src);return r.hls},canPlayType:function r(e){if(J.canPlayType(e)){return"maybe"}return""}}};M.comparePlaylistBandwidth=function(e,t){var i=undefined;var r=undefined;if(e.attributes&&e.attributes.BANDWIDTH){i=e.attributes.BANDWIDTH}i=i||L["default"].Number.MAX_VALUE;if(t.attributes&&t.attributes.BANDWIDTH){r=t.attributes.BANDWIDTH}r=r||L["default"].Number.MAX_VALUE;return i-r};M.comparePlaylistResolution=function(e,t){var i=undefined;var r=undefined;if(e.attributes&&e.attributes.RESOLUTION&&e.attributes.RESOLUTION.width){i=e.attributes.RESOLUTION.width}i=i||L["default"].Number.MAX_VALUE;if(t.attributes&&t.attributes.RESOLUTION&&t.attributes.RESOLUTION.width){r=t.attributes.RESOLUTION.width}r=r||L["default"].Number.MAX_VALUE;if(i===r&&e.attributes.BANDWIDTH&&t.attributes.BANDWIDTH){return e.attributes.BANDWIDTH-t.attributes.BANDWIDTH}return i-r};V.canPlayType=function(e){if(S["default"].browser.IE_VERSION&&S["default"].browser.IE_VERSION<=10){return false}var t=/^(audio|video|application)\/(x-|vnd\.apple\.)?mpegurl/i;if(!S["default"].options.hls.overrideNative&&M.supportsNativeHls){return false}return t.test(e)};if(typeof S["default"].MediaSource==="undefined"||typeof S["default"].URL==="undefined"){S["default"].MediaSource=b.MediaSource;S["default"].URL=b.URL}var X=S["default"].getTech("Flash");if(b.MediaSource.supportsNativeMediaSources()){S["default"].getTech("Html5").registerSourceHandler(V("html5"),0)}if(L["default"].Uint8Array&&X){X.registerSourceHandler(V("flash"))}S["default"].HlsHandler=H;S["default"].HlsSourceHandler=V;S["default"].Hls=M;if(!S["default"].use){S["default"].registerComponent("Hls",M)}S["default"].m3u8=T["default"];S["default"].options.hls=S["default"].options.hls||{};if(S["default"].registerPlugin){S["default"].registerPlugin("reloadSourceOnError",D["default"])}else{S["default"].plugin("reloadSourceOnError",D["default"])}t.exports={Hls:M,HlsHandler:H,HlsSourceHandler:V}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./bin-utils":2,"./config":3,"./master-playlist-controller":5,"./playback-watcher":6,"./playlist":8,"./playlist-loader":7,"./reload-source-on-error":10,"./rendition-mixin":11,"./xhr":17,"aes-decrypter":21,"global/document":27,"global/window":28,"m3u8-parser":29,"videojs-contrib-media-sources":53}]},{},[78])(78)});
//# sourceMappingURL=videojs-contrib-hls.map.js