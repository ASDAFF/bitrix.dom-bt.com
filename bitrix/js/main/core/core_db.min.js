(function(e){if(e.BX.dataBase)return;var t=e.BX;t.dataBase=function(t){this.tableList=[];this.jsonFields={};if(typeof e.SQLitePlugin!="undefined"&&typeof e.SQLitePlugin.openDatabase=="function"){this.dbObject=e.SQLitePlugin.openDatabase(t.name,t.version,t.displayName,t.capacity);this.dbBandle="SQLitePlugin"}else if(typeof e.openDatabase!="undefined"){this.dbBandle="openDatabase";this.dbObject=e.openDatabase(t.name,t.version,t.displayName,t.capacity)}else{this.dbBandle="undefined";this.dbObject=null}};t.dataBase.create=function(i){if(typeof e.openDatabase!="undefined"||typeof e.SQLitePlugin!="undefined"&&typeof e.SQLitePlugin.openDatabase=="function"){return new t.dataBase(i)}else{return null}};t.dataBase.prototype.setJsonFields=function(e,i){if(typeof i=="string"){if(i==""){i=[]}else{i=[i]}}if(e&&t.type.isArray(i)){e=e.toString().toUpperCase();this.jsonFields[e]=[];if(i.length>0){for(var a=0;a<i.length;a++){this.jsonFields[e].push(i[a].toString().toUpperCase())}}else{delete this.jsonFields[e]}}return true};t.dataBase.prototype.isTableExists=function(e,i){e=e.toUpperCase();var a=new t.Promise;if(typeof i!="function"){i=function(){}}var s=function(t){if(t.indexOf(e)>-1){i(true,e);a.fulfill(e)}else{i(false,e);a.reject(e)}};if(this.tableList.length<=0){this.getTableList().then(s)}else{s(this.tableList)}return a};t.dataBase.prototype.getTableList=function(e){var i=new t.Promise;if(typeof e!="function"){e=function(){}}var a=e;this.query({query:"SELECT tbl_name from sqlite_master WHERE type = 'table'",values:[]}).then(function(e){this.tableList=[];if(e.result.count>0){for(var t=0;t<e.result.items.length;t++){this.tableList[this.tableList.length]=e.result.items[t].tbl_name.toString().toUpperCase()}}a(this.tableList);i.fulfill(this.tableList)}.bind(this)).catch(function(e){i.reject(e)});return i};t.dataBase.prototype.createTable=function(e){var i=new t.Promise;e=e||{};if(typeof e.success!="function"){e.success=function(e,t){}}if(typeof e.fail!="function"){e.fail=function(e,t,i){}}e.action="create";this.query(this.getQuery(e)).then(function(t){this.getTableList();t.result.tableName=e.tableName;e.success(t.result,t.transaction);i.fulfill(t)}.bind(this)).catch(function(t){e.fail(t.result,t.transaction,t.query,e);t.queryParams=e;i.reject(t)});return i};t.dataBase.prototype.dropTable=function(e){var i=new t.Promise;e=e||{};if(typeof e.success!="function"){e.success=function(e,t){}}if(typeof e.fail!="function"){e.fail=function(e,t,i){}}e.action="drop";this.query(this.getQuery(e)).then(function(t){this.getTableList();t.result.tableName=e.tableName;e.success(t.result,t.transaction);i.fulfill(t)}.bind(this)).catch(function(t){e.fail(t.result,t.transaction,t.query,e);t.queryParams=e;i.reject(t)});return i};t.dataBase.prototype.addRow=function(e){var i=new t.Promise;e=e||{};if(typeof e.success!="function"){e.success=function(e,t){}}if(typeof e.fail!="function"){e.fail=function(e,t,i){}}e.action="insert";this.query(this.getQuery(e)).then(function(t){e.success(t.result,t.transaction);t.result.tableName=e.tableName;i.fulfill(t)}).catch(function(t){e.fail(t.result,t.transaction,t.query,e);t.queryParams=e;i.reject(t)});return i};t.dataBase.prototype.getRows=function(e){var i=new t.Promise;e=e||{};if(typeof e.success!="function"){e.success=function(e,t){}}if(typeof e.fail!="function"){e.fail=function(e,t,i){}}e.action="select";this.query(this.getQuery(e)).then(function(t){var a=e.tableName.toString().toUpperCase();if(this.jsonFields[a]&&this.jsonFields[a].length&&t.result.items.length){for(var s=0;s<t.result.items.length;s++){for(var n=0;n<this.jsonFields[a].length;n++){if(t.result.items[s][this.jsonFields[a][n]]){t.result.items[s][this.jsonFields[a][n]]=JSON.parse(t.result.items[s][this.jsonFields[a][n]])}}}}e.success(t.result,t.transaction);t.result.tableName=e.tableName;i.fulfill(t)}.bind(this)).catch(function(t){e.fail(t.result,t.transaction,t.query,e);t.queryParams=e;i.reject(t)});return i};t.dataBase.prototype.updateRows=function(e){var i=new t.Promise;e=e||{};if(typeof e.success!="function"){e.success=function(e,t){}}if(typeof e.fail!="function"){e.fail=function(e,t,i){}}e.action="update";this.query(this.getQuery(e)).then(function(t){e.success(t.result,t.transaction);t.result.tableName=e.tableName;i.fulfill(t)}).catch(function(t){e.fail(t.result,t.transaction,t.query,e);t.queryParams=e;i.reject(t)});return i};t.dataBase.prototype.deleteRows=function(e){e.action="delete";var t=this.getQuery(e);this.query(t,e.success,e.fail)};t.dataBase.prototype.getQuery=function(e){var i=[];var a=e.filter;var s=e.fields;var n=e.insertFields;var r=e.updateFields;var o=e.tableName;var f="";switch(e.action){case"create":{var u="";if(typeof s=="object"){var l="";var c="";for(var p=0;p<s.length;p++){l="";c="";if(typeof s[p]=="object"){if(s[p].name){l=s[p].name}if(l&&s[p].type){if(s[p].type.toLowerCase()=="integer"||s[p].type.toLowerCase()=="real"||s[p].type.toLowerCase()=="text"){l+=" "+s[p].type}}if(l&&s[p].unique&&s[p].unique==true){l+=" unique"}}else if(typeof s[p]=="string"&&s[p].length>0){l=s[p]}if(l.length>0){if(u.length>0)u+=","+l.toUpperCase();else u=l.toUpperCase()}}}f="CREATE TABLE IF NOT EXISTS "+o.toUpperCase()+" ("+u+") ";break}case"drop":{f="DROP TABLE IF EXISTS "+o.toUpperCase();break}case"select":{f="SELECT "+this.getValueArrayString(s,"*")+" FROM "+o.toUpperCase()+" "+this.getFilter(a);i=this.getValues([a]);break}case"insert":{var h=0;var y=0;var g="";if(t.type.isArray(n)){i=this.getValues(n,"insert");for(var d in n[0]){y++}h=n.length;g=this.getKeyString(n[0])}else{i=this.getValues([n],"insert");h=1;y=i.length;g=this.getKeyString(n)}f="INSERT INTO "+o.toUpperCase()+" ("+g+") VALUES %values%";var v=[];var b=[];for(var d=0;d<h;d++){v=[];for(var p=0;p<y;p++){v.push("?")}b.push(v.join(","))}f=f.replace("%values%","("+b.join("), (")+")");break}case"delete":{f="DELETE FROM "+o.toUpperCase()+" "+this.getFilter(a);i=this.getValues([a]);break}case"update":{f="UPDATE "+o.toUpperCase()+" "+this.getFieldPair(r,"SET ")+" "+this.getFilter(a);i=this.getValues([r],"update").concat(this.getValues([a]));break}}return{query:f,values:i}};t.dataBase.prototype.getFieldPair=function(e,t){var i="";var a=t||"";if(typeof e=="object"){var s=0;for(var n in e){var r=(s>0?", ":"")+(n.toUpperCase()+"="+"?");if(i.length==0&&a.length>0)i=a;i+=r;s++}}return i};t.dataBase.prototype.getFilter=function(e){var t="";var i="WHERE ";if(typeof e=="object"){var a=0;for(var s in e){var n="";var r=1;if(typeof e[s]=="object"){r=e[s].length}for(var o=0;o<r;o++){n=(o>0?n+" OR ":"(")+(s.toUpperCase()+"="+"?");if(o+1==r)n+=")"}t+=n;a++}}else if(typeof e=="string"){t=e}return t==""?"":"WHERE "+t};t.dataBase.prototype.getKeyString=function(e,i){var a="";if(!i)i="";if(t.type.isArray(e)){for(var s=0;s<e.length;s++){for(var n in e[s]){if(a.length>0)a+=","+n.toUpperCase();else a=n.toUpperCase()}}}else if(typeof e=="object"){for(var n in e){if(a.length>0)a+=","+n.toUpperCase();else a=n.toUpperCase()}}if(a.length==0)a=i;return a};t.dataBase.prototype.getValueArrayString=function(e,t){var i="";if(!t)t="";if(typeof e=="object"){for(var a=0;a<e.length;a++){if(i.length>0)i+=","+e[a].toUpperCase();else i=e[a].toUpperCase()}}if(i.length==0)i=t;return i};t.dataBase.prototype.getValues=function(e,i){i=i||"undefined";var a=[];for(var s=0;s<e.length;s++){var n=e[s];if(t.type.isArray(n)){for(var r=0;r<n.length;r++){if((i=="insert"||i=="update")&&typeof n[r]=="object"){a.push(JSON.stringify(n[r]))}else if(typeof n[r]=="object"){for(var o in n[r]){if(typeof n[r][o]=="object"){a.push(JSON.stringify(n[r][o]))}else{a.push(n[r][o])}}}else{a.push(n[r])}}}else if(typeof n=="object"){for(var r in n){if((i=="insert"||i=="update")&&typeof n[r]=="object"){a.push(JSON.stringify(n[r]))}else if(typeof n[r]=="object"){for(var o in n[r]){if(typeof n[r][o]=="object"){a.push(JSON.stringify(n[r][o]))}else{a.push(n[r][o])}}}else{a.push(n[r])}}}}return a};t.dataBase.prototype.query=function(e,i,a){var s=new t.Promise;if(typeof i!="function"){i=function(e,t){}}if(typeof a!="function"){a=function(e,t,i){}}if(!this.dbObject){a(null,null,null);s.reject(null,null,null);return s}this.dbObject.transaction(function(t){t.executeSql(e.query,e.values,function(e,t){var a={originalResult:t};var n=t.rows.length;if(n>=0){a.count=n;a.items=[];for(var r=0;r<n;r++){var o={};var f=t.rows.item(r);for(var u in f){if(f.hasOwnProperty(u)){o[u]=f[u]}}a.items.push(o)}}i(a,e);s.fulfill({result:a,transaction:e})},function(t,i){a(i,t,e);s.reject({result:i,transaction:t,query:e})})});return s};t.dataBase.prototype.getResponseObject=function(e){var t=e.rows.length;var i=[];for(var a=0;a<t;a++){i[i.length]=e.rows.item(a)}return i}})(window);
//# sourceMappingURL=core_db.map.js